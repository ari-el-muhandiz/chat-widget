/*! For license information please see chat-widget.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["chat-widget"]=t():e["chat-widget"]=t()}(self,(function(){return(()=>{var e,t,n={7262:(e,t,n)=>{"use strict";var r=n(3283),i=n(204),s=n.n(i),o=n(829);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){var t="function"==typeof Map?new Map:void 0;return(d=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return h(e,arguments,m(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),f(r,e)})(e)}function h(e,t,n){return(h=p()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&f(i,n.prototype),i}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=document.createElement("template");g.innerHTML="\n  <style>".concat(r.Z.toString(),'</style>\n  <div class="chat-box">\n    <div class="chat-head">\n        <h2>Chat Box</h2>\n    </div>\n    <div class="chat-body">\n      <div class="msg-insert">\n        <slot></slot>\n      </div>\n    </div>\n    <div class="chat-text">\n      <textarea placeholder="Send"></textarea>\n    </div>\n  </div>\n');const y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(h,e);var t,n,r,i,a,d=(t=h,n=p(),function(){var e,r=m(t);if(n){var i=m(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return u(this,e)});function h(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(e=d.call(this)).attachShadow({mode:"open"}).appendChild(g.content.cloneNode(!0)),e.sendMessage=e.sendMessage.bind(l(e)),e.addMessageToList=e.addMessageToList.bind(l(e)),e.channel=null,e}return r=h,(i=[{key:"connectedCallback",value:function(){var e=this,t=this.shadowRoot.querySelector("textArea");t.disabled=!0,t.onkeypress=this.sendMessage,s()("http://localhost:3000/api/chat",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({identity:"demo"})}).then((function(e){return e.json()})).then((function(e){return function(e){var t=null;return new Promise((function(n,r){return o.Client.create(e).then((function(e){return e.getPublicChannelDescriptors()})).then((function(e){for(var n=e.items,r=0;r<n.length;r++)if("demo"===n[r].uniqueName){t=n[r];break}return t?Promise.resolve(t):client.createChannel({uniqueName:"demo",friendlyName:"demo"})})).then((function(e){return e.client.getChannelBySid(e.sid)})).then((function(e){return"joined"!==e.channelState.status?e.join():Promise.resolve(e)})).then((function(e){n(e)})).catch((function(e){r(e)}))}))}(e.token)})).then((function(n){return n.on("messageAdded",e.addMessageToList),e.channel=n,t.disabled=!1,function(e){return new Promise((function(t,n){return e.getMessages().then((function(e){t(e)})).catch((function(e){n(e)}))}))}(n)})).then((function(e){}))}},{key:"sendMessage",value:function(e){if(13===e.keyCode){e.preventDefault;var t=this.shadowRoot.querySelector("textArea");this.channel.sendMessage(t.value),t.value=""}}},{key:"addMessageToList",value:function(e){var t=document.createElement("chat-message");t.innerHTML=e.body,t.setAttribute("msgType","admin"===e.author?"msg-receive":"msg-send"),this.appendChild(t)}}])&&c(r.prototype,i),a&&c(r,a),h}(d(HTMLElement));var v=n(7846);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){var t="function"==typeof Map?new Map:void 0;return(_=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return S(e,arguments,C(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),x(r,e)})(e)}function S(e,t,n){return(S=T()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&x(i,n.prototype),i}).apply(null,arguments)}function T(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=document.createElement("template");E.innerHTML="\n  <style>".concat(v.Z.toString(),"</style>\n  <div><slot></slot></div>\n");const I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(a,e);var t,n,r,i,s,o=(t=a,n=T(),function(){var e,r=C(t);if(n){var i=C(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return k(this,e)});function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this)).attachShadow({mode:"open"}).appendChild(E.content.cloneNode(!0)),e}return r=a,s=[{key:"observedAttributes",get:function(){return["msgType"]}}],(i=[{key:"connectedCallback",value:function(){var e=this.getAttribute("msgType");e&&this.shadowRoot.querySelector("div").setAttribute("class",e)}}])&&w(r.prototype,i),s&&w(r,s),a}(_(HTMLElement));customElements.define("chat-box",y),customElements.define("chat-message",I)},4043:(e,t,n)=>{e.exports={default:n(7185),__esModule:!0}},6378:(e,t,n)=>{e.exports={default:n(3597),__esModule:!0}},863:(e,t,n)=>{e.exports={default:n(1035),__esModule:!0}},3239:(e,t,n)=>{e.exports={default:n(2742),__esModule:!0}},2367:(e,t,n)=>{e.exports={default:n(3896),__esModule:!0}},2e3:(e,t,n)=>{e.exports={default:n(6989),__esModule:!0}},2945:(e,t,n)=>{e.exports={default:n(6981),__esModule:!0}},5861:(e,t,n)=>{e.exports={default:n(5627),__esModule:!0}},2242:(e,t,n)=>{e.exports={default:n(3391),__esModule:!0}},8177:(e,t,n)=>{e.exports={default:n(7036),__esModule:!0}},5105:(e,t,n)=>{e.exports={default:n(381),__esModule:!0}},8902:(e,t,n)=>{e.exports={default:n(8613),__esModule:!0}},5345:(e,t,n)=>{e.exports={default:n(433),__esModule:!0}},6593:(e,t,n)=>{e.exports={default:n(112),__esModule:!0}},4781:(e,t,n)=>{e.exports={default:n(8318),__esModule:!0}},448:(e,t,n)=>{e.exports={default:n(5736),__esModule:!0}},9527:(e,t,n)=>{e.exports={default:n(2720),__esModule:!0}},3516:(e,t,n)=>{e.exports={default:n(25),__esModule:!0}},4275:(e,t,n)=>{e.exports={default:n(2392),__esModule:!0}},6803:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=n(6593),s=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){return function(){var t=e.apply(this,arguments);return new s.default((function(e,n){return function r(i,o){try{var a=t[i](o),c=a.value}catch(e){return void n(e)}if(!a.done)return s.default.resolve(c).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(c)}("next")}))}}},9663:(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},2600:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=n(2242),s=(r=i)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,s.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},3196:(e,t,n)=>{"use strict";t.__esModule=!0;var r=o(n(5345)),i=o(n(5861)),s=o(n(2444));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},9135:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=n(2444),s=(r=i)&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,s.default)(t))&&"function"!=typeof t?e:t}},2424:(e,t,n)=>{"use strict";t.__esModule=!0;var r=s(n(863)),i=s(n(6378));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,s=!1,o=void 0;try{for(var a,c=(0,i.default)(e);!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){s=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(s)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},5315:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=n(4043),s=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,s.default)(e)}},2444:(e,t,n)=>{"use strict";t.__esModule=!0;var r=o(n(4275)),i=o(n(3516)),s="function"==typeof i.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof i.default&&"symbol"===s(r.default)?function(e){return void 0===e?"undefined":s(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":s(e)}},2548:(e,t,n)=>{var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,s=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(8544),i)r.regeneratorRuntime=s;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},8544:e=>{!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag",u=t.regeneratorRuntime;if(u)e.exports=u;else{(u=t.regeneratorRuntime=e.exports).wrap=b;var l="suspendedStart",d="suspendedYield",h="executing",p="completed",f={},m={};m[o]=function(){return this};var g=Object.getPrototypeOf,y=g&&g(g(P([])));y&&y!==r&&i.call(y,o)&&(m=y);var v=S.prototype=k.prototype=Object.create(m);_.prototype=v.constructor=S,S.constructor=_,S[c]=_.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(v),e},u.awrap=function(e){return{__await:e}},T(x.prototype),x.prototype[a]=function(){return this},u.AsyncIterator=x,u.async=function(e,t,n,r){var i=new x(b(e,t,n,r));return u.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},T(v),v[c]="Generator",v[o]=function(){return this},v.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},u.values=P,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return a.type="throw",a.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),f}}}function b(e,t,n,r){var i=t&&t.prototype instanceof k?t:k,s=Object.create(i.prototype),o=new M(r||[]);return s._invoke=function(e,t,n){var r=l;return function(i,s){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw s;return O()}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var a=C(o,n);if(a){if(a===f)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var c=w(e,t,n);if("normal"===c.type){if(r=n.done?p:d,c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(e,n,o),s}function w(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function k(){}function _(){}function S(){}function T(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function x(e){function t(n,r,s,o){var a=w(e[n],e,r);if("throw"!==a.type){var c=a.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,s,o)}),(function(e){t("throw",e,s,o)})):Promise.resolve(u).then((function(e){c.value=e,s(c)}),o)}o(a.arg)}var n;this._invoke=function(e,r){function i(){return new Promise((function(n,i){t(e,r,n,i)}))}return n=n?n.then(i,i):i()}}function C(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,C(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var i=w(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,f;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,f):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return s.next=s}}return{next:O}}function O(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},4942:(e,t,n)=>{e.exports=n(2548)},7185:(e,t,n)=>{n(1867),n(2586),e.exports=n(4579).Array.from},3597:(e,t,n)=>{n(3871),n(1867),e.exports=n(6459)},1035:(e,t,n)=>{n(3871),n(1867),e.exports=n(9553)},2742:(e,t,n)=>{var r=n(4579),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},3896:(e,t,n)=>{n(4058),n(1867),n(3871),n(4138),n(2834),n(605),n(5828),e.exports=n(4579).Map},6989:(e,t,n)=>{n(9846),e.exports=n(4579).Number.isInteger},6981:(e,t,n)=>{n(2699),e.exports=n(4579).Object.assign},5627:(e,t,n)=>{n(6760);var r=n(4579).Object;e.exports=function(e,t){return r.create(e,t)}},3391:(e,t,n)=>{n(1477);var r=n(4579).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},7036:(e,t,n)=>{n(5178);var r=n(4579).Object;e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},381:(e,t,n)=>{n(7220),e.exports=n(4579).Object.getPrototypeOf},8613:(e,t,n)=>{n(961),e.exports=n(4579).Object.keys},433:(e,t,n)=>{n(9349),e.exports=n(4579).Object.setPrototypeOf},112:(e,t,n)=>{n(4058),n(1867),n(3871),n(2878),n(5971),n(2526),e.exports=n(4579).Promise},8318:(e,t,n)=>{n(9650),e.exports=n(4579).Reflect.construct},5736:(e,t,n)=>{n(630),e.exports=n(4579).Reflect.metadata},2720:(e,t,n)=>{n(4058),n(1867),n(3871),n(1003),n(8408),n(1749),n(9806),e.exports=n(4579).Set},25:(e,t,n)=>{n(6840),n(4058),n(8174),n(6461),e.exports=n(4579).Symbol},2392:(e,t,n)=>{n(1867),n(3871),e.exports=n(5103).f("iterator")},5663:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},9003:e=>{e.exports=function(){}},9142:e=>{e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},2159:(e,t,n)=>{var r=n(6727);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},7259:(e,t,n)=>{var r=n(5576);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},7428:(e,t,n)=>{var r=n(7932),i=n(8728),s=n(6531);e.exports=function(e){return function(t,n,o){var a,c=r(t),u=i(c.length),l=s(o,u);if(e&&n!=n){for(;u>l;)if((a=c[l++])!=a)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}}},1523:(e,t,n)=>{var r=n(9216),i=n(799),s=n(6530),o=n(8728),a=n(7745);e.exports=function(e,t){var n=1==e,c=2==e,u=3==e,l=4==e,d=6==e,h=5==e||d,p=t||a;return function(t,a,f){for(var m,g,y=s(t),v=i(y),b=r(a,f,3),w=o(v.length),k=0,_=n?p(t,w):c?p(t,0):void 0;w>k;k++)if((h||k in v)&&(g=b(m=v[k],k,y),e))if(n)_[k]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return k;case 2:_.push(m)}else if(l)return!1;return d?-1:u||l?l:_}}},161:(e,t,n)=>{var r=n(6727),i=n(1421),s=n(2939)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[s])&&(t=void 0)),void 0===t?Array:t}},7745:(e,t,n)=>{var r=n(161);e.exports=function(e,t){return new(r(e))(t)}},4094:(e,t,n)=>{"use strict";var r=n(5663),i=n(6727),s=n(6778),o=[].slice,a={},c=function(e,t,n){if(!(t in a)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";a[t]=Function("F,a","return new F("+r.join(",")+")")}return a[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=o.call(arguments,1),a=function(){var r=n.concat(o.call(arguments));return this instanceof a?c(t,r.length,r):s(t,r,e)};return i(t.prototype)&&(a.prototype=t.prototype),a}},4677:(e,t,n)=>{var r=n(2894),i=n(2939)("toStringTag"),s="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:s?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},2894:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},6175:(e,t,n)=>{"use strict";var r=n(4743).f,i=n(8989),s=n(8144),o=n(9216),a=n(9142),c=n(5576),u=n(5700),l=n(5084),d=n(9967),h=n(9666),p=n(7177).fastKey,f=n(765),m=h?"_s":"size",g=function(e,t){var n,r=p(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,u){var l=e((function(e,r){a(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,null!=r&&c(r,n,e[u],e)}));return s(l.prototype,{clear:function(){for(var e=f(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var n=f(this,t),r=g(n,e);if(r){var i=r.n,s=r.p;delete n._i[r.i],r.r=!0,s&&(s.n=i),i&&(i.p=s),n._f==r&&(n._f=i),n._l==r&&(n._l=s),n[m]--}return!!r},forEach:function(e){f(this,t);for(var n,r=o(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!g(f(this,t),e)}}),h&&r(l.prototype,"size",{get:function(){return f(this,t)[m]}}),l},def:function(e,t,n){var r,i,s=g(e,t);return s?s.v=n:(e._l=s={i:i=p(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=s),r&&(r.n=s),e[m]++,"F"!==i&&(e._i[i]=s)),e},getEntry:g,setStrong:function(e,t,n){u(e,t,(function(e,n){this._t=f(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?l(0,"keys"==t?n.k:"values"==t?n.v:[n.k,n.v]):(e._t=void 0,l(1))}),n?"entries":"values",!n,!0),d(t)}}},1718:(e,t,n)=>{var r=n(4677),i=n(7259);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},106:(e,t,n)=>{"use strict";var r=n(8144),i=n(7177).getWeak,s=n(2159),o=n(6727),a=n(9142),c=n(5576),u=n(1523),l=n(7069),d=n(765),h=u(5),p=u(6),f=0,m=function(e){return e._l||(e._l=new g)},g=function(){this.a=[]},y=function(e,t){return h(e.a,(function(e){return e[0]===t}))};g.prototype={get:function(e){var t=y(this,e);if(t)return t[1]},has:function(e){return!!y(this,e)},set:function(e,t){var n=y(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=p(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,s){var u=e((function(e,r){a(e,u,t,"_i"),e._t=t,e._i=f++,e._l=void 0,null!=r&&c(r,n,e[s],e)}));return r(u.prototype,{delete:function(e){if(!o(e))return!1;var n=i(e);return!0===n?m(d(this,t)).delete(e):n&&l(n,this._i)&&delete n[this._i]},has:function(e){if(!o(e))return!1;var n=i(e);return!0===n?m(d(this,t)).has(e):n&&l(n,this._i)}}),u},def:function(e,t,n){var r=i(s(t),!0);return!0===r?m(e).set(t,n):r[e._i]=n,e},ufstore:m}},2269:(e,t,n)=>{"use strict";var r=n(3938),i=n(3856),s=n(7177),o=n(7929),a=n(1818),c=n(8144),u=n(5576),l=n(9142),d=n(6727),h=n(5378),p=n(4743).f,f=n(1523)(0),m=n(9666);e.exports=function(e,t,n,g,y,v){var b=r[e],w=b,k=y?"set":"add",_=w&&w.prototype,S={};return m&&"function"==typeof w&&(v||_.forEach&&!o((function(){(new w).entries().next()})))?(w=t((function(t,n){l(t,w,e,"_c"),t._c=new b,null!=n&&u(n,y,t[k],t)})),f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in _)||v&&"clear"==e||a(w.prototype,e,(function(n,r){if(l(this,w,e),!t&&v&&!d(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i}))})),v||p(w.prototype,"size",{get:function(){return this._c.size}})):(w=g.getConstructor(t,e,y,k),c(w.prototype,n),s.NEED=!0),h(w,e),S[e]=w,i(i.G+i.W+i.F,S),v||g.setStrong(w,e,y),w}},4579:e=>{var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)},2445:(e,t,n)=>{"use strict";var r=n(4743),i=n(3101);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},9216:(e,t,n)=>{var r=n(5663);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},8333:e=>{e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},9666:(e,t,n)=>{e.exports=!n(7929)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},7467:(e,t,n)=>{var r=n(6727),i=n(3938).document,s=r(i)&&r(i.createElement);e.exports=function(e){return s?i.createElement(e):{}}},3338:e=>{e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},337:(e,t,n)=>{var r=n(6162),i=n(8195),s=n(6274);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var o,a=n(e),c=s.f,u=0;a.length>u;)c.call(e,o=a[u++])&&t.push(o);return t}},3856:(e,t,n)=>{var r=n(3938),i=n(4579),s=n(9216),o=n(1818),a=n(7069),c=function(e,t,n){var u,l,d,h=e&c.F,p=e&c.G,f=e&c.S,m=e&c.P,g=e&c.B,y=e&c.W,v=p?i:i[t]||(i[t]={}),b=v.prototype,w=p?r:f?r[t]:(r[t]||{}).prototype;for(u in p&&(n=t),n)(l=!h&&w&&void 0!==w[u])&&a(v,u)||(d=l?w[u]:n[u],v[u]=p&&"function"!=typeof w[u]?n[u]:g&&l?s(d,r):y&&w[u]==d?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):m&&"function"==typeof d?s(Function.call,d):d,m&&((v.virtual||(v.virtual={}))[u]=d,e&c.R&&b&&!b[u]&&o(b,u,d)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},7929:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},5576:(e,t,n)=>{var r=n(9216),i=n(5602),s=n(5991),o=n(2159),a=n(8728),c=n(3728),u={},l={},d=e.exports=function(e,t,n,d,h){var p,f,m,g,y=h?function(){return e}:c(e),v=r(n,d,t?2:1),b=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(s(y)){for(p=a(e.length);p>b;b++)if((g=t?v(o(f=e[b])[0],f[1]):v(e[b]))===u||g===l)return g}else for(m=y.call(e);!(f=m.next()).done;)if((g=i(m,v,f.value,t))===u||g===l)return g};d.BREAK=u,d.RETURN=l},3938:e=>{var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},7069:e=>{var t={}.hasOwnProperty;e.exports=function(e,n){return t.call(e,n)}},1818:(e,t,n)=>{var r=n(4743),i=n(3101);e.exports=n(9666)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},4881:(e,t,n)=>{var r=n(3938).document;e.exports=r&&r.documentElement},3758:(e,t,n)=>{e.exports=!n(9666)&&!n(7929)((function(){return 7!=Object.defineProperty(n(7467)("div"),"a",{get:function(){return 7}}).a}))},6778:e=>{e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},799:(e,t,n)=>{var r=n(2894);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},5991:(e,t,n)=>{var r=n(5449),i=n(2939)("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||s[i]===e)}},1421:(e,t,n)=>{var r=n(2894);e.exports=Array.isArray||function(e){return"Array"==r(e)}},6732:(e,t,n)=>{var r=n(6727),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},6727:e=>{e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},5602:(e,t,n)=>{var r=n(2159);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var s=e.return;throw void 0!==s&&r(s.call(e)),t}}},3945:(e,t,n)=>{"use strict";var r=n(8989),i=n(3101),s=n(5378),o={};n(1818)(o,n(2939)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),s(e,t+" Iterator")}},5700:(e,t,n)=>{"use strict";var r=n(6227),i=n(3856),s=n(7470),o=n(1818),a=n(5449),c=n(3945),u=n(5378),l=n(5089),d=n(2939)("iterator"),h=!([].keys&&"next"in[].keys()),p="keys",f="values",m=function(){return this};e.exports=function(e,t,n,g,y,v,b){c(n,t,g);var w,k,_,S=function(e){if(!h&&e in E)return E[e];switch(e){case p:case f:return function(){return new n(this,e)}}return function(){return new n(this,e)}},T=t+" Iterator",x=y==f,C=!1,E=e.prototype,I=E[d]||E["@@iterator"]||y&&E[y],M=I||S(y),P=y?x?S("entries"):M:void 0,O="Array"==t&&E.entries||I;if(O&&(_=l(O.call(new e)))!==Object.prototype&&_.next&&(u(_,T,!0),r||"function"==typeof _[d]||o(_,d,m)),x&&I&&I.name!==f&&(C=!0,M=function(){return I.call(this)}),r&&!b||!h&&!C&&E[d]||o(E,d,M),a[t]=M,a[T]=m,y)if(w={values:x?M:S(f),keys:v?M:S(p),entries:P},b)for(k in w)k in E||s(E,k,w[k]);else i(i.P+i.F*(h||C),t,w);return w}},6630:(e,t,n)=>{var r=n(2939)("iterator"),i=!1;try{var s=[7][r]();s.return=function(){i=!0},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var s=[7],o=s[r]();o.next=function(){return{done:n=!0}},s[r]=function(){return o},e(s)}catch(e){}return n}},5084:e=>{e.exports=function(e,t){return{value:t,done:!!e}}},5449:e=>{e.exports={}},6227:e=>{e.exports=!0},7177:(e,t,n)=>{var r=n(5730)("meta"),i=n(6727),s=n(7069),o=n(4743).f,a=0,c=Object.isExtensible||function(){return!0},u=!n(7929)((function(){return c(Object.preventExtensions({}))})),l=function(e){o(e,r,{value:{i:"O"+ ++a,w:{}}})},d=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,r)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!s(e,r)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return u&&d.NEED&&c(e)&&!s(e,r)&&l(e),e}}},5683:(e,t,n)=>{var r=n(4138),i=n(3856),s=n(250)("metadata"),o=s.store||(s.store=new(n(2982))),a=function(e,t,n){var i=o.get(e);if(!i){if(!n)return;o.set(e,i=new r)}var s=i.get(t);if(!s){if(!n)return;i.set(t,s=new r)}return s};e.exports={store:o,map:a,has:function(e,t,n){var r=a(t,n,!1);return void 0!==r&&r.has(e)},get:function(e,t,n){var r=a(t,n,!1);return void 0===r?void 0:r.get(e)},set:function(e,t,n,r){a(n,r,!0).set(e,t)},keys:function(e,t){var n=a(e,t,!1),r=[];return n&&n.forEach((function(e,t){r.push(t)})),r},key:function(e){return void 0===e||"symbol"==typeof e?e:String(e)},exp:function(e){i(i.S,"Reflect",e)}}},1601:(e,t,n)=>{var r=n(3938),i=n(2569).set,s=r.MutationObserver||r.WebKitMutationObserver,o=r.process,a=r.Promise,c="process"==n(2894)(o);e.exports=function(){var e,t,n,u=function(){var r,i;for(c&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){o.nextTick(u)};else if(!s||r.navigator&&r.navigator.standalone)if(a&&a.resolve){var l=a.resolve(void 0);n=function(){l.then(u)}}else n=function(){i.call(r,u)};else{var d=!0,h=document.createTextNode("");new s(u).observe(h,{characterData:!0}),n=function(){h.data=d=!d}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},9304:(e,t,n)=>{"use strict";var r=n(5663);function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},8082:(e,t,n)=>{"use strict";var r=n(9666),i=n(6162),s=n(8195),o=n(6274),a=n(6530),c=n(799),u=Object.assign;e.exports=!u||n(7929)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r}))?function(e,t){for(var n=a(e),u=arguments.length,l=1,d=s.f,h=o.f;u>l;)for(var p,f=c(arguments[l++]),m=d?i(f).concat(d(f)):i(f),g=m.length,y=0;g>y;)p=m[y++],r&&!h.call(f,p)||(n[p]=f[p]);return n}:u},8989:(e,t,n)=>{var r=n(2159),i=n(7856),s=n(3338),o=n(7281)("IE_PROTO"),a=function(){},c=function(){var e,t=n(7467)("iframe"),r=s.length;for(t.style.display="none",n(4881).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c.prototype[s[r]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=r(e),n=new a,a.prototype=null,n[o]=e):n=c(),void 0===t?n:i(n,t)}},4743:(e,t,n)=>{var r=n(2159),i=n(3758),s=n(3206),o=Object.defineProperty;t.f=n(9666)?Object.defineProperty:function(e,t,n){if(r(e),t=s(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},7856:(e,t,n)=>{var r=n(4743),i=n(2159),s=n(6162);e.exports=n(9666)?Object.defineProperties:function(e,t){i(e);for(var n,o=s(t),a=o.length,c=0;a>c;)r.f(e,n=o[c++],t[n]);return e}},6183:(e,t,n)=>{var r=n(6274),i=n(3101),s=n(7932),o=n(3206),a=n(7069),c=n(3758),u=Object.getOwnPropertyDescriptor;t.f=n(9666)?u:function(e,t){if(e=s(e),t=o(t,!0),c)try{return u(e,t)}catch(e){}if(a(e,t))return i(!r.f.call(e,t),e[t])}},4368:(e,t,n)=>{var r=n(7932),i=n(3230).f,s={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==s.call(e)?function(e){try{return i(e)}catch(e){return o.slice()}}(e):i(r(e))}},3230:(e,t,n)=>{var r=n(2963),i=n(3338).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},8195:(e,t)=>{t.f=Object.getOwnPropertySymbols},5089:(e,t,n)=>{var r=n(7069),i=n(6530),s=n(7281)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},2963:(e,t,n)=>{var r=n(7069),i=n(7932),s=n(7428)(!1),o=n(7281)("IE_PROTO");e.exports=function(e,t){var n,a=i(e),c=0,u=[];for(n in a)n!=o&&r(a,n)&&u.push(n);for(;t.length>c;)r(a,n=t[c++])&&(~s(u,n)||u.push(n));return u}},6162:(e,t,n)=>{var r=n(2963),i=n(3338);e.exports=Object.keys||function(e){return r(e,i)}},6274:(e,t)=>{t.f={}.propertyIsEnumerable},2584:(e,t,n)=>{var r=n(3856),i=n(4579),s=n(7929);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*s((function(){n(1)})),"Object",o)}},931:e=>{e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},7790:(e,t,n)=>{var r=n(2159),i=n(6727),s=n(9304);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=s.f(e);return(0,n.resolve)(t),n.promise}},3101:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},8144:(e,t,n)=>{var r=n(1818);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},7470:(e,t,n)=>{e.exports=n(1818)},6237:(e,t,n)=>{"use strict";var r=n(3856),i=n(5663),s=n(9216),o=n(5576);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,a,c=arguments[1];return i(this),(t=void 0!==c)&&i(c),null==e?new this:(n=[],t?(r=0,a=s(c,arguments[2],2),o(e,!1,(function(e){n.push(a(e,r++))}))):o(e,!1,n.push,n),new this(n))}})}},6730:(e,t,n)=>{"use strict";var r=n(3856);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},2906:(e,t,n)=>{var r=n(6727),i=n(2159),s=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(9216)(Function.call,n(6183).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return s(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:s}},9967:(e,t,n)=>{"use strict";var r=n(3938),i=n(4579),s=n(4743),o=n(9666),a=n(2939)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];o&&t&&!t[a]&&s.f(t,a,{configurable:!0,get:function(){return this}})}},5378:(e,t,n)=>{var r=n(4743).f,i=n(7069),s=n(2939)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,s)&&r(e,s,{configurable:!0,value:t})}},7281:(e,t,n)=>{var r=n(250)("keys"),i=n(5730);e.exports=function(e){return r[e]||(r[e]=i(e))}},250:(e,t,n)=>{var r=n(4579),i=n(3938),s="__core-js_shared__",o=i[s]||(i[s]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(6227)?"pure":"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})},2707:(e,t,n)=>{var r=n(2159),i=n(5663),s=n(2939)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[s])?t:i(n)}},510:(e,t,n)=>{var r=n(1052),i=n(8333);e.exports=function(e){return function(t,n){var s,o,a=String(i(t)),c=r(n),u=a.length;return c<0||c>=u?e?"":void 0:(s=a.charCodeAt(c))<55296||s>56319||c+1===u||(o=a.charCodeAt(c+1))<56320||o>57343?e?a.charAt(c):s:e?a.slice(c,c+2):o-56320+(s-55296<<10)+65536}}},2569:(e,t,n)=>{var r,i,s,o=n(9216),a=n(6778),c=n(4881),u=n(7467),l=n(3938),d=l.process,h=l.setImmediate,p=l.clearImmediate,f=l.MessageChannel,m=l.Dispatch,g=0,y={},v="onreadystatechange",b=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},w=function(e){b.call(e.data)};h&&p||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return y[++g]=function(){a("function"==typeof e?e:Function(e),t)},r(g),g},p=function(e){delete y[e]},"process"==n(2894)(d)?r=function(e){d.nextTick(o(b,e,1))}:m&&m.now?r=function(e){m.now(o(b,e,1))}:f?(s=(i=new f).port2,i.port1.onmessage=w,r=o(s.postMessage,s,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",w,!1)):r=v in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),b.call(e)}}:function(e){setTimeout(o(b,e,1),0)}),e.exports={set:h,clear:p}},6531:(e,t,n)=>{var r=n(1052),i=Math.max,s=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):s(e,t)}},1052:e=>{var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},7932:(e,t,n)=>{var r=n(799),i=n(8333);e.exports=function(e){return r(i(e))}},8728:(e,t,n)=>{var r=n(1052),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},6530:(e,t,n)=>{var r=n(8333);e.exports=function(e){return Object(r(e))}},3206:(e,t,n)=>{var r=n(6727);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},5730:e=>{var t=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+n).toString(36))}},6640:(e,t,n)=>{var r=n(3938).navigator;e.exports=r&&r.userAgent||""},765:(e,t,n)=>{var r=n(6727);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},6347:(e,t,n)=>{var r=n(3938),i=n(4579),s=n(6227),o=n(5103),a=n(4743).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=s?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:o.f(e)})}},5103:(e,t,n)=>{t.f=n(2939)},2939:(e,t,n)=>{var r=n(250)("wks"),i=n(5730),s=n(3938).Symbol,o="function"==typeof s;(e.exports=function(e){return r[e]||(r[e]=o&&s[e]||(o?s:i)("Symbol."+e))}).store=r},3728:(e,t,n)=>{var r=n(4677),i=n(2939)("iterator"),s=n(5449);e.exports=n(4579).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||s[r(e)]}},6459:(e,t,n)=>{var r=n(2159),i=n(3728);e.exports=n(4579).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},9553:(e,t,n)=>{var r=n(4677),i=n(2939)("iterator"),s=n(5449);e.exports=n(4579).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||s.hasOwnProperty(r(t))}},2586:(e,t,n)=>{"use strict";var r=n(9216),i=n(3856),s=n(6530),o=n(5602),a=n(5991),c=n(8728),u=n(2445),l=n(3728);i(i.S+i.F*!n(6630)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,d,h=s(e),p="function"==typeof this?this:Array,f=arguments.length,m=f>1?arguments[1]:void 0,g=void 0!==m,y=0,v=l(h);if(g&&(m=r(m,f>2?arguments[2]:void 0,2)),null==v||p==Array&&a(v))for(n=new p(t=c(h.length));t>y;y++)u(n,y,g?m(h[y],y):h[y]);else for(d=v.call(h),n=new p;!(i=d.next()).done;y++)u(n,y,g?o(d,m,[i.value,y],!0):i.value);return n.length=y,n}})},3882:(e,t,n)=>{"use strict";var r=n(9003),i=n(5084),s=n(5449),o=n(7932);e.exports=n(5700)(Array,"Array",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),s.Arguments=s.Array,r("keys"),r("values"),r("entries")},4138:(e,t,n)=>{"use strict";var r=n(6175),i=n(765),s="Map";e.exports=n(2269)(s,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,s),e);return t&&t.v},set:function(e,t){return r.def(i(this,s),0===e?0:e,t)}},r,!0)},9846:(e,t,n)=>{var r=n(3856);r(r.S,"Number",{isInteger:n(6732)})},2699:(e,t,n)=>{var r=n(3856);r(r.S+r.F,"Object",{assign:n(8082)})},6760:(e,t,n)=>{var r=n(3856);r(r.S,"Object",{create:n(8989)})},1477:(e,t,n)=>{var r=n(3856);r(r.S+r.F*!n(9666),"Object",{defineProperty:n(4743).f})},5178:(e,t,n)=>{var r=n(7932),i=n(6183).f;n(2584)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},7220:(e,t,n)=>{var r=n(6530),i=n(5089);n(2584)("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},961:(e,t,n)=>{var r=n(6530),i=n(6162);n(2584)("keys",(function(){return function(e){return i(r(e))}}))},9349:(e,t,n)=>{var r=n(3856);r(r.S,"Object",{setPrototypeOf:n(2906).set})},4058:()=>{},2878:(e,t,n)=>{"use strict";var r,i,s,o,a=n(6227),c=n(3938),u=n(9216),l=n(4677),d=n(3856),h=n(6727),p=n(5663),f=n(9142),m=n(5576),g=n(2707),y=n(2569).set,v=n(1601)(),b=n(9304),w=n(931),k=n(6640),_=n(7790),S="Promise",T=c.TypeError,x=c.process,C=x&&x.versions,E=C&&C.v8||"",I=c.Promise,M="process"==l(x),P=function(){},O=i=b.f,R=!!function(){try{var e=I.resolve(1),t=(e.constructor={})[n(2939)("species")]=function(e){e(P,P)};return(M||"function"==typeof PromiseRejectionEvent)&&e.then(P)instanceof t&&0!==E.indexOf("6.6")&&-1===k.indexOf("Chrome/66")}catch(e){}}(),j=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},N=function(e,t){if(!e._n){e._n=!0;var n=e._c;v((function(){for(var r=e._v,i=1==e._s,s=0,o=function(t){var n,s,o,a=i?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{a?(i||(2==e._h&&D(e),e._h=1),!0===a?n=r:(l&&l.enter(),n=a(r),l&&(l.exit(),o=!0)),n===t.promise?u(T("Promise-chain cycle")):(s=j(n))?s.call(n,c,u):c(n)):u(r)}catch(e){l&&!o&&l.exit(),u(e)}};n.length>s;)o(n[s++]);e._c=[],e._n=!1,t&&!e._h&&L(e)}))}},L=function(e){y.call(c,(function(){var t,n,r,i=e._v,s=U(e);if(s&&(t=w((function(){M?x.emit("unhandledRejection",i,e):(n=c.onunhandledrejection)?n({promise:e,reason:i}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=M||U(e)?2:1),e._a=void 0,s&&t.e)throw t.v}))},U=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){y.call(c,(function(){var t;M?x.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},A=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),N(t,!0))},F=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw T("Promise can't be resolved itself");(t=j(e))?v((function(){var r={_w:n,_d:!1};try{t.call(e,u(F,r,1),u(A,r,1))}catch(e){A.call(r,e)}})):(n._v=e,n._s=1,N(n,!1))}catch(e){A.call({_w:n,_d:!1},e)}}};R||(I=function(e){f(this,I,S,"_h"),p(e),r.call(this);try{e(u(F,this,1),u(A,this,1))}catch(e){A.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(8144)(I.prototype,{then:function(e,t){var n=O(g(this,I));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=M?x.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&N(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),s=function(){var e=new r;this.promise=e,this.resolve=u(F,e,1),this.reject=u(A,e,1)},b.f=O=function(e){return e===I||e===o?new s(e):i(e)}),d(d.G+d.W+d.F*!R,{Promise:I}),n(5378)(I,S),n(9967)(S),o=n(4579).Promise,d(d.S+d.F*!R,S,{reject:function(e){var t=O(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(a||!R),S,{resolve:function(e){return _(a&&this===o?I:this,e)}}),d(d.S+d.F*!(R&&n(6630)((function(e){I.all(e).catch(P)}))),S,{all:function(e){var t=this,n=O(t),r=n.resolve,i=n.reject,s=w((function(){var n=[],s=0,o=1;m(e,!1,(function(e){var a=s++,c=!1;n.push(void 0),o++,t.resolve(e).then((function(e){c||(c=!0,n[a]=e,--o||r(n))}),i)})),--o||r(n)}));return s.e&&i(s.v),n.promise},race:function(e){var t=this,n=O(t),r=n.reject,i=w((function(){m(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},9650:(e,t,n)=>{var r=n(3856),i=n(8989),s=n(5663),o=n(2159),a=n(6727),c=n(7929),u=n(4094),l=(n(3938).Reflect||{}).construct,d=c((function(){function e(){}return!(l((function(){}),[],e)instanceof e)})),h=!c((function(){l((function(){}))}));r(r.S+r.F*(d||h),"Reflect",{construct:function(e,t){s(e),o(t);var n=arguments.length<3?e:s(arguments[2]);if(h&&!d)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(u.apply(e,r))}var c=n.prototype,p=i(a(c)?c:Object.prototype),f=Function.apply.call(e,p,t);return a(f)?f:p}})},1003:(e,t,n)=>{"use strict";var r=n(6175),i=n(765);e.exports=n(2269)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},1867:(e,t,n)=>{"use strict";var r=n(510)(!0);n(5700)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},6840:(e,t,n)=>{"use strict";var r=n(3938),i=n(7069),s=n(9666),o=n(3856),a=n(7470),c=n(7177).KEY,u=n(7929),l=n(250),d=n(5378),h=n(5730),p=n(2939),f=n(5103),m=n(6347),g=n(337),y=n(1421),v=n(2159),b=n(6727),w=n(6530),k=n(7932),_=n(3206),S=n(3101),T=n(8989),x=n(4368),C=n(6183),E=n(8195),I=n(4743),M=n(6162),P=C.f,O=I.f,R=x.f,j=r.Symbol,N=r.JSON,L=N&&N.stringify,U=p("_hidden"),D=p("toPrimitive"),A={}.propertyIsEnumerable,F=l("symbol-registry"),q=l("symbols"),B=l("op-symbols"),$=Object.prototype,W="function"==typeof j&&!!E.f,z=r.QObject,H=!z||!z.prototype||!z.prototype.findChild,J=s&&u((function(){return 7!=T(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=P($,t);r&&delete $[t],O(e,t,n),r&&e!==$&&O($,t,r)}:O,K=function(e){var t=q[e]=T(j.prototype);return t._k=e,t},G=W&&"symbol"==typeof j.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof j},Q=function(e,t,n){return e===$&&Q(B,t,n),v(e),t=_(t,!0),v(n),i(q,t)?(n.enumerable?(i(e,U)&&e[U][t]&&(e[U][t]=!1),n=T(n,{enumerable:S(0,!1)})):(i(e,U)||O(e,U,S(1,{})),e[U][t]=!0),J(e,t,n)):O(e,t,n)},V=function(e,t){v(e);for(var n,r=g(t=k(t)),i=0,s=r.length;s>i;)Q(e,n=r[i++],t[n]);return e},X=function(e){var t=A.call(this,e=_(e,!0));return!(this===$&&i(q,e)&&!i(B,e))&&(!(t||!i(this,e)||!i(q,e)||i(this,U)&&this[U][e])||t)},Y=function(e,t){if(e=k(e),t=_(t,!0),e!==$||!i(q,t)||i(B,t)){var n=P(e,t);return!n||!i(q,t)||i(e,U)&&e[U][t]||(n.enumerable=!0),n}},Z=function(e){for(var t,n=R(k(e)),r=[],s=0;n.length>s;)i(q,t=n[s++])||t==U||t==c||r.push(t);return r},ee=function(e){for(var t,n=e===$,r=R(n?B:k(e)),s=[],o=0;r.length>o;)!i(q,t=r[o++])||n&&!i($,t)||s.push(q[t]);return s};W||(a((j=function(){if(this instanceof j)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===$&&t.call(B,n),i(this,U)&&i(this[U],e)&&(this[U][e]=!1),J(this,e,S(1,n))};return s&&H&&J($,e,{configurable:!0,set:t}),K(e)}).prototype,"toString",(function(){return this._k})),C.f=Y,I.f=Q,n(3230).f=x.f=Z,n(6274).f=X,E.f=ee,s&&!n(6227)&&a($,"propertyIsEnumerable",X,!0),f.f=function(e){return K(p(e))}),o(o.G+o.W+o.F*!W,{Symbol:j});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)p(te[ne++]);for(var re=M(p.store),ie=0;re.length>ie;)m(re[ie++]);o(o.S+o.F*!W,"Symbol",{for:function(e){return i(F,e+="")?F[e]:F[e]=j(e)},keyFor:function(e){if(!G(e))throw TypeError(e+" is not a symbol!");for(var t in F)if(F[t]===e)return t},useSetter:function(){H=!0},useSimple:function(){H=!1}}),o(o.S+o.F*!W,"Object",{create:function(e,t){return void 0===t?T(e):V(T(e),t)},defineProperty:Q,defineProperties:V,getOwnPropertyDescriptor:Y,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});var se=u((function(){E.f(1)}));o(o.S+o.F*se,"Object",{getOwnPropertySymbols:function(e){return E.f(w(e))}}),N&&o(o.S+o.F*(!W||u((function(){var e=j();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(b(t)||void 0!==e)&&!G(e))return y(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!G(t))return t}),r[1]=t,L.apply(N,r)}}),j.prototype[D]||n(1818)(j.prototype,D,j.prototype.valueOf),d(j,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},2982:(e,t,n)=>{"use strict";var r,i=n(3938),s=n(1523)(0),o=n(7470),a=n(7177),c=n(8082),u=n(106),l=n(6727),d=n(765),h=n(765),p=!i.ActiveXObject&&"ActiveXObject"in i,f="WeakMap",m=a.getWeak,g=Object.isExtensible,y=u.ufstore,v=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},b={get:function(e){if(l(e)){var t=m(e);return!0===t?y(d(this,f)).get(e):t?t[this._i]:void 0}},set:function(e,t){return u.def(d(this,f),e,t)}},w=e.exports=n(2269)(f,v,b,u,!0,!0);h&&p&&(c((r=u.getConstructor(v,f)).prototype,b),a.NEED=!0,s(["delete","has","get","set"],(function(e){var t=w.prototype,n=t[e];o(t,e,(function(t,i){if(l(t)&&!g(t)){this._f||(this._f=new r);var s=this._f[e](t,i);return"set"==e?this:s}return n.call(this,t,i)}))})))},5828:(e,t,n)=>{n(6237)("Map")},605:(e,t,n)=>{n(6730)("Map")},2834:(e,t,n)=>{var r=n(3856);r(r.P+r.R,"Map",{toJSON:n(1718)("Map")})},5971:(e,t,n)=>{"use strict";var r=n(3856),i=n(4579),s=n(3938),o=n(2707),a=n(7790);r(r.P+r.R,"Promise",{finally:function(e){var t=o(this,i.Promise||s.Promise),n="function"==typeof e;return this.then(n?function(n){return a(t,e()).then((function(){return n}))}:e,n?function(n){return a(t,e()).then((function(){throw n}))}:e)}})},2526:(e,t,n)=>{"use strict";var r=n(3856),i=n(9304),s=n(931);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=s(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},630:(e,t,n)=>{var r=n(5683),i=n(2159),s=n(5663),o=r.key,a=r.set;r.exp({metadata:function(e,t){return function(n,r){a(e,t,(void 0!==r?i:s)(n),o(r))}}})},9806:(e,t,n)=>{n(6237)("Set")},1749:(e,t,n)=>{n(6730)("Set")},8408:(e,t,n)=>{var r=n(3856);r(r.P+r.R,"Set",{toJSON:n(1718)("Set")})},8174:(e,t,n)=>{n(6347)("asyncIterator")},6461:(e,t,n)=>{n(6347)("observable")},3871:(e,t,n)=>{n(3882);for(var r=n(3938),i=n(1818),s=n(5449),o=n(2939)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var u=a[c],l=r[u],d=l&&l.prototype;d&&!d[o]&&i(d,o,u),s[u]=s.Array}},3283:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,".chat-box{position:absolute;right:20px;bottom:0;background:#fff;width:300px}.chat-box,.chat-head{border-radius:5px 5px 0 0}.chat-head{width:inherit;height:45px;background:#2c3e50}.chat-head h2{color:#fff;padding:8px;display:inline-block;margin:0}.chat-head img{cursor:pointer;float:right;width:25px;margin:10px}.chat-body{height:355px;width:inherit;overflow:auto;margin-bottom:45px;background-color:beige}.chat-text{position:fixed;bottom:0;height:45px;width:inherit}.chat-text textarea{width:inherit;height:inherit;box-sizing:border-box;border:1px solid #bdc3c7;padding:10px;resize:none}.chat-text textarea:active,.chat-text textarea:focus,.chat-text textarea:hover{border-color:#4169e1}textarea{resize:none}",""]);const s=i},7846:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,'.msg-send{background:#2ecc71}.msg-receive{background:#3498db}.msg-receive,.msg-send{width:200px;height:35px;padding:5px 5px 5px 10px;margin:10px auto;border-radius:3px;line-height:30px;position:relative;color:#fff}.msg-receive:before{border:15px solid transparent;border-right-color:#3498db;left:-29px}.msg-receive:before,.msg-send:after{content:"";width:0;height:0;position:absolute;top:7px}.msg-send:after{border:15px solid transparent;border-left-color:#2ecc71;right:-29px}.msg-receive:hover,.msg-send:hover{opacity:.9}',""]);const s=i},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(r)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(i[o]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);r&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},7187:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function i(){void 0!==s&&e.removeListener("error",s),n([].slice.call(arguments))}var s;"error"!==t&&(s=function(n){e.removeListener(t,i),r(n)},e.once("error",s)),e.once(t,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,s,o,u;if(a(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=f(c,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,s,o;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},2604:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=["weeks","years","months","days","hours","minutes","seconds"],r=Object.freeze({years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0}),i=t.pattern=new RegExp("P(?:(\\d+(?:[\\.,]\\d+)?W)|(\\d+(?:[\\.,]\\d+)?Y)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?D)?(?:T(\\d+(?:[\\.,]\\d+)?H)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?S)?)?)"),s=t.parse=function(e){return e.match(i).slice(1).reduce((function(e,t,r){return e[n[r]]=parseFloat(t)||0,e}),{})},o=t.end=function(e,t){e=Object.assign({},r,e);var n=t?t.getTime():Date.now(),i=new Date(n);return i.setFullYear(i.getFullYear()+e.years),i.setMonth(i.getMonth()+e.months),i.setDate(i.getDate()+e.days),i.setHours(i.getHours()+e.hours),i.setMinutes(i.getMinutes()+e.minutes),i.setMilliseconds(i.getMilliseconds()+1e3*e.seconds),i.setDate(i.getDate()+7*e.weeks),i},a=t.toSeconds=function(e,t){e=Object.assign({},r,e);var n=t?t.getTime():Date.now(),i=new Date(n);return(o(e,i).getTime()-i.getTime())/1e3};t.default={end:o,toSeconds:a,pattern:i,parse:s}},204:(e,t,n)=>{e.exports=self.fetch||(self.fetch=n(5869).default||n(5869))},4907:function(e){var t;t=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i;for(n=1;n<arguments.length;n++)for(i in r=arguments[n])r.hasOwnProperty(i)&&(e[i]=r[i]);return e}},function(e,t,n){"use strict";var r=n(0);e.exports={build:function(e,t){var n,i,s,o=t.plugins;for(n=0,i=o.length;n<i;n++)(s=o[n]).methods&&r(e,s.methods),s.properties&&Object.defineProperties(e,s.properties)},hook:function(e,t,n){var r,i,s,o,a=e.config.plugins,c=[e.context];for(n&&(c=c.concat(n)),r=0,i=a.length;r<i;r++)o=a[r],(s=a[r][t])&&s.apply(o,c)}}},function(e,t,n){"use strict";function r(e){if(0===e.length)return e;var t,n,r=e.split(/[_-]/);if(1===r.length&&r[0][0].toLowerCase()===r[0][0])return e;for(n=r[0].toLowerCase(),t=1;t<r.length;t++)n=n+r[t].charAt(0).toUpperCase()+r[t].substring(1).toLowerCase();return n}r.prepended=function(e,t){return e+(t=r(t))[0].toUpperCase()+t.substring(1)},e.exports=r},function(e,t,n){"use strict";var r=n(0),i=n(2);function s(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}r(s.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,r=e.to;return this.addState(n),"function"!=typeof r&&this.addState(r),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(r({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(r({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,r,i;for(n=0,r=(e=e||[]).length;n<r;n++)"function"==typeof(i=e[n])&&(e[n]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,n,r,i,s,o=this.defaults.wildcard;for(n=0;n<e.length;n++)for(r=e[n],i=Array.isArray(r.from)?r.from:[r.from||o],s=r.to||o,t=0;t<i.length;t++)this.mapTransition({name:r.name,from:i[t],to:s})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=s},function(e,t,n){var r=n(0),i=n(6),s=n(1),o=[null,[]];function a(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}r(a.prototype,{init:function(e){if(r(this.context,this.config.data.apply(this.context,e)),s.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,r=this.config.transitionFor(this.state,e),i=r&&r.to;return"function"==typeof i?i.apply(this.context,t):i===n?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,r){var i=this.config.lifecycle,s=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),r.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),s?this.observersForEvent(i.onLeave.state):o,s?this.observersForEvent(i.onLeave[t]):o,this.observersForEvent(i.on.transition),s?["doTransit",[this]]:o,s?this.observersForEvent(i.onEnter.state):o,s?this.observersForEvent(i.onEnter[n]):o,s?this.observersForEvent(i.on[n]):o,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],r)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,r=this.observers.length,i=[];n<r;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,n,r){if(0===e.length)return this.endTransit(void 0===r||r);var i=e[0][0],o=e[0][1],a=e[0][2];if(t[0].event=i,i&&a&&i!==n&&s.hook(this,"lifecycle",t),0===o.length)return e.shift(),this.observeEvents(e,t,i,r);var c=o.shift(),u=c[i].apply(c,t);return u&&"function"==typeof u.then?u.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===u?this.endTransit(!1):this.observeEvents(e,t,i,u)},onInvalidTransition:function(e,t,n){throw new i("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new i("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=a},function(e,t,n){"use strict";var r=n(0),i=n(2),s=n(1),o=n(3),a=n(4),c={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},u={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return d(this||{},e)}function d(e,t){return h(e,new o(t,l)),e._fsm(),e}function h(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");s.build(e,t),Object.defineProperties(e,u),r(e,c),r(e,t.methods),t.allTransitions().forEach((function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}})),e._fsm=function(){this._fsm=new a(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new o(t,l);return h(e.prototype,n),e.prototype._fsm.config=n,e},l.apply=d,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,n){"use strict";e.exports=function(e,t,n,r,i){this.message=e,this.transition=t,this.from=n,this.to=r,this.current=i}}])},e.exports=t()},2043:function(e,t,n){var r,i;!function(s,o){"use strict";void 0===(i="function"==typeof(r=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?s:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function a(t,n){for(var i=0;i<r.length;i++){var s=r[i];this[s]=i<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function c(e,n,r){return function(){typeof console!==t&&(a.call(this,n,r),this[e].apply(this,arguments))}}function u(e,t,n){return o(e)||c.apply(this,arguments)}function l(e,n,i){var s,o=this,c="loglevel";function l(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+n+";"}catch(e){}}}function d(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(c)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=i||u,o.getLevel=function(){return s},o.setLevel=function(n,r){if("string"==typeof n&&void 0!==o.levels[n.toUpperCase()]&&(n=o.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==r&&l(n),a.call(o,n,e),typeof console===t&&n<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){d()||o.setLevel(e,!1)},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var h=d();null==h&&(h=null==n?"WARN":n),o.setLevel(h,!1)}var d=new l,h={};d.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new l(e,d.getLevel(),d.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=p),d},d.getLoggers=function(){return h},d.default=d,d})?r.call(t,n,t,e):r)||(e.exports=i)}()},796:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7187);function i(e){return null!=e}class s extends r.EventEmitter{constructor(e){if(super(),i((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(i(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(i(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(i(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(this.initialDelay=e.initialDelay||100,this.maxDelay=e.maxDelay||1e4,this.maxDelay<=this.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");this.randomisationFactor=e.randomisationFactor||0,this.factor=e.factor||2,this.maxNumberOfRetry=-1,this.reset()}static exponential(e){return new s(e)}backoff(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}reset(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}failAfter(e){if(e<=0)throw new Error(`Expected a maximum number of retry greater than 0 but got ${e}`);this.maxNumberOfRetry=e}next(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;let e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}onBackoff(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}t.Backoff=s,t.default=s},9948:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7723);t.Retrier=r.Retrier;const i=n(796);t.Backoff=i.Backoff,t.default=r.Retrier},7723:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7187);class i extends r.EventEmitter{constructor(e){super(),this.minDelay=e.min,this.maxDelay=e.max,this.initialDelay=e.initial||0,this.maxAttemptsCount=e.maxAttemptsCount||0,this.maxAttemptsTime=e.maxAttemptsTime||0,this.randomness=e.randomness||0,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}attempt(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}nextDelay(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;let t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}randomize(e){let t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}scheduleAttempt(e){if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));let t=this.nextDelay(e);if(t=this.randomize(t),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+t)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((()=>this.attempt()),t)}cleanup(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}start(){if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise(((e,t)=>{this.resolve=e,this.reject=t,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}))}cancel(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}succeeded(e){this.emit("succeeded",e),this.resolve(e)}failed(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}run(e){return this.on("attempt",(()=>{e().then((e=>this.succeeded(e))).catch((e=>this.failed(e)))})),this.start()}}t.Retrier=i,t.default=i},1795:function(e,t,n){var r;e=n.nmd(e),function(){"use strict";var i={function:!0,object:!0},s=i[typeof window]&&window||this,o=i[typeof t]&&t,a=i.object&&e&&!e.nodeType&&e,c=o&&a&&"object"==typeof n.g&&n.g;!c||c.global!==c&&c.window!==c&&c.self!==c||(s=c);var u=Math.pow(2,53)-1,l=/\bOpera/,d=Object.prototype,h=d.hasOwnProperty,p=d.toString;function f(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function m(e){return e=w(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:f(e)}function g(e,t){for(var n in e)h.call(e,n)&&t(e[n],n,e)}function y(e){return null==e?f(e):p.call(e).slice(8,-1)}function v(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function b(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=u)for(;++n<r;)t(e[n],n,e);else g(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function w(e){return String(e).replace(/^ +| +$/g,"")}var k=function e(t){var n=s,r=t&&"object"==typeof t&&"String"!=y(t);r&&(n=t,t=null);var i=n.navigator||{},o=i.userAgent||"";t||(t=o);var a,c,u,d,h,f=r?!!i.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(p.toString()),k="Object",_=r?k:"ScriptBridgingProxyObject",S=r?k:"Environment",T=r&&n.java?"JavaPackage":y(n.java),x=r?k:"RuntimeObject",C=/\bJava/.test(T)&&n.java,E=C&&y(n.environment)==S,I=C?"a":"Î±",M=C?"b":"Î²",P=n.document||{},O=n.operamini||n.opera,R=l.test(R=r&&O?O["[[Class]]"]:y(O))?R:O=null,j=t,N=[],L=null,U=t==o,D=U&&O&&"function"==typeof O.version&&O.version(),A=b([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||v(n))+"\\b","i").exec(t)&&(n.label||n)})),F=function(e){return b(e,(function(e,n){return e||RegExp("\\b"+(n.pattern||v(n))+"\\b","i").exec(t)&&(n.label||n)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),q=W([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),B=function(e){return b(e,(function(e,n,r){return e||(n[q]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(q)]||RegExp("\\b"+v(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),$=function(e){return b(e,(function(e,n){var r=n.pattern||v(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),m(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function W(e){return b(e,(function(e,n){var r=n.pattern||v(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=m(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function z(e){return b(e,(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(A&&(A=[A]),/\bAndroid\b/.test($)&&!q&&(a=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(q=w(a[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),B&&!q?q=W([B]):B&&q&&(q=q.replace(RegExp("^("+v(B)+")[-_.\\s]","i"),B+" ").replace(RegExp("^("+v(B)+")[-_.]?(\\w)","i"),B+" $2")),(a=/\bGoogle TV\b/.exec(q))&&(q=a[0]),/\bSimulator\b/i.test(t)&&(q=(q?q+" ":"")+"Simulator"),"Opera Mini"==F&&/\bOPiOS\b/.test(t)&&N.push("running in Turbo/Uncompressed mode"),"IE"==F&&/\blike iPhone OS\b/.test(t)?(B=(a=e(t.replace(/like iPhone OS/,""))).manufacturer,q=a.product):/^iP/.test(q)?(F||(F="Safari"),$="iOS"+((a=/ OS ([\d_]+)/i.exec(t))?" "+a[1].replace(/_/g,"."):"")):"Konqueror"==F&&/^Linux\b/i.test($)?$="Kubuntu":B&&"Google"!=B&&(/Chrome/.test(F)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(q))||/\bAndroid\b/.test($)&&/^Chrome/.test(F)&&/\bVersion\//i.test(t)?(F="Android Browser",$=/\bAndroid\b/.test($)?$:"Android"):"Silk"==F?(/\bMobi/i.test(t)||($="Android",N.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&N.unshift("accelerated")):"UC Browser"==F&&/\bUCWEB\b/.test(t)?N.push("speed mode"):"PaleMoon"==F&&(a=/\bFirefox\/([\d.]+)\b/.exec(t))?N.push("identifying as Firefox "+a[1]):"Firefox"==F&&(a=/\b(Mobile|Tablet|TV)\b/i.exec(t))?($||($="Firefox OS"),q||(q=a[1])):!F||(a=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(F))?(F&&!q&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(a+"/")+8))&&(F=null),(a=q||B||$)&&(q||B||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test($))&&(F=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test($)?$:a)+" Browser")):"Electron"==F&&(a=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&N.push("Chromium "+a),D||(D=z(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",v(F),"(?:Firefox|Minefield|NetFront)"])),(a=("iCab"==A&&parseFloat(D)>3?"WebKit":/\bOpera\b/.test(F)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(A)&&"WebKit"||!A&&/\bMSIE\b/i.test(t)&&("Mac OS"==$?"Tasman":"Trident")||"WebKit"==A&&/\bPlayStation\b(?! Vita\b)/i.test(F)&&"NetFront")&&(A=[a]),"IE"==F&&(a=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(F+=" Mobile",$="Windows Phone "+(/\+$/.test(a)?a:a+".x"),N.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(F="IE Mobile",$="Windows Phone 8.x",N.unshift("desktop mode"),D||(D=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=F&&"Trident"==A&&(a=/\brv:([\d.]+)/.exec(t))&&(F&&N.push("identifying as "+F+(D?" "+D:"")),F="IE",D=a[1]),U){if(d="global",h=null!=(u=n)?typeof u[d]:"number",/^(?:boolean|number|string|undefined)$/.test(h)||"object"==h&&!u[d])y(a=n.runtime)==_?(F="Adobe AIR",$=a.flash.system.Capabilities.os):y(a=n.phantom)==x?(F="PhantomJS",D=(a=a.version||null)&&a.major+"."+a.minor+"."+a.patch):"number"==typeof P.documentMode&&(a=/\bTrident\/(\d+)/i.exec(t))?(D=[D,P.documentMode],(a=+a[1]+4)!=D[1]&&(N.push("IE "+D[1]+" mode"),A&&(A[1]=""),D[1]=a),D="IE"==F?String(D[1].toFixed(1)):D[0]):"number"==typeof P.documentMode&&/^(?:Chrome|Firefox)\b/.test(F)&&(N.push("masking as "+F+" "+D),F="IE",D="11.0",A=["Trident"],$="Windows");else if(C&&(j=(a=C.lang.System).getProperty("os.arch"),$=$||a.getProperty("os.name")+" "+a.getProperty("os.version")),E){try{D=n.require("ringo/engine").version.join("."),F="RingoJS"}catch(e){(a=n.system)&&a.global.system==n.system&&(F="Narwhal",$||($=a[0].os||null))}F||(F="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(a=n.process)&&("object"==typeof a.versions&&("string"==typeof a.versions.electron?(N.push("Node "+a.versions.node),F="Electron",D=a.versions.electron):"string"==typeof a.versions.nw&&(N.push("Chromium "+D,"Node "+a.versions.node),F="NW.js",D=a.versions.nw)),F||(F="Node.js",j=a.arch,$=a.platform,D=(D=/[\d.]+/.exec(a.version))?D[0]:null));$=$&&m($)}if(D&&(a=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(D)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(U&&i.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(L=/b/i.test(a)?"beta":"alpha",D=D.replace(RegExp(a+"\\+?$"),"")+("beta"==L?M:I)+(/\d+\+?/.exec(a)||"")),"Fennec"==F||"Firefox"==F&&/\b(?:Android|Firefox OS|KaiOS)\b/.test($))F="Firefox Mobile";else if("Maxthon"==F&&D)D=D.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(q))"Xbox 360"==q&&($=null),"Xbox 360"==q&&/\bIEMobile\b/.test(t)&&N.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(F)&&(!F||q||/Browser|Mobi/.test(F))||"Windows CE"!=$&&!/Mobi/i.test(t))if("IE"==F&&U)try{null===n.external&&N.unshift("platform preview")}catch(e){N.unshift("embedded")}else(/\bBlackBerry\b/.test(q)||/\bBB10\b/.test(t))&&(a=(RegExp(q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||D)?($=((a=[a,/BB10/.test(t)])[1]?(q=null,B="BlackBerry"):"Device Software")+" "+a[0],D=null):this!=g&&"Wii"!=q&&(U&&O||/Opera/.test(F)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==F&&/\bOS X (?:\d+\.){2,}/.test($)||"IE"==F&&($&&!/^Win/.test($)&&D>5.5||/\bWindows XP\b/.test($)&&D>8||8==D&&!/\bTrident\b/.test(t)))&&!l.test(a=e.call(g,t.replace(l,"")+";"))&&a.name&&(a="ing as "+a.name+((a=a.version)?" "+a:""),l.test(F)?(/\bIE\b/.test(a)&&"Mac OS"==$&&($=null),a="identify"+a):(a="mask"+a,F=R?m(R.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(a)&&($=null),U||(D=null)),A=["Presto"],N.push(a));else F+=" Mobile";(a=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(a=[parseFloat(a.replace(/\.(\d)$/,".0$1")),a],"Safari"==F&&"+"==a[1].slice(-1)?(F="WebKit Nightly",L="alpha",D=a[1].slice(0,-1)):D!=a[1]&&D!=(a[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(D=null),a[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==a[0]&&537.36==a[2]&&parseFloat(a[1])>=28&&"WebKit"==A&&(A=["Blink"]),U&&(f||a[1])?(A&&(A[1]="like Chrome"),a=a[1]||((a=a[0])<530?1:a<532?2:a<532.05?3:a<533?4:a<534.03?5:a<534.07?6:a<534.1?7:a<534.13?8:a<534.16?9:a<534.24?10:a<534.3?11:a<535.01?12:a<535.02?"13+":a<535.07?15:a<535.11?16:a<535.19?17:a<536.05?18:a<536.1?19:a<537.01?20:a<537.11?"21+":a<537.13?23:a<537.18?24:a<537.24?25:a<537.36?26:"Blink"!=A?"27":"28")):(A&&(A[1]="like Safari"),a=(a=a[0])<400?1:a<500?2:a<526?3:a<533?4:a<534?"4+":a<535?5:a<537?6:a<538?7:a<601?8:a<602?9:a<604?10:a<606?11:a<608?12:"12"),A&&(A[1]+=" "+(a+="number"==typeof a?".x":/[.+]/.test(a)?"":"+")),"Safari"==F&&(!D||parseInt(D)>45)?D=a:"Chrome"==F&&/\bHeadlessChrome/i.test(t)&&N.unshift("headless")),"Opera"==F&&(a=/\bzbov|zvav$/.exec($))?(F+=" ",N.unshift("desktop mode"),"zvav"==a?(F+="Mini",D=null):F+="Mobile",$=$.replace(RegExp(" *"+a+"$"),"")):"Safari"==F&&/\bChrome\b/.exec(A&&A[1])?(N.unshift("desktop mode"),F="Chrome Mobile",D=null,/\bOS X\b/.test($)?(B="Apple",$="iOS 4.3+"):$=null):/\bSRWare Iron\b/.test(F)&&!D&&(D=z("Chrome")),D&&0==D.indexOf(a=/[\d.]+$/.exec($))&&t.indexOf("/"+a+"-")>-1&&($=w($.replace(a,""))),$&&-1!=$.indexOf(F)&&!RegExp(F+" OS").test($)&&($=$.replace(RegExp(" *"+v(F)+" *"),"")),A&&!/\b(?:Avant|Nook)\b/.test(F)&&(/Browser|Lunascape|Maxthon/.test(F)||"Safari"!=F&&/^iOS/.test($)&&/\bSafari\b/.test(A[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(F)&&A[1])&&(a=A[A.length-1])&&N.push(a),N.length&&(N=["("+N.join("; ")+")"]),B&&q&&q.indexOf(B)<0&&N.push("on "+B),q&&N.push((/^on /.test(N[N.length-1])?"":"on ")+q),$&&(a=/ ([\d.+]+)$/.exec($),c=a&&"/"==$.charAt($.length-a[0].length-1),$={architecture:32,family:a&&!c?$.replace(a[0],""):$,version:a?a[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(a=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(j))&&!/\bi686\b/i.test(j)?($&&($.architecture=64,$.family=$.family.replace(RegExp(" *"+a),"")),F&&(/\bWOW64\b/i.test(t)||U&&/\w(?:86|32)$/.test(i.cpuClass||i.platform)&&!/\bWin64; x64\b/i.test(t))&&N.unshift("32-bit")):$&&/^OS X/.test($.family)&&"Chrome"==F&&parseFloat(D)>=39&&($.architecture=64),t||(t=null);var H={};return H.description=t,H.layout=A&&A[0],H.manufacturer=B,H.name=F,H.prerelease=L,H.product=q,H.ua=t,H.version=F&&D,H.os=$||{architecture:null,family:null,version:null,toString:function(){return"null"}},H.parse=e,H.toString=function(){return this.description||""},H.version&&N.unshift(D),H.name&&N.unshift(F),$&&F&&($!=String($).split(" ")[0]||$!=F.split(" ")[0]&&!q)&&N.push(q?"("+$+")":"on "+$),N.length&&(H.description=N.join(" ")),H}();s.platform=k,void 0===(r=function(){return k}.call(t,n,t,e))||(e.exports=r)}.call(this)},9276:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.diffAny=t.diffObjects=t.diffArrays=t.intersection=t.subtract=t.isDestructive=void 0;var r=n(4950),i=n(3599);function s(e,t){var n={};for(var r in e)i.hasOwnProperty.call(e,r)&&void 0!==e[r]&&(n[r]=1);for(var s in t)i.hasOwnProperty.call(t,s)&&void 0!==t[s]&&delete n[s];return Object.keys(n)}function o(e){for(var t=e.length,n={},r=0;r<t;r++){var s=e[r];for(var o in s)i.hasOwnProperty.call(s,o)&&void 0!==s[o]&&(n[o]=(n[o]||0)+1)}for(var o in n)n[o]<t&&delete n[o];return Object.keys(n)}function a(e,t){return{operations:e.operations.concat(t),cost:e.cost+1}}function c(e,t,n,i){void 0===i&&(i=l);var s={"0,0":{operations:[],cost:0}};var o=isNaN(e.length)||e.length<=0?0:e.length,c=isNaN(t.length)||t.length<=0?0:t.length;return function n(i,o){var c=i+","+o,u=s[c];if(void 0===u){if(i>0&&o>0&&r.compare(e[i-1],t[o-1]))u=n(i-1,o-1);else{var l=[];if(i>0){var d=n(i-1,o),h={op:"remove",index:i-1};l.push(a(d,h))}if(o>0){var p=n(i,o-1),f={op:"add",index:i-1,value:t[o-1]};l.push(a(p,f))}if(i>0&&o>0){var m=n(i-1,o-1),g={op:"replace",index:i-1,original:e[i-1],value:t[o-1]};l.push(a(m,g))}u=l.sort((function(e,t){return e.cost-t.cost}))[0]}s[c]=u}return u}(o,c).operations.reduce((function(e,t){var r=e[0],s=e[1];if(function(e){return"add"===e.op}(t)){var a=t.index+1+s,c=a<o+s?String(a):"-",u={op:t.op,path:n.add(c).toString(),value:t.value};return[r.concat(u),s+1]}if(function(e){return"remove"===e.op}(t)){u={op:t.op,path:n.add(String(t.index+s)).toString()};return[r.concat(u),s-1]}var l=n.add(String(t.index+s)),d=i(t.original,t.value,l);return[r.concat.apply(r,d),s]}),[[],0])[0]}function u(e,t,n,r){void 0===r&&(r=l);var i=[];return s(e,t).forEach((function(e){i.push({op:"remove",path:n.add(e).toString()})})),s(t,e).forEach((function(e){i.push({op:"add",path:n.add(e).toString(),value:t[e]})})),o([e,t]).forEach((function(s){i.push.apply(i,r(e[s],t[s],n.add(s)))})),i}function l(e,t,n,r){if(void 0===r&&(r=l),e===t)return[];var s=i.objectType(e),o=i.objectType(t);return"array"==s&&"array"==o?c(e,t,n,r):"object"==s&&"object"==o?u(e,t,n,r):[{op:"replace",path:n.toString(),value:t}]}t.isDestructive=function(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t},t.subtract=s,t.intersection=o,t.diffArrays=c,t.diffObjects=u,t.diffAny=l},4950:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compare=void 0;var r=n(3599);function i(e,t){if(e===t)return!0;var n=r.objectType(e),s=r.objectType(t);return"array"==n&&"array"==s?function(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(!i(e[r],t[r]))return!1;return!0}(e,t):"object"==n&&"object"==s&&function(e,t){var n=Object.keys(e),s=Object.keys(t),o=n.length;if(o!==s.length)return!1;for(var a=0;a<o;a++){var c=n[a];if(!r.hasOwnProperty.call(t,c)||!i(e[c],t[c]))return!1}return!0}(e,t)}t.compare=i},3431:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTests=t.createPatch=t.applyPatch=void 0;var r=n(8424),i=n(3972),s=n(9276);function o(e,t){var n=r.Pointer.fromJSON(t).evaluate(e);if(void 0!==n)return{op:"test",path:t,value:n.value}}t.applyPatch=function(e,t){return t.map((function(t){return i.apply(e,t)}))},t.createPatch=function(e,t,n){var i=new r.Pointer;return(n?function(e){return function t(n,r,i){var o=e(n,r,i);return Array.isArray(o)?o:s.diffAny(n,r,i,t)}}(n):s.diffAny)(e,t,i)},t.createTests=function(e,t){var n=new Array;return t.filter(s.isDestructive).forEach((function(t){var r=o(e,t.path);if(r&&n.push(r),"from"in t){var i=o(e,t.from);i&&n.push(i)}})),n}},3972:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.apply=t.InvalidOperationError=t.test=t.copy=t.move=t.replace=t.remove=t.add=t.TestError=t.MissingError=void 0;var s=n(8424),o=n(3599),a=n(4950),c=function(e){function t(t){var n=e.call(this,"Value required at path: "+t)||this;return n.path=t,n.name="MissingError",n}return i(t,e),t}(Error);t.MissingError=c;var u=function(e){function t(t,n){var r=e.call(this,"Test failed: "+t+" != "+n)||this;return r.actual=t,r.expected=n,r.name="TestError",r}return i(t,e),t}(Error);function l(e,t,n){if(Array.isArray(e))if("-"==t)e.push(n);else{var r=parseInt(t,10);e.splice(r,0,n)}else e[t]=n}function d(e,t){if(Array.isArray(e)){var n=parseInt(t,10);e.splice(n,1)}else delete e[t]}function h(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.parent?new c(t.path):(l(n.parent,n.key,o.clone(t.value)),null)}function p(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.value?new c(t.path):(d(n.parent,n.key),null)}function f(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);if(null===n.parent)return new c(t.path);if(Array.isArray(n.parent)){if(parseInt(n.key,10)>=n.parent.length)return new c(t.path)}else if(void 0===n.value)return new c(t.path);return n.parent[n.key]=t.value,null}function m(e,t){var n=s.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new c(t.from);var r=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new c(t.path):(d(n.parent,n.key),l(r.parent,r.key,n.value),null)}function g(e,t){var n=s.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new c(t.from);var r=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new c(t.path):(l(r.parent,r.key,o.clone(n.value)),null)}function y(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);return a.compare(n.value,t.value)?null:new u(n.value,t.value)}t.TestError=u,t.add=h,t.remove=p,t.replace=f,t.move=m,t.copy=g,t.test=y;var v=function(e){function t(t){var n=e.call(this,"Invalid operation: "+t.op)||this;return n.operation=t,n.name="InvalidOperationError",n}return i(t,e),t}(Error);t.InvalidOperationError=v,t.apply=function(e,t){switch(t.op){case"add":return h(e,t);case"remove":return p(e,t);case"replace":return f(e,t);case"move":return m(e,t);case"copy":return g(e,t);case"test":return y(e,t)}return new v(t)}},8424:(e,t)=>{"use strict";function n(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function r(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(t,"__esModule",{value:!0}),t.Pointer=void 0;var i=function(){function e(e){void 0===e&&(e=[""]),this.tokens=e}return e.fromJSON=function(t){var r=t.split("/").map(n);if(""!==r[0])throw new Error("Invalid JSON Pointer: "+t);return new e(r)},e.prototype.toString=function(){return this.tokens.map(r).join("/")},e.prototype.evaluate=function(e){for(var t=null,n="",r=e,i=1,s=this.tokens.length;i<s;i++)r=((t=r)||{})[n=this.tokens[i]];return{parent:t,key:n,value:r}},e.prototype.get=function(e){return this.evaluate(e).value},e.prototype.set=function(e,t){for(var n=e,r=1,i=this.tokens.length-1,s=this.tokens[r];r<i;r++)n=(n||{})[s];n&&(n[this.tokens[this.tokens.length-1]]=t)},e.prototype.push=function(e){this.tokens.push(e)},e.prototype.add=function(t){return new e(this.tokens.concat(String(t)))},e}();t.Pointer=i},3599:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clone=t.objectType=t.hasOwnProperty=void 0,t.hasOwnProperty=Object.prototype.hasOwnProperty,t.objectType=function(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":typeof e},t.clone=function e(n){if(null==n||"object"!=typeof n)return n;if(n.constructor==Array){for(var r=n.length,i=new Array(r),s=0;s<r;s++)i[s]=e(n[s]);return i}var o={};for(var a in n)t.hasOwnProperty.call(n,a)&&(o[a]=e(n[a]));return o}},8352:(e,t,n)=>{"use strict";var r=_(n(8902)),i=_(n(6378)),s=_(n(5315)),o=_(n(9527)),a=_(n(4942)),c=_(n(6593)),u=_(n(6803)),l=_(n(2367)),d=_(n(3239)),h=_(n(2e3)),p=_(n(5105)),f=_(n(9663)),m=_(n(2600)),g=_(n(9135)),y=_(n(3196)),v=_(n(448)),b=_(n(2242)),w=_(n(2444)),k=_(n(8177));function _(e){return e&&e.__esModule?e:{default:e}}var S=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=(0,k.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,w.default)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&(0,b.default)(t,n,o),o},T=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,w.default)(Reflect))&&"function"==typeof v.default)return(0,v.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Channel=void 0;var x=n(7187),C=n(2126),E=n(9339),I=n(5434),M=n(8894),P=n(4081),O=n(1939),R=C.Logger.scope("Channel"),j={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName",state:"state"};function N(e){try{return new Date(e)}catch(e){return null}}var L=function(e){function t(e,n,r){(0,f.default)(this,t);var i=(0,g.default)(this,(t.__proto__||(0,p.default)(t)).call(this)),s=n.attributes||{},o=n.createdBy,a=N(n.dateCreated),c=N(n.dateUpdated),u=n.friendlyName||null,m=(0,h.default)(n.lastConsumedMessageIndex)?n.lastConsumedMessageIndex:null,y=n.uniqueName||null;try{(0,d.default)(s)}catch(e){throw new Error("Attributes must be a valid JSON object.")}return i.services=e,i.sid=r,i.entityName=n.channel,i.channelState={uniqueName:y,status:"notParticipating",type:n.type,attributes:s,createdBy:o,dateCreated:a,dateUpdated:c,friendlyName:u,lastConsumedMessageIndex:m},n.notificationLevel&&(i.channelState.notificationLevel=n.notificationLevel),i.members=new l.default,i.membersEntity=new E.Members(i,i.services,i.members),i.membersEntity.on("memberJoined",i.emit.bind(i,"memberJoined")),i.membersEntity.on("memberLeft",i.emit.bind(i,"memberLeft")),i.membersEntity.on("memberUpdated",(function(e){return i.emit("memberUpdated",e)})),i.messagesEntity=new M.Messages(i,e),i.messagesEntity.on("messageAdded",(function(e){return i._onMessageAdded(e)})),i.messagesEntity.on("messageUpdated",(function(e){return i.emit("messageUpdated",e)})),i.messagesEntity.on("messageRemoved",i.emit.bind(i,"messageRemoved")),i}var n,v,b,w,k,_,S,T,x,C,O,L,U,D,A,F,q,B,$,W,z,H,J,K,G,Q,V;return(0,y.default)(t,e),(0,m.default)(t,[{key:"_subscribe",value:function(){var e=this;return this.entityPromise?this.entityPromise:this.entityPromise=this.entityPromise||this.services.syncClient.document({id:this.entityName,mode:"open_existing"}).then((function(t){return e.entity=t,e.entity.on("updated",(function(t){e._update(t.value)})),e.entity.on("removed",(function(){return e.emit("removed",e)})),e._update(e.entity.value),t})).catch((function(t){throw e.entity=null,e.entityPromise=null,"disconnected"!=e.services.syncClient.connectionState&&R.error("Failed to get channel object",t),R.debug("ERROR: Failed to get channel object",t),t}))}},{key:"_subscribeStreams",value:(V=(0,u.default)(a.default.mark((function e(){var t,n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return R.trace("_subscribeStreams, this.entity.value=",this.entity.value),t=this.entity.value.messages,n=this.entity.value.roster,e.next=8,c.default.all([this.messagesEntity.subscribe(t),this.membersEntity.subscribe(n)]);case 8:e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(0),"disconnected"!==this.services.syncClient.connectionState&&R.error("Failed to subscribe on channel objects",this.sid,e.t0),R.debug("ERROR: Failed to subscribe on channel objects",this.sid,e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return V.apply(this,arguments)})},{key:"_unsubscribe",value:(Q=(0,u.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate||!this.entity){e.next=5;break}return e.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return e.abrupt("return",c.default.all([this.membersEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}}),e,this)}))),function(){return Q.apply(this,arguments)})},{key:"_setStatus",value:function(e,t){var n=this;this.statusSource=t,this.channelState.status!==e&&(this.channelState.status=e,"joined"===e?this._subscribeStreams().catch((function(t){if(R.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):"invited"===e?this._subscribe().catch((function(t){if(R.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):this.entityPromise&&this._unsubscribe().catch((function(t){if(R.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})))}},{key:"_statusSource",value:function(){return this.statusSource}},{key:"_update",value:function(e){var n,a,c,u,l;R.trace("_update",e),t.preprocessUpdate(e,this.sid);var d=new o.default,h=!0,p=!1,f=void 0;try{for(var m,g=(0,i.default)((0,r.default)(e));!(h=(m=g.next()).done);h=!0){var y=m.value,v=j[y];if(v)switch(v){case j.status:if(!e.status||"unknown"===e.status||this.channelState.status===e.status)break;this.channelState.status=e.status,d.add(v);break;case j.attributes:if(P.isDeepEqual(this.channelState.attributes,e.attributes))break;this.channelState.attributes=e.attributes,d.add(v);break;case j.lastConsumedMessageIndex:if(void 0===e.lastConsumedMessageIndex||e.lastConsumedMessageIndex===this.channelState.lastConsumedMessageIndex)break;this.channelState.lastConsumedMessageIndex=e.lastConsumedMessageIndex,d.add(v);break;case j.lastMessage:if(this.channelState.lastMessage&&!e.lastMessage){delete this.channelState.lastMessage,d.add(v);break}this.channelState.lastMessage=this.channelState.lastMessage||{},void 0!==(null===(n=e.lastMessage)||void 0===n?void 0:n.index)&&e.lastMessage.index!==this.channelState.lastMessage.index&&(this.channelState.lastMessage.index=e.lastMessage.index,d.add(v)),void 0!==(null===(a=e.lastMessage)||void 0===a?void 0:a.timestamp)&&(null===(u=null===(c=this.channelState.lastMessage)||void 0===c?void 0:c.dateCreated)||void 0===u?void 0:u.getTime())!==e.lastMessage.timestamp.getTime()&&(this.channelState.lastMessage.dateCreated=e.lastMessage.timestamp,d.add(v)),P.isDeepEqual(this.channelState.lastMessage,{})&&delete this.channelState.lastMessage;break;case j.state:var b=e.state||void 0;if(void 0!==b&&(b.dateUpdated=new Date(b.dateUpdated)),P.isDeepEqual(this.channelState.state,b))break;this.channelState.state=b,d.add(v);break;default:var w=e[y]instanceof Date,k=w&&(null===(l=this.channelState[v])||void 0===l?void 0:l.getTime())===e[y].getTime(),_=!w&&this[v]===e[y];if(k||_)break;this.channelState[v]=e[y],d.add(v)}}}catch(e){p=!0,f=e}finally{try{!h&&g.return&&g.return()}finally{if(p)throw f}}d.size>0&&this.emit("updated",{channel:this,updateReasons:[].concat((0,s.default)(d))})}},{key:"_onMessageAdded",value:function(e){var t=!0,n=!1,r=void 0;try{for(var s,o=(0,i.default)(this.members.values());!(t=(s=o.next()).done);t=!0){var a=s.value;if(a.identity===e.author){a._endTyping();break}}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this.emit("messageAdded",e)}},{key:"add",value:(G=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.membersEntity.add(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"advanceLastConsumedMessageIndex",value:(K=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.advanceLastConsumedMessageIndexForChannel(this.sid,t,this.lastConsumedMessageIndex));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"decline",value:(J=(0,u.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("declineInvitation",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return J.apply(this,arguments)})},{key:"delete",value:(H=(0,u.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("destroyChannel",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return H.apply(this,arguments)})},{key:"getAttributes",value:(z=(0,u.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}}),e,this)}))),function(){return z.apply(this,arguments)})},{key:"getMessages",value:(W=(0,u.default)(a.default.mark((function e(t,n,r){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.messagesEntity.getMessages(t,n,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return W.apply(this,arguments)})},{key:"getMembers",value:($=(0,u.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.membersEntity.getMembers());case 3:case"end":return e.stop()}}),e,this)}))),function(){return $.apply(this,arguments)})},{key:"getMembersCount",value:(B=(0,u.default)(a.default.mark((function e(){var t,n,r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new P.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(n);case 6:return r=e.sent,e.abrupt("return",r.body.members_count);case 8:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"getMemberBySid",value:(q=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.membersEntity.getMemberBySid(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"getMemberByIdentity",value:(F=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.membersEntity.getMemberByIdentity(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"getMessagesCount",value:(A=(0,u.default)(a.default.mark((function e(){var t,n,r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new P.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(n);case 6:return r=e.sent,e.abrupt("return",r.body.messages_count);case 8:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"getUnconsumedMessagesCount",value:(D=(0,u.default)(a.default.mark((function e(){var t,n,r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new P.UriBuilder(t.myChannelsUrl).arg("ChannelSid",this.sid).build(),e.next=6,this.services.network.get(n);case 6:if(!(r=e.sent).body.channels.length||r.body.channels[0].channel_sid!=this.sid){e.next=11;break}if(void 0===r.body.channels[0].unread_messages_count||null==r.body.channels[0].unread_messages_count){e.next=10;break}return e.abrupt("return",r.body.channels[0].unread_messages_count);case 10:return e.abrupt("return",null);case 11:throw new Error("Channel is not in user channels list");case 12:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"invite",value:(U=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.invite(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"join",value:(L=(0,u.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("joinChannelV2",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"leave",value:(O=(0,u.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this.channelState.status){e.next=3;break}return e.next=3,this.services.session.addCommand("leaveChannel",{channelSid:this.sid});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"removeMember",value:(C=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof I.Member)){e.next=4;break}return e.next=3,this.membersEntity.removeBySid(t.sid);case 3:return e.abrupt("return");case 4:return e.next=6,this.membersEntity.removeByIdentity(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"sendMessage",value:(x=(0,u.default)(a.default.mark((function e(t,n){var r,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t&&null!==t){e.next=5;break}return e.next=3,this.messagesEntity.send(t,n);case 3:return r=e.sent,e.abrupt("return",P.parseToNumber(r.messageId));case 5:return e.next=7,this.messagesEntity.sendMedia(t,n);case 7:return i=e.sent,e.abrupt("return",P.parseToNumber(i.messageId));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"setAllMessagesConsumed",value:(T=(0,u.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!((t=e.sent).items.length>0)){e.next=7;break}return e.abrupt("return",this.advanceLastConsumedMessageIndex(t.items[0].index));case 7:return e.abrupt("return",c.default.resolve(0));case 8:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"setNoMessagesConsumed",value:(S=(0,u.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,null));case 3:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"setUserNotificationLevel",value:(_=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editNotificationLevel",{channelSid:this.sid,notificationLevel:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"typing",value:function(){return this.services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:(k=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editAttributes",{channelSid:this.sid,attributes:(0,d.default)(t)});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"updateFriendlyName",value:(w=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelState.friendlyName===t){e.next=3;break}return e.next=3,this.services.session.addCommand("editFriendlyName",{channelSid:this.sid,friendlyName:t});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"updateLastConsumedMessageIndex",value:(b=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"updateUniqueName",value:(v=(0,u.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelState.uniqueName===t){e.next=4;break}return t||(t=""),e.next=4,this.services.session.addCommand("editUniqueName",{channelSid:this.sid,uniqueName:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getUserDescriptors",value:(n=(0,u.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getChannelUserDescriptors(this.sid));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"status",get:function(){return this.channelState.status}},{key:"type",get:function(){return this.channelState.type}},{key:"uniqueName",get:function(){return this.channelState.uniqueName}},{key:"isPrivate",get:function(){return"private"===this.channelState.type}},{key:"friendlyName",get:function(){return this.channelState.friendlyName}},{key:"dateUpdated",get:function(){return this.channelState.dateUpdated}},{key:"dateCreated",get:function(){return this.channelState.dateCreated}},{key:"createdBy",get:function(){return this.channelState.createdBy}},{key:"attributes",get:function(){return this.channelState.attributes}},{key:"lastConsumedMessageIndex",get:function(){return this.channelState.lastConsumedMessageIndex}},{key:"lastMessage",get:function(){return this.channelState.lastMessage}},{key:"notificationLevel",get:function(){return this.channelState.notificationLevel}},{key:"state",get:function(){return this.channelState.state}}],[{key:"preprocessUpdate",value:function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&(0,d.default)(e.attributes)}catch(n){R.warn("Retrieved malformed attributes from the server for channel: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){R.warn("Retrieved malformed dateCreated from the server for channel: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){R.warn("Retrieved malformed dateUpdated from the server for channel: "+t),delete e.dateUpdated}try{e.lastMessage&&e.lastMessage.timestamp&&(e.lastMessage.timestamp=new Date(e.lastMessage.timestamp))}catch(n){R.warn("Retrieved malformed lastMessage.timestamp from the server for channel: "+t),delete e.lastMessage.timestamp}}}]),t}(x.EventEmitter);S([O.asyncTypeCheck(O.nonEmptyString),T("design:type",Function),T("design:paramtypes",[String]),T("design:returntype",c.default)],L.prototype,"add",null),S([O.asyncTypeCheck(O.nonNegativeInteger),T("design:type",Function),T("design:paramtypes",[Number]),T("design:returntype",c.default)],L.prototype,"advanceLastConsumedMessageIndex",null),S([O.asyncTypeCheck(["undefined",O.nonNegativeInteger],["undefined",O.nonNegativeInteger],["undefined",O.literal("backwards","forward")]),T("design:type",Function),T("design:paramtypes",[Number,Number,String]),T("design:returntype",c.default)],L.prototype,"getMessages",null),S([O.asyncTypeCheck(O.nonEmptyString),T("design:type",Function),T("design:paramtypes",[String]),T("design:returntype",c.default)],L.prototype,"getMemberBySid",null),S([O.asyncTypeCheck(O.nonEmptyString),T("design:type",Function),T("design:paramtypes",[String]),T("design:returntype",c.default)],L.prototype,"getMemberByIdentity",null),S([O.asyncTypeCheck(O.nonEmptyString),T("design:type",Function),T("design:paramtypes",[String]),T("design:returntype",c.default)],L.prototype,"invite",null),S([O.asyncTypeCheck([O.nonEmptyString,I.Member]),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",c.default)],L.prototype,"removeMember",null),S([O.asyncTypeCheck(["string",O.literal(null),O.custom((function(e){return[e instanceof FormData,"an instance of FormData"]})),O.custom((function(e){var t="valid media options";if("object"!==(void 0===e?"undefined":(0,w.default)(e))||null===e||Array.isArray(e))return[!1,t+" (should be a pure object)"];if(!("string"==typeof e.contentType&&e.contentType.length>0))return[!1,t+" (mediaOptions.contentType should be a non-empty string)","malformed media options (mediaOptions.contentType is "+O.stringifyReceivedType(e.contentType)+")"];var n="string"==typeof e.media&&e.media.length>0||e.media instanceof Uint8Array||e.media instanceof ArrayBuffer;return"function"==typeof Blob&&(n=n||e.media instanceof Blob),n?[!0]:[!1,t+" (mediaOptions.media should be a non-empty string, an instance of Buffer or an instance of Blob)","malformed media options (mediaOptions.media is "+O.stringifyReceivedType(e.media)+")"]}))],["undefined","string","number","boolean","object",O.literal(null)]),T("design:type",Function),T("design:paramtypes",[Object,Object]),T("design:returntype",c.default)],L.prototype,"sendMessage",null),S([O.asyncTypeCheck(O.literal("default","muted")),T("design:type",Function),T("design:paramtypes",[String]),T("design:returntype",c.default)],L.prototype,"setUserNotificationLevel",null),S([O.asyncTypeCheck(["string","number","boolean","object",O.literal(null)]),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",c.default)],L.prototype,"updateAttributes",null),S([O.asyncTypeCheck(["string",O.literal(null)]),T("design:type",Function),T("design:paramtypes",[String]),T("design:returntype",c.default)],L.prototype,"updateFriendlyName",null),S([O.asyncTypeCheck([O.literal(null),O.nonNegativeInteger]),T("design:type",Function),T("design:paramtypes",[Number]),T("design:returntype",c.default)],L.prototype,"updateLastConsumedMessageIndex",null),S([O.asyncTypeCheck(["string",O.literal(null)]),T("design:type",Function),T("design:paramtypes",[String]),T("design:returntype",c.default)],L.prototype,"updateUniqueName",null),t.Channel=L},9122:(e,t,n)=>{"use strict";var r=s(n(9663)),i=s(n(2600));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelDescriptor=void 0;var o=n(2126),a=n(4081),c=o.Logger.scope("ChannelDescriptor"),u=function(){function e(t,n){(0,r.default)(this,e),this.client=t,this.descriptor=n,n.sid?(this.sid=n.sid,this.channel=n.sid+".channel"):(this.sid=n.channel_sid,this.channel=n.channel_sid+".channel"),this.uniqueName=n.unique_name,this.friendlyName=n.friendly_name,this.attributes=a.parseAttributes(n.attributes,"Failed to parse channel attributes",c),this.createdBy=n.created_by,this.dateCreated=a.parseTime(n.date_created),this.dateUpdated=a.parseTime(n.date_updated),this.messagesCount=n.messages_count,this.membersCount=n.members_count,this.type=n.type,this.isPrivate="private"==n.type,this.lastConsumedMessageIndex=n.last_consumed_message_index,n.notification_level&&(this.notificationLevel=n.notification_level),n.status?this.status=n.status:this.status="unknown"}return(0,i.default)(e,[{key:"getChannel",value:function(){return this.client.getChannelBySid(this.sid)}}]),e}();t.ChannelDescriptor=u},5560:(e,t,n)=>{"use strict";var r=b(n(6378)),i=b(n(2424)),s=b(n(2367)),o=b(n(4942)),a=b(n(6803)),c=b(n(6593)),u=b(n(2945)),l=b(n(5105)),d=b(n(2600)),h=b(n(9135)),p=b(n(3196)),f=b(n(9663)),m=b(n(448)),g=b(n(2242)),y=b(n(2444)),v=b(n(8177));function b(e){return e&&e.__esModule?e:{default:e}}var w=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=(0,v.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&(0,g.default)(t,n,o),o},k=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof m.default)return(0,m.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PushNotification=t.Client=t.User=void 0;var _=n(7187),S=n(2126),T=n(6832),x=n(7920);Object.defineProperty(t,"User",{enumerable:!0,get:function(){return x.User}});var C=n(1057),E=n(735),I=n(3446),M=n(4479),P=n(6895),O=n(1684),R=n(1137),j=n(6222),N=n(9111),L=n(850),U=n(9068),D=n(157),A=n(4131),F=n(8412),q=n(1900);Object.defineProperty(t,"PushNotification",{enumerable:!0,get:function(){return q.PushNotification}});var B=n(4081),$=n(1939),W=S.Logger.scope("Client"),z=n(7634).i8,H=function e(){(0,f.default)(this,e)},J=function(e){function t(e,n){(0,f.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,l.default)(t)).call(this));if(r.connectionState="connecting",r.sessionPromise=null,r.channelsPromise=null,r.version=z,r.parsePushNotification=t.parsePushNotification,r.options=n||{},!r.options.disableDeepClone){var i=(0,u.default)((0,u.default)({},r.options),{transport:void 0,twilsockClient:void 0});(i=B.deepClone(i)).transport=r.options.transport,i.twilsockClient=r.options.twilsockClient,r.options=i}r.options.logLevel=r.options.logLevel||"silent",W.setLevel(r.options.logLevel);var s=r.options.productId="ip_messaging";if(r.options.clientMetadata=r.options.clientMetadata||{},r.options.clientMetadata.hasOwnProperty("type")||(r.options.clientMetadata.type="chat"),r.options.clientMetadata.hasOwnProperty("sdk")||(r.options.clientMetadata.sdk="JS",r.options.clientMetadata.sdkv=z),r.options.Sync=r.options.Sync||{},void 0===r.options.Sync.enableSessionStorage&&(r.options.Sync.enableSessionStorage=!0),r.options.region&&(r.options.Sync.region=r.options.region),!e)throw new Error("A valid Twilio token should be provided");return r.services=new H,r.config=new T.Configuration(r.options),r.options.twilsockClient=r.options.twilsockClient||new P.Twilsock(e,s,r.options),r.options.transport=r.options.transport||r.options.twilsockClient,r.options.notificationsClient=r.options.notificationsClient||new O.Notifications(e,r.options),r.options.syncClient=r.options.syncClient||new R.SyncClient(e,r.options),r.services.syncClient=r.options.syncClient,r.services.transport=r.options.transport,r.services.twilsockClient=r.options.twilsockClient,r.services.notificationClient=r.options.notificationsClient,r.services.session=new N.Session(r.services,r.config),r.sessionPromise=r.services.session.initialize(),r.services.network=new E.Network(r.config,r.services),r.services.users=new U.Users({session:r.services.session,network:r.services.network,syncClient:r.services.syncClient}),r.services.users.on("userSubscribed",r.emit.bind(r,"userSubscribed")),r.services.users.on("userUpdated",(function(e){return r.emit("userUpdated",e)})),r.services.users.on("userUnsubscribed",r.emit.bind(r,"userUnsubscribed")),r.services.twilsockClient.on("tokenAboutToExpire",(function(e){return r.emit("tokenAboutToExpire",e)})),r.services.twilsockClient.on("tokenExpired",(function(){return r.emit("tokenExpired")})),r.services.twilsockClient.on("connectionError",(function(e){return r.emit("connectionError",e)})),r.services.consumptionHorizon=new A.ConsumptionHorizon(r.services),r.services.typingIndicator=new D.TypingIndicator(r.config,{transport:r.services.twilsockClient,notificationClient:r.services.notificationClient},r.getChannelBySid.bind(r)),r.services.syncList=new M.SyncList(r.services),r.channels=new L.Channels(r.services),r.channelsPromise=r.sessionPromise.then((function(){return r.channels.on("channelAdded",r.emit.bind(r,"channelAdded")),r.channels.on("channelRemoved",r.emit.bind(r,"channelRemoved")),r.channels.on("channelInvited",r.emit.bind(r,"channelInvited")),r.channels.on("channelJoined",r.emit.bind(r,"channelJoined")),r.channels.on("channelLeft",r.emit.bind(r,"channelLeft")),r.channels.on("channelUpdated",(function(e){return r.emit("channelUpdated",e)})),r.channels.on("memberJoined",r.emit.bind(r,"memberJoined")),r.channels.on("memberLeft",r.emit.bind(r,"memberLeft")),r.channels.on("memberUpdated",(function(e){return r.emit("memberUpdated",e)})),r.channels.on("messageAdded",r.emit.bind(r,"messageAdded")),r.channels.on("messageUpdated",(function(e){return r.emit("messageUpdated",e)})),r.channels.on("messageRemoved",r.emit.bind(r,"messageRemoved")),r.channels.on("typingStarted",r.emit.bind(r,"typingStarted")),r.channels.on("typingEnded",r.emit.bind(r,"typingEnded")),r.channels.fetchChannels()})).then((function(){return r.channels})),r.services.notificationClient.on("connectionStateChanged",(function(e){var t=null;switch(e){case"connected":t="connected";break;case"denied":t="denied";break;case"disconnecting":t="disconnecting";break;case"disconnected":t="disconnected";break;default:t="connecting"}t!==r.connectionState&&(r.connectionState=t,r.emit("connectionStateChanged",r.connectionState))})),r.fpaToken=e,r}var n,r,i,s,m,g,y,v,b,w,k;return(0,p.default)(t,e),(0,d.default)(t,[{key:"subscribeToPushNotifications",value:function(e){var t=this,n=[];return[I.NotificationTypes.NEW_MESSAGE,I.NotificationTypes.ADDED_TO_CHANNEL,I.NotificationTypes.INVITED_TO_CHANNEL,I.NotificationTypes.REMOVED_FROM_CHANNEL,I.NotificationTypes.TYPING_INDICATOR,I.NotificationTypes.CONSUMPTION_UPDATE].forEach((function(r){n.push(t.services.notificationClient.subscribe(r,e))})),c.default.all(n)}},{key:"unsubscribeFromPushNotifications",value:function(e){var t=this,n=[];return[I.NotificationTypes.NEW_MESSAGE,I.NotificationTypes.ADDED_TO_CHANNEL,I.NotificationTypes.INVITED_TO_CHANNEL,I.NotificationTypes.REMOVED_FROM_CHANNEL,I.NotificationTypes.TYPING_INDICATOR,I.NotificationTypes.CONSUMPTION_UPDATE].forEach((function(r){n.push(t.services.notificationClient.unsubscribe(r,e))})),c.default.all(n)}},{key:"initialize",value:(k=(0,a.default)(o.default.mark((function e(){var n,r,i=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionPromise;case 2:return t.supportedPushChannels.forEach((function(e){return i.subscribeToPushNotifications(e)})),e.next=5,this.services.session.getSessionLinks();case 5:return n=e.sent,this.services.publicChannels=new C.PublicChannels(this,this.services,n.publicChannelsUrl),this.services.userChannels=new F.UserChannels(this,this.services,n.myChannelsUrl),(r=(0,u.default)(this.options)).transport=null,this.services.mcsClient=new j.McsClient(this.fpaToken,n.mediaServiceUrl,r),e.next=13,this.services.typingIndicator.initialize();case 13:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"shutdown",value:(w=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.twilsockClient.disconnect();case 2:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"updateToken",value:(b=(0,a.default)(o.default.mark((function e(t){var n=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W.info("updateToken"),this.fpaToken!==t){e.next=3;break}return e.abrupt("return",this);case 3:return e.next=5,this.services.twilsockClient.updateToken(t).then((function(){return n.fpaToken=t})).then((function(){return n.services.mcsClient.updateToken(t)})).then((function(){return n.sessionPromise}));case 5:return e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"getChannelBySid",value:(v=(0,a.default)(o.default.mark((function e(t){var n=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channels.syncListRead.promise.then((function(){return n.channels.getChannel(t).then((function(e){return e||n.services.publicChannels.getChannelBySid(t).then((function(e){return n.channels.pushChannel(e)}))}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(y=(0,a.default)(o.default.mark((function e(t){var n=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channels.syncListRead.promise.then((function(){return n.services.publicChannels.getChannelByUniqueName(t).then((function(e){return n.channels.pushChannel(e)}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getSubscribedChannels",value:function(e){return this.channelsPromise.then((function(t){return t.getChannels(e)}))}},{key:"getLocalChannels",value:function(e){return this.channelsPromise.then((function(n){var r=[];n.channels.forEach((function(e){r.push(e)}));var i=(null==e?void 0:e.order)||"ascending";return e&&e.criteria&&("lastMessage"===e.criteria?r.sort((function(e,n){return t.compareChannelsByLastMessage(e,n,i)})):"uniqueName"===e.criteria?r.sort((function(e,n){return t.compareChannelsByStringProperty(e.uniqueName,n.uniqueName,i)})):"friendlyName"===e.criteria&&r.sort((function(e,n){return t.compareChannelsByStringProperty(e.friendlyName,n.friendlyName,i)}))),r}))}},{key:"getPublicChannelDescriptors",value:function(){return this.services.publicChannels.getChannels()}},{key:"getUserChannelDescriptors",value:function(){return this.services.userChannels.getChannels()}},{key:"createChannel",value:function(e){return e=e||{},this.channelsPromise.then((function(t){return t.addChannel(e)}))}},{key:"setPushRegistrationId",value:(g=(0,a.default)(o.default.mark((function e(t,n){var r=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subscribeToPushNotifications(t).then((function(){return r.services.notificationClient.setPushRegistrationId(n,t)}));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"unsetPushRegistrationId",value:(m=(0,a.default)(o.default.mark((function e(n){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==t.supportedPushChannels.indexOf(n)){e.next=2;break}throw new Error("Invalid or unsupported channelType: "+n);case 2:return e.next=4,this.unsubscribeFromPushNotifications(n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"handlePushNotification",value:(s=(0,a.default)(o.default.mark((function e(n){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:W.debug("handlePushNotification, notificationPayload=",n),this.emit("pushNotification",t.parsePushNotification(n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getUser",value:function(e){return this.services.users.getUser(e)}},{key:"getUserDescriptor",value:(i=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getUserDescriptor(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getSubscribedUsers",value:(r=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getSubscribedUsers());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"user",get:function(){return this.services.users.myself}},{key:"reachabilityEnabled",get:function(){return this.services.session.reachabilityEnabled}},{key:"token",get:function(){return this.fpaToken}}],[{key:"create",value:(n=(0,a.default)(o.default.mark((function e(n,r){var i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new t(n,r),e.next=3,i.initialize();case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"compareChannelsByLastMessage",value:function(e,t,n){if(e.lastMessage&&t.lastMessage){if(e.lastMessage.dateCreated&&t.lastMessage.dateCreated)return e.lastMessage.dateCreated.getTime()<t.lastMessage.dateCreated.getTime()?"ascending"===n?-1:1:"ascending"===n?1:-1;if(e.lastMessage.dateCreated)return-1;if(t.lastMessage.dateCreated)return 1}return e.lastMessage?-1:t.lastMessage?1:0}},{key:"compareChannelsByStringProperty",value:function(e,t,n){return e&&t?"ascending"===n?e.localeCompare(t):-1*e.localeCompare(t):e?-1:t?1:0}},{key:"parsePushNotificationChatData",value:function(e){var n={};for(var r in t.supportedPushDataFields)void 0!==e[r]&&null!==e[r]&&("message_index"===r?null!==B.parseToNumber(e[r])&&(n[t.supportedPushDataFields[r]]=Number(e[r])):n[t.supportedPushDataFields[r]]=e[r]);return n}},{key:"parsePushNotification",value:function(e){if(W.debug("parsePushNotification, notificationPayload=",e),void 0!==e.aps){if(!e.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var n=t.parsePushNotificationChatData(e),r=e.aps,i=null,s=null;return"string"==typeof r.alert?i=r.alert||null:(i=r.alert.body||null,s=r.alert.title||null),new q.PushNotification({title:s,body:i,sound:r.sound||null,badge:r.badge||null,action:r.category||null,type:e.twi_message_type,data:n})}if(void 0!==e.data){var o=e.data;if(!o.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var a=t.parsePushNotificationChatData(e.data);return new q.PushNotification({title:o.twi_title||null,body:o.twi_body||null,sound:o.twi_sound||null,badge:null,action:o.twi_action||null,type:o.twi_message_type,data:a})}throw new Error("Provided push notification payload is not Programmable Chat notification")}}]),t}(_.EventEmitter);J.version=z,J.supportedPushChannels=["fcm","apn","gcm"],J.supportedPushDataFields={channel_sid:"channelSid",message_sid:"messageSid",message_index:"messageIndex"},w([$.asyncTypeCheck($.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String]),k("design:returntype",c.default)],J.prototype,"updateToken",null),w([$.asyncTypeCheck($.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String]),k("design:returntype",c.default)],J.prototype,"getChannelBySid",null),w([$.asyncTypeCheck($.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String]),k("design:returntype",c.default)],J.prototype,"getChannelByUniqueName",null),w([$.asyncTypeCheck(["undefined",$.custom((function(e){var t="valid sorting options";if("object"!==(void 0===e?"undefined":(0,y.default)(e))||null===e||Array.isArray(e))return[!1,t+" (should be a pure object)"];var n=new s.default([["criteria",["lastMessage","friendlyName","uniqueName"]],["order",["ascending","descending"]]]),o=!0,a=!1,c=void 0;try{for(var u,l=(0,r.default)(n.entries());!(o=(u=l.next()).done);o=!0){var d=u.value,h=(0,i.default)(d,2),p=h[0],f=h[1];if(void 0!==e[p]&&!f.includes(e[p]))return[!1,t+" (sortingOptions."+p+' should be one of: "'+f.join('", "')+'")',"malformed sorting options (sortingOptions."+p+" is "+$.stringifyReceivedType(e[p])+")"]}}catch(e){a=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw c}}return[!0]}))]),k("design:type",Function),k("design:paramtypes",[Object]),k("design:returntype",c.default)],J.prototype,"getLocalChannels",null),w([$.asyncTypeCheck(["undefined",$.custom((function(e){var t="valid channel options";if("object"!==(void 0===e?"undefined":(0,y.default)(e))||null===e||Array.isArray(e))return[!1,t+" (should be a pure object)"];var n=new s.default([["friendlyName","string"],["isPrivate","boolean"],["uniqueName","string"]]),o=!0,a=!1,c=void 0;try{for(var u,l=(0,r.default)(n.entries());!(o=(u=l.next()).done);o=!0){var d=u.value,h=(0,i.default)(d,2),p=h[0],f=h[1];if(void 0!==e[p]&&(0,y.default)(e[p])!==f)return[!1,t+" (options."+p+" should be of type "+f+")","malformed channel options (options."+p+" is "+$.stringifyReceivedType(e[p])+")"]}}catch(e){a=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw c}}return[!0]}))]),k("design:type",Function),k("design:paramtypes",[Object]),k("design:returntype",c.default)],J.prototype,"createChannel",null),w([$.asyncTypeCheck($.literal("gcm","fcm","apn"),"string"),k("design:type",Function),k("design:paramtypes",[String,String]),k("design:returntype",c.default)],J.prototype,"setPushRegistrationId",null),w([$.asyncTypeCheck($.literal("gcm","fcm","apn")),k("design:type",Function),k("design:paramtypes",[String]),k("design:returntype",c.default)],J.prototype,"unsetPushRegistrationId",null),w([$.asyncTypeCheck($.pureObject),k("design:type",Function),k("design:paramtypes",[Object]),k("design:returntype",c.default)],J.prototype,"handlePushNotification",null),w([$.asyncTypeCheck($.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String]),k("design:returntype",c.default)],J.prototype,"getUser",null),w([$.asyncTypeCheck($.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String]),k("design:returntype",c.default)],J.prototype,"getUserDescriptor",null),w([$.asyncTypeCheck("string",["undefined",$.pureObject]),k("design:type",Function),k("design:paramtypes",[String,Object]),k("design:returntype",c.default)],J,"create",null),w([$.typeCheck($.pureObject),k("design:type",Function),k("design:paramtypes",[Object]),k("design:returntype",q.PushNotification)],J,"parsePushNotification",null),t.Client=J,t.default=J},6832:(e,t,n)=>{"use strict";var r=s(n(9663)),i=s(n(2600));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;var o=function(){function e(t){(0,r.default)(this,e);var n=(t=t||{}).Chat||t.IPMessaging||t||{};this.region=n.region||t.region,this.baseUrl=n.apiUri||n.typingUri||(this.region&&"us1"!==this.region?"https://aim."+this.region+".twilio.com":"https://aim.twilio.com"),this.typingIndicatorUri=this.baseUrl+"/v1/typing",this.typingIndicatorTimeoutOverride=n.typingIndicatorTimeoutOverride,this.httpCacheIntervalOverride=n.httpCacheIntervalOverride,this.consumptionReportIntervalOverride=n.consumptionReportIntervalOverride,this.userInfosToSubscribeOverride=n.userInfosToSubscribeOverride,this.retryWhenThrottledOverride=n.retryWhenThrottledOverride,this.backoffConfigOverride=n.backoffConfigOverride,this.productId=t.productId}return(0,i.default)(e,[{key:"typingIndicatorTimeoutDefault",get:function(){return 5e3}},{key:"httpCacheIntervalDefault",get:function(){return"PT5S"}},{key:"consumptionReportIntervalDefault",get:function(){return"PT5S"}},{key:"userInfosToSubscribeDefault",get:function(){return 100}},{key:"retryWhenThrottledDefault",get:function(){return true}},{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}}]),e}();t.Configuration=o},850:(e,t,n)=>{"use strict";var r=f(n(6593)),i=f(n(4942)),s=f(n(3239)),o=f(n(6803)),a=f(n(9527)),c=f(n(2367)),u=f(n(5105)),l=f(n(9663)),d=f(n(2600)),h=f(n(9135)),p=f(n(3196));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Channels=t.Channel=void 0;var m=n(7187),g=n(2126),y=n(8352);Object.defineProperty(t,"Channel",{enumerable:!0,get:function(){return y.Channel}});var v=n(6291),b=n(4081),w=g.Logger.scope("Channels"),k=function(e){function t(e){(0,l.default)(this,t);var n=(0,h.default)(this,(t.__proto__||(0,u.default)(t)).call(this));return n.services=e,n.channels=new c.default,n.thumbstones=new a.default,n.syncListFetched=!1,n.syncListRead=new v.Deferred,n}var n;return(0,p.default)(t,e),(0,d.default)(t,[{key:"getMap",value:function(){var e=this;return this.services.session.getMyChannelsId().then((function(t){return e.services.syncClient.map({id:t,mode:"open_existing"})}))}},{key:"addChannel",value:(n=(0,o.default)(i.default.mark((function e(t){var n,r,o,a,c,u;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,n=void 0===t.attributes?{}:t.attributes,e.next=4,this.services.session.addCommand("createChannel",{friendlyName:t.friendlyName,uniqueName:t.uniqueName,type:t.isPrivate?"private":"public",attributes:(0,s.default)(n)});case 4:if(r=e.sent,o="channelSid"in r?r.channelSid:null,a="channel"in r?r.channel:null,!(c=this.channels.get(o))){e.next=12;break}return e.next=11,c._subscribe();case 11:return e.abrupt("return",c);case 12:return u=new y.Channel(this.services,{channel:a,entityName:null,uniqueName:null,attributes:null,createdBy:null,friendlyName:null,lastConsumedMessageIndex:null,type:t.isPrivate?"private":"public",dateCreated:null,dateUpdated:null},o),this.channels.set(u.sid,u),this.registerForEvents(u),e.next=17,u._subscribe();case 17:return this.emit("channelAdded",u),e.abrupt("return",u);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fetchChannels",value:function(){var e,t=this;this.getMap().then((e=(0,o.default)(i.default.mark((function e(n){var s,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.on("itemAdded",(function(e){w.debug("itemAdded: "+e.item.key),t.upsertChannel("sync",e.item.key,e.item.value)})),n.on("itemRemoved",(function(e){w.debug("itemRemoved: "+e.key);var n=e.key;t.syncListFetched||t.thumbstones.add(n);var r=t.channels.get(n);r&&("joined"!==r.status&&"invited"!==r.status||(r._setStatus("notParticipating","sync"),t.emit("channelLeft",r)),r.isPrivate&&(t.channels.delete(n),t.emit("channelRemoved",r),r.emit("removed",r)))})),n.on("itemUpdated",(function(e){w.debug("itemUpdated: "+e.item.key),t.upsertChannel("sync",e.item.key,e.item.value)})),s=[],e.next=6,t.services.syncList.getPage();case 6:(o=e.sent).items.forEach((function(e){s.push(t.upsertChannel("synclist",e.channel_sid,e))}));case 9:if(!o.hasNextPage){e.next=16;break}return e.next=12,o.nextPage();case 12:(o=e.sent).items.forEach((function(e){s.push(t.upsertChannel("synclist",e.channel_sid,e))})),e.next=9;break;case 16:return t.syncListRead.set(!0),e.abrupt("return",r.default.all(s));case 18:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)})).then((function(){t.syncListFetched=!0,t.thumbstones.clear(),w.debug("Channels list fetched")})).then((function(){return t})).catch((function(e){throw"disconnected"!=t.services.syncClient.connectionState&&w.error("Failed to get channels list",e),w.debug("ERROR: Failed to get channels list",e),e}))}},{key:"_wrapPaginator",value:function(e,t){var n=this;return t(e.items).then((function(r){return{items:r,hasNextPage:e.hasNextPage,hasPrevPage:e.hasPrevPage,nextPage:function(){return e.nextPage().then((function(e){return n._wrapPaginator(e,t)}))},prevPage:function(){return e.prevPage().then((function(e){return n._wrapPaginator(e,t)}))}}}))}},{key:"getChannels",value:function(e){var t=this;return this.getMap().then((function(t){return t.getItems(e)})).then((function(e){return t._wrapPaginator(e,(function(e){return r.default.all(e.map((function(e){return t.upsertChannel("sync",e.key,e.value)})))}))}))}},{key:"getChannel",value:function(e){var t=this;return this.getMap().then((function(t){return t.getItems({key:e})})).then((function(e){return e.items.map((function(e){return t.upsertChannel("sync",e.key,e.value)}))})).then((function(e){return e.length>0?e[0]:null}))}},{key:"pushChannel",value:function(e){var t=e.sid,n={entityName:null,lastConsumedMessageIndex:e.lastConsumedMessageIndex,type:e.type,status:e.status,friendlyName:e.friendlyName,dateUpdated:e.dateUpdated,dateCreated:e.dateCreated,uniqueName:e.uniqueName,createdBy:e.createdBy,attributes:e.attributes,channel:e.channel,notificationLevel:e.notificationLevel,sid:t};return this.upsertChannel("chat",t,n)}},{key:"upsertChannel",value:function(e,t,n){var r=this;w.trace("upsertChannel(sid="+t+", data=",n);var i=this.channels.get(t);if(i){if(w.trace("upsertChannel: channel "+t+" is known and it's status is known from source "+i._statusSource()+" and update came from source "+e,i),void 0===i._statusSource()||e===i._statusSource()||"synclist"===e&&"sync"!==i._statusSource()||"sync"===e)if("joined"===n.status&&"joined"!==i.status){i._setStatus("joined",e);var s={};void 0!==n.notificationLevel&&(s.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(s.lastConsumedMessageIndex=n.lastConsumedMessageIndex),b.isDeepEqual(s,{})||i._update(s),i._subscribe().then((function(){r.emit("channelJoined",i)}))}else if("invited"===n.status&&"invited"!==i.status){i._setStatus("invited",e);var o={};void 0!==n.notificationLevel&&(o.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(o.lastConsumedMessageIndex=n.lastConsumedMessageIndex),b.isDeepEqual(o,{})||i._update(o),i._subscribe().then((function(){r.emit("channelInvited",i)}))}else"notParticipating"!==n.status||"invited"!==i.status&&"joined"!==i.status?"notParticipating"===n.status&&"private"===n.type?i._subscribe():i._update(n):(i._setStatus("notParticipating",e),i._update(n),i._subscribe().then((function(){r.emit("channelLeft",i)})));else w.trace("upsertChannel: channel is known from sync and came from chat, ignoring",{sid:t,data:n.status,channel:i.status});return i._subscribe().then((function(){return i}))}if("chat"!==e&&"synclist"!==e||!this.thumbstones.has(t))return w.trace("upsertChannel: creating local channel object with sid "+t,n),i=new y.Channel(this.services,n,t),this.channels.set(t,i),i._subscribe().then((function(){return r.registerForEvents(i),r.emit("channelAdded",i),"joined"===n.status?(i._setStatus("joined",e),r.emit("channelJoined",i)):"invited"===n.status&&(i._setStatus("invited",e),r.emit("channelInvited",i)),i}));w.trace("upsertChannel: channel is deleted and came again from chat, ignoring",t)}},{key:"onChannelRemoved",value:function(e){var t=this.channels.get(e);t&&(this.channels.delete(e),this.emit("channelRemoved",t))}},{key:"registerForEvents",value:function(e){var t=this;e.on("removed",(function(){return t.onChannelRemoved(e.sid)})),e.on("updated",(function(e){return t.emit("channelUpdated",e)})),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",(function(e){return t.emit("memberUpdated",e)})),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",(function(e){return t.emit("messageUpdated",e)})),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}}]),t}(m.EventEmitter);t.Channels=k},9339:(e,t,n)=>{"use strict";var r=d(n(6593)),i=d(n(4942)),s=d(n(6803)),o=d(n(5105)),a=d(n(9663)),c=d(n(2600)),u=d(n(9135)),l=d(n(3196));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Members=void 0;var h=n(7187),p=n(5434),f=n(2126).Logger.scope("Members"),m=function(e){function t(e,n,r){(0,a.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return i.services=n,i.channel=e,i.members=r,i}var n,d,h,m;return(0,l.default)(t,e),(0,c.default)(t,[{key:"unsubscribe",value:(m=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:e.sent.close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"subscribe",value:function(e){var t=this;return this.rosterEntityPromise=this.rosterEntityPromise||this.services.syncClient.map({id:e,mode:"open_existing"}).then((function(e){e.on("itemAdded",(function(e){f.debug(t.channel.sid+" itemAdded: "+e.item.key),t.upsertMember(e.item.key,e.item.value).then((function(e){t.emit("memberJoined",e)}))})),e.on("itemRemoved",(function(e){f.debug(t.channel.sid+" itemRemoved: "+e.key);var n=e.key;if(t.members.has(n)){var r=t.members.get(n);t.members.delete(n),t.emit("memberLeft",r)}})),e.on("itemUpdated",(function(e){f.debug(t.channel.sid+" itemUpdated: "+e.item.key),t.upsertMember(e.item.key,e.item.value)}));var n=[],i=t;return e.getItems().then((function e(t){return t.items.forEach((function(e){n.push(i.upsertMember(e.key,e.value))})),t.hasNextPage?t.nextPage().then(e):null})).then((function(){return r.default.all(n)})).then((function(){return e}))})).catch((function(e){throw t.rosterEntityPromise=null,"disconnected"!=t.services.syncClient.connectionState&&f.error("Failed to get roster object for channel",t.channel.sid,e),f.debug("ERROR: Failed to get roster object for channel",t.channel.sid,e),e}))}},{key:"upsertMember",value:(h=(0,s.default)(i.default.mark((function e(t,n){var r,s=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.members.get(t))){e.next=3;break}return e.abrupt("return",r._update(n));case 3:return r=new p.Member(this.services,this.channel,n,t),this.members.set(t,r),r.on("updated",(function(e){return s.emit("memberUpdated",e)})),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"getMembers",value:function(){var e=this;return this.rosterEntityPromise.then((function(){var t=[];return e.members.forEach((function(e){return t.push(e)})),t}))}},{key:"getMemberBySid",value:(d=(0,s.default)(i.default.mark((function e(t){var n=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise.then((function(){var e=n.members.get(t);if(!e)throw new Error("Member with SID "+t+" was not found");return e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getMemberByIdentity",value:(n=(0,s.default)(i.default.mark((function e(t){var n,r=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",this.rosterEntityPromise.then((function(){if(r.members.forEach((function(e){e.identity===t&&(n=e)})),!n)throw new Error("Member with identity "+t+" was not found");return n})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"add",value:function(e){return this.services.session.addCommand("addMemberV2",{channelSid:this.channel.sid,username:e})}},{key:"invite",value:function(e){return this.services.session.addCommand("inviteMember",{channelSid:this.channel.sid,username:e})}},{key:"removeByIdentity",value:function(e){return this.services.session.addCommand("removeMember",{channelSid:this.channel.sid,username:e})}},{key:"removeBySid",value:function(e){return this.services.session.addCommand("removeMember",{channelSid:this.channel.sid,memberSid:e})}}]),t}(h.EventEmitter);t.Members=m},8894:(e,t,n)=>{"use strict";var r=p(n(6593)),i=p(n(3239)),s=p(n(4942)),o=p(n(6803)),a=p(n(2367)),c=p(n(5105)),u=p(n(9663)),l=p(n(2600)),d=p(n(9135)),h=p(n(3196));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Messages=void 0;var f=n(7187),m=n(2126),g=n(3171),y=m.Logger.scope("Messages"),v=function(e){function t(e,n){(0,u.default)(this,t);var r=(0,d.default)(this,(t.__proto__||(0,c.default)(t)).call(this));return r.channel=e,r.services=n,r.messagesByIndex=new a.default,r.messagesListPromise=null,r}var n,p,f;return(0,h.default)(t,e),(0,l.default)(t,[{key:"subscribe",value:function(e){var t=this;return this.messagesListPromise=this.messagesListPromise||this.services.syncClient.list({id:e,mode:"open_existing"}).then((function(e){return e.on("itemAdded",(function(e){y.debug(t.channel.sid+" itemAdded: "+e.item.index);var n=new g.Message(t.channel,t.services,e.item.index,e.item.value);t.messagesByIndex.has(n.index)?y.debug("Message arrived, but already known and ignored",t.channel.sid,n.index):(t.messagesByIndex.set(n.index,n),n.on("updated",(function(e){return t.emit("messageUpdated",e)})),t.emit("messageAdded",n))})),e.on("itemRemoved",(function(e){y.debug(t.channel.sid+" itemRemoved: "+e.index);var n=e.index;if(t.messagesByIndex.has(n)){var r=t.messagesByIndex.get(n);t.messagesByIndex.delete(r.index),r.removeAllListeners("updated"),t.emit("messageRemoved",r)}})),e.on("itemUpdated",(function(e){y.debug(t.channel.sid+" itemUpdated: "+e.item.index);var n=t.messagesByIndex.get(e.item.index);n&&n._update(e.item.value)})),e})).catch((function(e){throw t.messagesListPromise=null,"disconnected"!=t.services.syncClient.connectionState&&y.error("Failed to get messages object for channel",t.channel.sid,e),y.debug("ERROR: Failed to get messages object for channel",t.channel.sid,e),e}))}},{key:"unsubscribe",value:(f=(0,o.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=6;break}return e.next=3,this.messagesListPromise;case 3:e.sent.close(),this.messagesListPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"send",value:(p=(0,o.default)(s.default.mark((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.debug("Sending text message",t,n),e.abrupt("return",this.services.session.addCommand("sendMessage",{channelSid:this.channel.sid,text:t,attributes:(0,i.default)(n)}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"sendMedia",value:(n=(0,o.default)(s.default.mark((function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.debug("Sending media message",t,o),n=void 0,!("undefined"!=typeof FormData&&t instanceof FormData)){e.next=9;break}return y.debug("Sending media message as FormData",t,o),e.next=6,this.services.mcsClient.postFormData(t);case 6:n=e.sent,e.next=16;break;case 9:if(y.debug("Sending media message as SendMediaOptions",t,o),(r=t).contentType&&r.media){e.next=13;break}throw new Error("Media content <Channel#SendMediaOptions> must contain non-empty contentType and media");case 13:return e.next=15,this.services.mcsClient.post(r.contentType,r.media);case 15:n=e.sent;case 16:return e.abrupt("return",this.services.session.addCommand("sendMediaMessage",{channelSid:this.channel.sid,mediaSid:n.sid,attributes:(0,i.default)(o)}));case 17:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getMessages",value:function(e,t,n){return t=void 0!==t?t:"end",n=n||"backwards",this._getMessages(e,t,n)}},{key:"wrapPaginator",value:function(e,t,n){var r=this,i="desc"===e,s=function(){return t.nextPage().then((function(t){return r.wrapPaginator(e,t,n)}))},o=function(){return t.prevPage().then((function(t){return r.wrapPaginator(e,t,n)}))};return n(t.items).then((function(e){return{items:e.sort((function(e,t){return e.index-t.index})),hasPrevPage:i?t.hasNextPage:t.hasPrevPage,hasNextPage:i?t.hasPrevPage:t.hasNextPage,prevPage:i?s:o,nextPage:i?o:s}}))}},{key:"_upsertMessage",value:function(e,t){var n=this,r=this.messagesByIndex.get(e);if(r)return r;var i=new g.Message(this.channel,this.services,e,t);return this.messagesByIndex.set(i.index,i),i.on("updated",(function(e){return n.emit("messageUpdated",e)})),i}},{key:"_getMessages",value:function(e,t,n){var i=this;t=void 0!==t?t:"end",e=e||30;var s="backwards"===n?"desc":"asc";return this.messagesListPromise.then((function(n){return n.getItems({from:"end"!==t?t:void 0,pageSize:e,order:s})})).then((function(e){return i.wrapPaginator(s,e,(function(e){return r.default.all(e.map((function(e){return i._upsertMessage(e.index,e.value)})))}))}))}}]),t}(f.EventEmitter);t.Messages=v},1057:(e,t,n)=>{"use strict";var r=a(n(4942)),i=a(n(6803)),s=a(n(9663)),o=a(n(2600));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PublicChannels=void 0;var c=n(4081),u=n(8812),l=n(9122),d=function(){function e(t,n,r){(0,s.default)(this,e),this.client=t,this.services=n,this.url=r}var t,n,a;return(0,o.default)(e,[{key:"getChannels",value:(a=(0,i.default)(r.default.mark((function e(){var t,n,i=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new c.UriBuilder(this.url).arg("PageToken",s.pageToken).build(),e.next=3,this.services.network.get(t);case 3:return n=e.sent,e.abrupt("return",new u.RestPaginator(n.body.channels.map((function(e){return new l.ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),n.body.meta.previous_token,n.body.meta.next_token));case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getChannelBySid",value:(n=(0,i.default)(r.default.mark((function e(t){var n,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c.UriBuilder(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return i=e.sent,e.abrupt("return",new l.ChannelDescriptor(this.client,i.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c.UriBuilder(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return i=e.sent,e.abrupt("return",new l.ChannelDescriptor(this.client,i.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.PublicChannels=d},8412:(e,t,n)=>{"use strict";var r=a(n(4942)),i=a(n(6803)),s=a(n(9663)),o=a(n(2600));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserChannels=void 0;var c=n(4081),u=n(8812),l=n(9122),d=function(){function e(t,n,r){(0,s.default)(this,e),this.client=t,this.services=n,this.url=r}var t;return(0,o.default)(e,[{key:"getChannels",value:(t=(0,i.default)(r.default.mark((function e(){var t,n,i=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new c.UriBuilder(this.url).arg("PageToken",s.pageToken).build(),e.next=3,this.services.network.get(t);case 3:return n=e.sent,e.abrupt("return",new u.RestPaginator(n.body.channels.map((function(e){return new l.ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),n.body.meta.previous_token,n.body.meta.next_token));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();t.UserChannels=d},1689:(e,t,n)=>{"use strict";var r=a(n(4942)),i=a(n(6803)),s=a(n(9663)),o=a(n(2600));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserDescriptors=void 0;var c=n(4081),u=n(8812),l=n(7584),d=function(){function e(t,n){(0,s.default)(this,e),this.services=t,this.url=n}var t,n;return(0,o.default)(e,[{key:"getUserDescriptor",value:(n=(0,i.default)(r.default.mark((function e(t){var n,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c.UriBuilder(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return i=e.sent,e.abrupt("return",new l.UserDescriptor(this.services,i.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i,s=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c.UriBuilder(this.url).arg("ChannelSid",t).arg("PageToken",o.pageToken).build(),e.next=3,this.services.network.get(n);case 3:return i=e.sent,e.abrupt("return",new u.RestPaginator(i.body.users.map((function(e){return new l.UserDescriptor(s.services,e)})),(function(e){return s.getChannelUserDescriptors(t,{pageToken:e})}),i.body.meta.prev_token,i.body.meta.next_token));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.UserDescriptors=d},9068:(e,t,n)=>{"use strict";var r=d(n(4942)),i=d(n(6803)),s=d(n(2367)),o=d(n(5105)),a=d(n(9663)),c=d(n(2600)),u=d(n(9135)),l=d(n(3196));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Users=void 0;var h=n(7187),p=n(7920),f=n(1689),m=function(e){function t(e){(0,a.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return n.services=e,n.fifoStack=[],n.fifoStackMaxLength=100,n.myself=new p.User(null,null,n.services),n.myself.on("updated",(function(e){return n.emit("userUpdated",e)})),n.myself.on("userSubscribed",(function(){return n.emit("userSubscribed",n.myself)})),n.myself.on("userUnsubscribed",(function(){n.emit("userUnsubscribed",n.myself),n.myself._ensureFetched()})),n.services=e,n.subscribedUsers=new s.default,n.userDescriptorsPromise=n.services.session.getSessionLinks().then((function(e){return n.userDescriptors=new f.UserDescriptors({users:n,network:n.services.network},e.usersUrl),n.userDescriptors})),n.services.session.getMaxUserInfosToSubscribe().then((function(e){n.fifoStackMaxLength=e})),n.services.session.getUsersData().then((function(e){return n.myself.identity=e.identity,n.myself.entityName=e.user,n.myself._ensureFetched()})),n}var n,d,h,m;return(0,l.default)(t,e),(0,c.default)(t,[{key:"handleUnsubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)&&this.subscribedUsers.delete(e.identity);var t=-1;this.fifoStack.find((function(n,r){return n==e.identity&&(t=r,!0)}))&&this.fifoStack.splice(t,1),this.emit("userUnsubscribed",e)}},{key:"handleSubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)||(this.fifoStack.length>=this.fifoStackMaxLength&&this.subscribedUsers.get(this.fifoStack.shift()).unsubscribe(),this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e))}},{key:"getUser",value:(m=(0,i.default)(r.default.mark((function e(t){var n,i,s=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getUsersData();case 2:return e.next=4,this.myself._ensureFetched();case 4:if(t!=this.myself.identity){e.next=6;break}return e.abrupt("return",this.myself);case 6:if(n=this.subscribedUsers.get(t)){e.next=19;break}if(o){e.next=13;break}return e.next=11,this.getUserDescriptor(t);case 11:i=e.sent,o=i._getDescriptor().sync_unique_name;case 13:return(n=new p.User(t,o,this.services)).on("updated",(function(e){return s.emit("userUpdated",e)})),n.on("userSubscribed",(function(){return s.handleSubscribeUser(n)})),n.on("userUnsubscribed",(function(){return s.handleUnsubscribeUser(n)})),e.next=19,n._ensureFetched();case 19:return e.abrupt("return",n);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getUserDescriptor",value:(h=(0,i.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userDescriptorsPromise;case 2:return e.abrupt("return",this.userDescriptors.getUserDescriptor(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(d=(0,i.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userDescriptorsPromise;case 2:return e.abrupt("return",this.userDescriptors.getChannelUserDescriptors(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getSubscribedUsers",value:(n=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getUsersData();case 2:return e.next=4,this.myself._ensureFetched();case 4:return t=[this.myself],this.subscribedUsers.forEach((function(e){return t.push(e)})),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),t}(h.EventEmitter);t.Users=m},829:(e,t,n)=>{"use strict";var r=n(5560);e.exports=r},3446:(e,t,n)=>{"use strict";var r,i=n(9663),s=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationTypes=void 0;var o=function e(){(0,s.default)(this,e)};t.NotificationTypes=o,o.TYPING_INDICATOR="twilio.ipmsg.typing_indicator",o.NEW_MESSAGE="twilio.channel.new_message",o.ADDED_TO_CHANNEL="twilio.channel.added_to_channel",o.INVITED_TO_CHANNEL="twilio.channel.invited_to_channel",o.REMOVED_FROM_CHANNEL="twilio.channel.removed_from_channel",o.CONSUMPTION_UPDATE="twilio.channel.consumption_update"},1586:(e,t,n)=>{"use strict";var r,i=n(9663),s=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseCodes=void 0;var o=function e(){(0,s.default)(this,e)};t.ResponseCodes=o,o.HTTP_200_OK=200,o.HTTP_400_BAD_REQUEST=400,o.HTTP_404_NOT_FOUND=404,o.ACCESS_FORBIDDEN_FOR_IDENTITY=54007,o.LIST_NOT_FOUND=54150},2126:(e,t,n)=>{"use strict";var r=o(n(9663)),i=o(n(2600)),s=o(n(4043));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return[(new Date).toISOString()+" Chat "+e+":"].concat((0,s.default)(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var c=n(2043).getLogger("twilio-chat"),u=function(){function e(t){(0,r.default)(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?t+" ":""}return(0,i.default)(e,[{key:"setLevel",value:function(e){c.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.trace.apply(null,a(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.debug.apply(null,a(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.info.apply(null,a(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.warn.apply(null,a(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.error.apply(null,a(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){c.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.trace.apply(null,a("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.debug.apply(null,a("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.info.apply(null,a("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.warn.apply(null,a("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];c.error.apply(null,a("E",t))}}]),e}();t.Logger=u},3835:(e,t,n)=>{"use strict";var r=a(n(4942)),i=a(n(6803)),s=a(n(9663)),o=a(n(2600));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Media=void 0;var c=function(){function e(t,n){(0,s.default)(this,e),this.mcsMedia=null,this.services=n,this.state={sid:t.sid,filename:t.filename,contentType:t.contentType,size:t.size}}var t;return(0,o.default)(e,[{key:"getContentTemporaryUrl",value:(t=(0,i.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mcsMedia){e.next=8;break}if(!this.services.mcsClient){e.next=7;break}return e.next=4,this.services.mcsClient.get(this.state.sid);case 4:this.mcsMedia=e.sent,e.next=8;break;case 7:throw new Error("Media Content Service is unavailable");case 8:return e.abrupt("return",this.mcsMedia.getContentUrl());case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}}]),e}();t.Media=c},5434:(e,t,n)=>{"use strict";var r=y(n(6593)),i=y(n(3239)),s=y(n(4942)),o=y(n(6803)),a=y(n(2e3)),c=y(n(5105)),u=y(n(9663)),l=y(n(2600)),d=y(n(9135)),h=y(n(3196)),p=y(n(448)),f=y(n(2242)),m=y(n(2444)),g=y(n(8177));function y(e){return e&&e.__esModule?e:{default:e}}var v=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=(0,g.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,m.default)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&(0,f.default)(t,n,o),o},b=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,m.default)(Reflect))&&"function"==typeof p.default)return(0,p.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Member=void 0;var w=n(7187),k=n(4081),_=n(2126),S=n(1939),T=_.Logger.scope("Member"),x=function(e){function t(e,n,r,i){(0,u.default)(this,t);var s=(0,d.default)(this,(t.__proto__||(0,c.default)(t)).call(this));if(s.channel=n,s.services=e,s.state={attributes:k.parseAttributes(r.attributes,"Retrieved malformed attributes from the server for member: "+i,T),dateCreated:r.dateCreated?k.parseTime(r.dateCreated):null,dateUpdated:r.dateCreated?k.parseTime(r.dateUpdated):null,sid:i,typingTimeout:null,isTyping:!1,identity:r.identity||null,roleSid:r.roleSid||null,lastConsumedMessageIndex:(0,a.default)(r.lastConsumedMessageIndex)?r.lastConsumedMessageIndex:null,lastConsumptionTimestamp:r.lastConsumptionTimestamp?k.parseTime(r.lastConsumptionTimestamp):null,type:r.type||"chat",userInfo:r.userInfo},!r.identity&&!r.type)throw new Error("Received invalid Member object from server: Missing identity or type of Member.");return s}var n,r,p,f;return(0,h.default)(t,e),(0,l.default)(t,[{key:"_startTyping",value:function(e){var t=this;return clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this.state.typingTimeout=setTimeout((function(){return t._endTyping()}),e),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t=[],n=k.parseAttributes(e.attributes,"Retrieved malformed attributes from the server for member: "+this.state.sid,T);e.attributes&&!k.isDeepEqual(this.state.attributes,n)&&(this.state.attributes=n,t.push("attributes"));var r=k.parseTime(e.dateUpdated);e.dateUpdated&&r.getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=r,t.push("dateUpdated"));var i=k.parseTime(e.dateCreated);if(e.dateCreated&&i.getTime()!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=i,t.push("dateCreated")),e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t.push("roleSid")),!(0,a.default)(e.lastConsumedMessageIndex)&&null!==e.lastConsumedMessageIndex||this.state.lastConsumedMessageIndex===e.lastConsumedMessageIndex||(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,t.push("lastConsumedMessageIndex")),e.lastConsumptionTimestamp){var s=new Date(e.lastConsumptionTimestamp);this.state.lastConsumptionTimestamp&&this.state.lastConsumptionTimestamp.getTime()===s.getTime()||(this.state.lastConsumptionTimestamp=s,t.push("lastConsumptionTimestamp"))}return t.length>0&&this.emit("updated",{member:this,updateReasons:t}),this}},{key:"getUserDescriptor",value:(f=(0,o.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User Descriptor is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUserDescriptor(this.state.identity));case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"getUser",value:(p=(0,o.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"remove",value:(r=(0,o.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channel.removeMember(this));case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"updateAttributes",value:(n=(0,o.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editMemberAttributes",{channelSid:this.channel.sid,memberSid:this.sid,attributes:(0,i.default)(t)});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastConsumptionTimestamp",get:function(){return this.state.lastConsumptionTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}}]),t}(w.EventEmitter);v([S.asyncTypeCheck(["string","number","boolean","object",S.literal(null)]),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",r.default)],x.prototype,"updateAttributes",null),t.Member=x},3171:(e,t,n)=>{"use strict";var r=g(n(6593)),i=g(n(3239)),s=g(n(4942)),o=g(n(6803)),a=g(n(5105)),c=g(n(9663)),u=g(n(2600)),l=g(n(9135)),d=g(n(3196)),h=g(n(448)),p=g(n(2242)),f=g(n(2444)),m=g(n(8177));function g(e){return e&&e.__esModule?e:{default:e}}var y=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=(0,m.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,f.default)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&(0,p.default)(t,n,o),o},v=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,f.default)(Reflect))&&"function"==typeof h.default)return(0,h.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Message=void 0;var b=n(7187),w=n(4081),k=n(2126),_=n(3835),S=n(1939),T=k.Logger.scope("Message"),x=function(e){function t(e,n,r,i){(0,c.default)(this,t);var s=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return s.channel=e,s.services=n,s.state={sid:i.sid,index:r,author:null==i.author?null:i.author,body:i.text,timestamp:i.timestamp?new Date(i.timestamp):null,dateUpdated:i.dateUpdated?new Date(i.dateUpdated):null,lastUpdatedBy:i.lastUpdatedBy?i.lastUpdatedBy:null,attributes:w.parseAttributes(i.attributes,"Got malformed attributes for the message "+i.sid,T),type:i.type?i.type:"text",media:i.type&&"media"===i.type&&i.media?new _.Media(i.media,s.services):null,memberSid:null==i.memberSid?null:i.memberSid},s}var n,r,h,p;return(0,d.default)(t,e),(0,u.default)(t,[{key:"_update",value:function(e){var t=[];!e.text&&"string"!=typeof e.text||e.text===this.state.body||(this.state.body=e.text,t.push("body")),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t.push("lastUpdatedBy")),e.author&&e.author!==this.state.author&&(this.state.author=e.author,t.push("author")),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t.push("dateUpdated")),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t.push("dateCreated"));var n=w.parseAttributes(e.attributes,"Got malformed attributes for the message "+this.sid,T);w.isDeepEqual(this.state.attributes,n)||(this.state.attributes=n,t.push("attributes")),t.length>0&&this.emit("updated",{message:this,updateReasons:t})}},{key:"getMember",value:(p=(0,o.default)(s.default.mark((function e(){var t,n,r=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.state.memberSid){e.next=5;break}return e.next=4,this.channel.getMemberBySid(this.memberSid).catch((function(){return T.debug('Member with sid "'+r.memberSid+'" not found for message '+r.sid),null}));case 4:t=e.sent;case 5:if(t||!this.state.author){e.next=9;break}return e.next=8,this.channel.getMemberByIdentity(this.state.author).catch((function(){return T.debug('Member with identity "'+r.author+'" not found for message '+r.sid),null}));case 8:t=e.sent;case 9:if(!t){e.next=11;break}return e.abrupt("return",t);case 11:throw n="Member with ",this.state.memberSid&&(n+="SID '"+this.state.memberSid+"' "),this.state.author&&(this.state.memberSid&&(n+="or "),n+="identity '"+this.state.author+"' "),"Member with "===n&&(n="Member "),n+="was not found",new Error(n);case 17:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"remove",value:(h=(0,o.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("deleteMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString()});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"updateBody",value:(r=(0,o.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString(),text:t});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateAttributes",value:(n=(0,o.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editMessageAttributes",{channelSid:this.channel.sid,messageIdx:this.index,attributes:(0,i.default)(t)});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"body",get:function(){return"media"===this.type?null:this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"dateCreated",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"memberSid",get:function(){return this.state.memberSid}}]),t}(b.EventEmitter);y([S.asyncTypeCheck("string"),v("design:type",Function),v("design:paramtypes",[String]),v("design:returntype",r.default)],x.prototype,"updateBody",null),y([S.asyncTypeCheck(["string","number","boolean","object",S.literal(null)]),v("design:type",Function),v("design:paramtypes",[Object]),v("design:returntype",r.default)],x.prototype,"updateAttributes",null),t.Message=x},1900:(e,t,n)=>{"use strict";var r,i=n(9663),s=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.PushNotification=void 0;t.PushNotification=function e(t){(0,s.default)(this,e),this.title=t.title||null,this.body=t.body||null,this.sound=t.sound||null,this.badge=t.badge||null,this.action=t.action||null,this.type=t.type||null,this.data=t.data||{}}},8812:(e,t,n)=>{"use strict";var r=o(n(6593)),i=o(n(9663)),s=o(n(2600));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.RestPaginator=void 0;var a=function(){function e(t,n,r,s){(0,i.default)(this,e),this.state={prevToken:r,nextToken:s,source:n,items:t}}return(0,s.default)(e,[{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):r.default.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):r.default.reject(new Error("No previous page"))}},{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}}]),e}();t.RestPaginator=a},4131:(e,t,n)=>{"use strict";var r=a(n(6593)),i=a(n(2367)),s=a(n(2600)),o=a(n(9663));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ConsumptionHorizon=void 0;var c=n(2585),u=function(){function e(t){(0,o.default)(this,e),this.services=t,this.consumptionHorizonRequests=new i.default,this.consumptionHorizonUpdateTimer=null}return(0,s.default)(e,[{key:"getReportInterval",value:function(){return this.services.session.getConsumptionReportInterval().then((function(e){return 1e3*e}))}},{key:"delayedSendConsumptionHorizon",value:function(e){var t=this;null===this.consumptionHorizonUpdateTimer&&(this.sendConsumptionReport(!0),this.consumptionHorizonUpdateTimer=setTimeout((function(){t.sendConsumptionReport(!1)}),e))}},{key:"sendConsumptionReport",value:function(e){var t=this,n=[],r=new i.default;this.consumptionHorizonRequests.forEach((function(e,t){n.push(e.entry),r.set(t,e.promises)})),n.length>0&&this.services.session.addCommand("consumptionReportV2",{report:n}).then((function(e){return t.processConsumptionReportResponse(e,r)})).catch((function(e){return t.processConsumptionReportError(e,r)})),e||(this.consumptionHorizonUpdateTimer=null),this.consumptionHorizonRequests.clear()}},{key:"processConsumptionReportResponse",value:function(e,t){e&&e.report&&Array.isArray(e.report)&&e.report.length>0&&e.report.forEach((function(e){var n=e;if(t.has(n.channelSid)){var r=null;void 0!==n.unreadMessagesCount&&null!=n.unreadMessagesCount&&(r=n.unreadMessagesCount),t.get(n.channelSid).forEach((function(e){return e.resolve(r)})),t.delete(n.channelSid)}})),this.processConsumptionReportError(new c.SessionError("Error while setting LastConsumedMessageIndex",null),t)}},{key:"processConsumptionReportError",value:function(e,t){t.forEach((function(t){return t.forEach((function(t){return t.reject(e)}))}))}},{key:"updateLastConsumedMessageIndexForChannel",value:function(e,t){var n=this;return new r.default((function(r,i){n.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:i}),n.getReportInterval().then((function(e){return n.delayedSendConsumptionHorizon(e)}))}))}},{key:"advanceLastConsumedMessageIndexForChannel",value:function(e,t,n){var i=this,s=this.consumptionHorizonRequests.get(e);return new r.default((function(r,o){s&&s.entry?s.entry.messageIdx>=t?i.addPendingConsumptionHorizonRequest(e,s.entry,{resolve:r,reject:o}):i.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:o}):null!==n&&t<n?i.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:n},{resolve:r,reject:o}):i.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:o}),i.getReportInterval().then((function(e){return i.delayedSendConsumptionHorizon(e)}))}))}},{key:"addPendingConsumptionHorizonRequest",value:function(e,t,n){if(this.consumptionHorizonRequests.has(e)){var r=this.consumptionHorizonRequests.get(e);r.entry=t,r.promises.push(n)}else this.consumptionHorizonRequests.set(e,{entry:t,promises:[n]})}}]),e}();t.ConsumptionHorizon=u},735:(e,t,n)=>{"use strict";var r=h(n(4942)),i=h(n(6803)),s=h(n(6593)),o=h(n(6378)),a=h(n(2424)),c=h(n(2945)),u=h(n(2367)),l=h(n(9663)),d=h(n(2600));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Network=void 0;var p=n(9948),f=function(){function e(t,n){var r=this;(0,l.default)(this,e),this.config=t,this.services=n,this.cache=new u.default,this.cacheLifetime=0,this.services.session.getHttpCacheInterval().then((function(e){r.cacheLifetime=1e3*e,r.cleanupCache()}))}var t;return(0,d.default)(e,[{key:"backoffConfig",value:function(){return(0,c.default)(this.config.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==this.config.retryWhenThrottledDefault&&this.config.retryWhenThrottledDefault}},{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,o.default)(this.cache);!(e=(r=i.next()).done);e=!0){var s=r.value,c=(0,a.default)(s,2),u=c[0],l=c[1];this.isExpired(l.timestamp)&&this.cache.delete(u)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}0===this.cache.size&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval((function(){return e.cleanupCache()}),2*this.cacheLifetime)}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new s.default((function(r,i){var s=[502,503,504];n&&s.push(429);var o=new p.Retrier(t.backoffConfig());o.on("attempt",(function(){e().then((function(e){return o.succeeded(e)})).catch((function(e){s.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?o.failed(e):(o.removeAllListeners(),o.cancel(),i(e))}))})),o.on("succeeded",(function(e){r(e)})),o.on("cancelled",(function(e){return i(e)})),o.on("failed",(function(e){return i(e)})),o.start()}))}},{key:"get",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i,s,o=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))||this.isExpired(n.timestamp)){e.next=3;break}return e.abrupt("return",n.response);case 3:return i={},e.next=6,this.executeWithRetry((function(){return o.services.transport.get(t,i,o.config.productId)}),this.retryWhenThrottled());case 6:return s=e.sent,this.cache.set(t,{response:s,timestamp:Date.now()}),this.pokeTimer(),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.Network=f},157:(e,t,n)=>{"use strict";var r=a(n(6593)),i=a(n(2367)),s=a(n(9663)),o=a(n(2600));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.TypingIndicator=void 0;var c=n(2126),u=n(3446),l=c.Logger.scope("TypingIndicator"),d=function(){function e(t,n,r){(0,s.default)(this,e),this.config=t,this.services=n,this.getChannel=r,this.serviceTypingTimeout=null,this.sentUpdates=new i.default}return(0,o.default)(e,[{key:"initialize",value:function(){var e=this;this.services.notificationClient.subscribe(u.NotificationTypes.TYPING_INDICATOR,"twilsock"),this.services.notificationClient.on("message",(function(t,n){t===u.NotificationTypes.TYPING_INDICATOR&&e.handleRemoteTyping(n)}))}},{key:"handleRemoteTyping",value:function(e){var t=this;l.trace("Got new typing indicator ",e),this.getChannel(e.channel_sid).then((function(n){n&&n.members.forEach((function(n){if(n.identity===e.identity){var r=t.config.typingIndicatorTimeoutOverride+1e3||1e3*e.typing_timeout;n._startTyping(r)}}))})).catch((function(e){throw l.error(e),e}))}},{key:"send",value:function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?r.default.resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;l.trace("Sending typing indicator");var n=this.config.typingIndicatorUri,r="ChannelSid="+e;return this.services.transport.post(n,{"Content-Type":"application/x-www-form-urlencoded"},r,this.config.productId).then((function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)})).catch((function(e){throw l.error("Failed to send typing indicator:",e),e}))}},{key:"typingTimeout",get:function(){return this.config.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.config.typingIndicatorTimeoutDefault}}]),e}();t.TypingIndicator=d},9111:(e,t,n)=>{"use strict";var r=u(n(4942)),i=u(n(6803)),s=u(n(6593)),o=u(n(2367)),a=u(n(2600)),c=u(n(9663));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;var l=n(5877),d=n(1795),h=n(1586),p=n(2126),f=n(2585),m=n(6291),g=n(2604),y=n(7634).i8,v=p.Logger.scope("Session"),b=function e(){(0,c.default)(this,e)};var w=function(){function e(t,n){(0,c.default)(this,e);var r="undefined"!=typeof navigator?d.parse(navigator.userAgent):d;this.services=t,this.config=n,this.sessionInfo=new m.Deferred,this.currentContext={},this.pendingCommands=new o.default,this.sessionStreamPromise=null,this.endpointPlatform=["JS",y,r.os,r.name,r.version].join("|")}var t,n,u,p,w,k;return(0,a.default)(e,[{key:"handleContextUpdate",value:function(e){var t;(v.info("Session context updated"),v.debug("new session context:",e),this.currentContext=e,t=e,["identity","userInfo","links","myChannels","channels"].some((function(e){return!t.hasOwnProperty(e)})))||(v.info("new session context accepted"),this.sessionInfo.set(e))}},{key:"initialize",value:function(){var e=this,t={type:"IpMsgSession",apiVersion:"3",endpointPlatform:this.endpointPlatform};return this.sessionStreamPromise=this.services.syncClient.list({purpose:"com.twilio.rtd.ipmsg",context:t}).then((function(t){return v.info("Session created",t.sid),t.on("itemAdded",(function(t){return e.processCommandResponse(t.item)})),t.on("itemUpdated",(function(t){return e.processCommandResponse(t.item)})),t.on("contextUpdated",(function(t){return e.handleContextUpdate(t.context)})),t})).catch((function(e){throw v.error("Failed to create session",e),e})),this.sessionStreamPromise}},{key:"addCommand",value:function(e,t){return this.processCommand(e,t)}},{key:"processCommand",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=new b;return i.request=t,i.request.action=e,i.commandId=l.v4(),v.info("Adding command: ",e,i.commandId),v.debug("command arguments:",t,r),new s.default((function(s,o){n.sessionStreamPromise.then((function(e){return n.pendingCommands.set(i.commandId,{resolve:s,reject:o,commandId:i.commandId,request:i.request}),e.push(i)})).then((function(){return v.debug("Command accepted by server",i.commandId)})).catch((function(a){n.pendingCommands.delete(i.commandId),v.error("Failed to add a command to the session",a),a.code!=h.ResponseCodes.ACCESS_FORBIDDEN_FOR_IDENTITY&&a.code!==h.ResponseCodes.LIST_NOT_FOUND||!r?o(new Error("Can't add command: "+a.message)):(v.info("recreating session..."),n.initialize(),s(n.processCommand(e,t,!1)))}))}))}},{key:"processCommandResponse",value:function(e){if(e.value.hasOwnProperty("response")&&e.value.hasOwnProperty("commandId")&&this.pendingCommands.has(e.value.commandId)){var t=e.value,n=e.value.commandId;if(t.response.status===h.ResponseCodes.HTTP_200_OK){v.debug("Command succeeded: ",t);var r=this.pendingCommands.get(n).resolve;this.pendingCommands.delete(n),r(t.response)}else{v.error("Command failed: ",t);var i=this.pendingCommands.get(n).reject;this.pendingCommands.delete(n),i(new f.SessionError(t.response.statusText,t.response.status))}}}},{key:"getSessionContext",value:function(){return this.sessionStreamPromise.then((function(e){return e.getContext()}))}},{key:"getSessionLinks",value:(k=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",{publicChannelsUrl:this.config.baseUrl+t.links.publicChannelsUrl,myChannelsUrl:this.config.baseUrl+t.links.myChannelsUrl,typingUrl:this.config.baseUrl+t.links.typingUrl,syncListUrl:this.config.baseUrl+t.links.syncListUrl,usersUrl:this.config.baseUrl+t.links.usersUrl,mediaServiceUrl:t.links.mediaServiceUrl});case 4:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"getChannelsId",value:(w=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.channels);case 4:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"getMyChannelsId",value:(p=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.myChannels);case 4:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"getMaxUserInfosToSubscribe",value:(u=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",this.config.userInfosToSubscribeOverride||t.userInfosToSubscribe||this.config.userInfosToSubscribeDefault);case 4:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"getUsersData",value:function(){return this.sessionInfo.promise.then((function(e){return{user:e.userInfo,identity:e.identity}}))}},{key:"getConsumptionReportInterval",value:(n=(0,i.default)(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,n=this.config.consumptionReportIntervalOverride||t.consumptionReportInterval||this.config.consumptionReportIntervalDefault,e.prev=4,e.abrupt("return",g.toSeconds(g.parse(n)));case 8:return e.prev=8,e.t0=e.catch(4),v.error("Failed to parse consumption report interval",n,"using default value",this.config.consumptionReportIntervalDefault),e.abrupt("return",g.toSeconds(g.parse(this.config.consumptionReportIntervalDefault)));case 12:case"end":return e.stop()}}),e,this,[[4,8]])}))),function(){return n.apply(this,arguments)})},{key:"getHttpCacheInterval",value:(t=(0,i.default)(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,n=this.config.httpCacheIntervalOverride||t.httpCacheInterval||this.config.httpCacheIntervalDefault,e.prev=4,e.abrupt("return",g.toSeconds(g.parse(n)));case 8:return e.prev=8,e.t0=e.catch(4),v.error("Failed to parse cache interval",n,"using default value",this.config.httpCacheIntervalDefault),e.abrupt("return",g.toSeconds(g.parse(this.config.httpCacheIntervalDefault)));case 12:case"end":return e.stop()}}),e,this,[[4,8]])}))),function(){return t.apply(this,arguments)})},{key:"identity",get:function(){return this.sessionInfo.current.identity}},{key:"reachabilityEnabled",get:function(){return this.currentContext.reachabilityEnabled}}]),e}();t.Session=w},2585:(e,t,n)=>{"use strict";var r=d(n(5861)),i=d(n(5345)),s=d(n(4043)),o=d(n(4781)),a=d(n(5105)),c=d(n(9663)),u=d(n(9135)),l=d(n(3196));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SessionError=void 0;var h=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return r.name=r.constructor.name,r.message=e,r.code=n,Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,r}return(0,l.default)(t,e),t}(function(e){function t(){var t=(0,o.default)(e,(0,s.default)(arguments));return(0,i.default)(t,(0,a.default)(this)),t}return t.prototype=(0,r.default)(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i.default?(0,i.default)(t,e):t.__proto__=e,t}(Error));t.SessionError=h},4479:(e,t,n)=>{"use strict";var r=a(n(4942)),i=a(n(6803)),s=a(n(9663)),o=a(n(2600));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SyncList=void 0;var c=n(4081),u=n(8812),l=n(607),d=function(){function e(t){(0,s.default)(this,e),this.services=t}var t;return(0,o.default)(e,[{key:"getPage",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i,s,o=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},e.next=3,this.services.session.getSessionLinks();case 3:return n=e.sent,i=new c.UriBuilder(n.syncListUrl).arg("PageToken",t.pageToken).build(),e.next=7,this.services.network.get(i);case 7:return s=e.sent,e.abrupt("return",new u.RestPaginator(s.body.channels.map((function(e){return new l.SyncListDescriptor(e)})),(function(e){return o.getPage({pageToken:e})}),s.body.meta.previous_token,s.body.meta.next_token));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.SyncList=d},607:(e,t,n)=>{"use strict";var r,i=n(9663),s=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncListDescriptor=void 0;t.SyncListDescriptor=function e(t){(0,s.default)(this,e),this.descriptor=t,this.channel_sid=t.channel_sid,this.status=t.status,this.channel=t.channel,this.messages=t.messages,this.roster=t.roster,this.lastConsumedMessageIndex=t.last_consumed_message_index,this.notificationLevel=t.notification_level,this.status=t.status}},7920:(e,t,n)=>{"use strict";var r=g(n(3239)),i=g(n(4942)),s=g(n(6803)),o=g(n(6593)),a=g(n(5105)),c=g(n(9663)),u=g(n(2600)),l=g(n(9135)),d=g(n(3196)),h=g(n(448)),p=g(n(2242)),f=g(n(2444)),m=g(n(8177));function g(e){return e&&e.__esModule?e:{default:e}}var y=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=(0,m.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,f.default)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&(0,p.default)(t,n,o),o},v=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,f.default)(Reflect))&&"function"==typeof h.default)return(0,h.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var b=n(7187),w=n(2126),k=n(4081),_=n(1939),S=w.Logger.scope("User"),T=function(e){function t(e,n,r){(0,c.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return i.subscribed="initializing",i.setMaxListeners(0),i.services=r,i.state={identity:e,entityName:n,friendlyName:null,attributes:{},online:null,notifiable:null},i}var n,h,p,f;return(0,d.default)(t,e),(0,u.default)(t,[{key:"_update",value:function(e,t){var n=[];switch(S.debug("User for",this.state.identity,"updated:",e,t),e){case"friendlyName":this.state.friendlyName!==t.value&&(n.push("friendlyName"),this.state.friendlyName=t.value);break;case"attributes":var r=k.parseAttributes(t.value,"Retrieved malformed attributes from the server for user: "+this.state.identity,S);k.isDeepEqual(this.state.attributes,r)||(this.state.attributes=r,n.push("attributes"));break;case"reachability":this.state.online!==t.online&&(this.state.online=t.online,n.push("online")),this.state.notifiable!==t.notifiable&&(this.state.notifiable=t.notifiable,n.push("notifiable"));break;default:return}n.length>0&&this.emit("updated",{user:this,updateReasons:n})}},{key:"_updateReachabilityInfo",value:function(e,t){var n=this;return this.services.session.reachabilityEnabled?e.get("reachability").then(t).catch((function(e){S.warn("Failed to get reachability info for ",n.state.identity,e)})):o.default.resolve()}},{key:"_fetch",value:(f=(0,s.default)(i.default.mark((function e(){var t=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.entityName){e.next=2;break}return e.abrupt("return",this);case 2:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then((function(e){return t.entity=e,e.on("itemUpdated",(function(e){return S.debug(t.state.entityName+" ("+t.state.identity+") itemUpdated: "+e.item.key),t._update(e.item.key,e.item.value)})),o.default.all([e.get("friendlyName").then((function(e){return t._update(e.key,e.value)})),e.get("attributes").then((function(e){return t._update(e.key,e.value)})),t._updateReachabilityInfo(e,(function(e){return t._update(e.key,e.value)}))])})).then((function(){return S.debug("Fetched for",t.identity),t.subscribed="subscribed",t.emit("userSubscribed",t),t})).catch((function(e){throw t.promiseToFetch=null,e})),e.abrupt("return",this.promiseToFetch);case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"_ensureFetched",value:function(){return this.promiseToFetch||this._fetch()}},{key:"updateAttributes",value:(p=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("unsubscribed"!=this.subscribed){e.next=2;break}throw new Error("Can't modify unsubscribed object");case 2:return e.next=4,this.services.session.addCommand("editUserAttributes",{username:this.state.identity,attributes:(0,r.default)(t)});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateFriendlyName",value:(h=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("unsubscribed"!=this.subscribed){e.next=2;break}throw new Error("Can't modify unsubscribed object");case 2:return e.next=4,this.services.session.addCommand("editUserFriendlyName",{username:this.state.identity,friendlyName:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"unsubscribe",value:(n=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.promiseToFetch){e.next=7;break}return e.next=3,this.promiseToFetch;case 3:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"online",get:function(){return this.state.online}},{key:"notifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return"subscribed"==this.subscribed}}]),t}(b.EventEmitter);y([_.asyncTypeCheck(["string","number","boolean","object",_.literal(null)]),v("design:type",Function),v("design:paramtypes",[Object]),v("design:returntype",o.default)],T.prototype,"updateAttributes",null),y([_.asyncTypeCheck(["string",_.literal(null)]),v("design:type",Function),v("design:paramtypes",[Object]),v("design:returntype",o.default)],T.prototype,"updateFriendlyName",null),t.User=T},7584:(e,t,n)=>{"use strict";var r=s(n(9663)),i=s(n(2600));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserDescriptor=void 0;var o=n(2126),a=n(4081),c=o.Logger.scope("UserDescriptor"),u=function(){function e(t,n){(0,r.default)(this,e),this.services=t,this.descriptor=n,this.identity=n.identity,this.friendlyName=n.friendly_name,this.attributes=a.parseAttributes(n.attributes,"Failed to parse user attributes",c),this.online=n.is_online,this.notifiable=n.is_notifiable}return(0,i.default)(e,[{key:"subscribe",value:function(){return this.services.users.getUser(this.identity,this.descriptor.sync_unique_name)}},{key:"_getDescriptor",value:function(){return this.descriptor}}]),e}();t.UserDescriptor=u},6291:(e,t,n)=>{"use strict";var r=o(n(6593)),i=o(n(9663)),s=o(n(2600));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;var a=function(){function e(){var t=this;(0,i.default)(this,e),this._promise=new r.default((function(e,n){t._resolve=e,t._reject=n}))}return(0,s.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();t.Deferred=a},4081:(e,t,n)=>{"use strict";var r=o(n(9663)),i=o(n(2600)),s=o(n(3239));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.parseAttributes=t.parseTime=t.parseToNumber=t.UriBuilder=t.deepClone=t.isDeepEqual=void 0;var a=n(3431);t.isDeepEqual=function(e,t){return 0===a.createPatch(e,t).length},t.deepClone=function(e){return JSON.parse((0,s.default)(e))},t.parseToNumber=function(e){return void 0===e||isNaN(Number(e))?null:Number(e)},t.parseTime=function(e){try{return new Date(e)}catch(e){return null}},t.parseAttributes=function(e,t,n){var r={};if(e)try{r=JSON.parse(e)}catch(e){n.warn(t,e)}return r};var c=function(){function e(t){(0,r.default)(this,e),this.base=t.replace(/\/$/,""),this.args=[],this.paths=[]}return(0,i.default)(e,[{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"path",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();t.UriBuilder=c},1939:(e,t,n)=>{"use strict";var r=a(n(6593)),i=a(n(2424)),s=a(n(2444)),o=a(n(2e3));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.pureObject=t.nonNegativeInteger=t.nonEmptyString=t.stringifyReceivedType=t.custom=t.literal=t.type=t.asyncTypeCheck=t.typeCheck=t.runtimeTypeCheck=void 0;var c=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{mode:"type",checks:t}};t.type=c;t.literal=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{mode:"literal",checks:t}};var u=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{mode:"custom",checks:t}};t.custom=u;var l=u((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]}));t.nonEmptyString=l;var d=u((function(e){return[(0,o.default)(e)&&e>=0,"a non-negative integer"]}));t.nonNegativeInteger=d;var h=u((function(e){return["object"===(void 0===e?"undefined":(0,s.default)(e))&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));t.pureObject=h;var p=function(e,t,n){if(t.length>e.length)throw new Error("Expected at most "+e.length+" argument(s), but got "+t.length);for(;t.length<e.length;)t.push(void 0);t.forEach((function(t,r){var o=e[r],a=[],c=void 0,u=!1;if(o.forEach((function(e){switch(e.mode){case"type":e.checks.forEach((function(e){if("string"==typeof e)return u=u||(void 0===t?"undefined":(0,s.default)(t))===e,void a.push("of type "+e);u=u||t instanceof e,a.push("an instance of "+e.name)}));break;case"literal":e.checks.forEach((function(e){u=u||t===e,a.push("string"==typeof e?'"'+e+'"':""+e)}));break;case"custom":e.checks.forEach((function(e){var n=e(t),r=(0,i.default)(n,3),s=r[0],o=r[1],l=r[2];u=u||s,!c&&l&&(c=l),a.push(o)}))}})),!u){var l=c||f(t),d=n?" of "+n:"",h=a.length-1,p=h>0?a.slice(0,h).join(", ")+" or "+a[h]:a.join(", ");throw new Error("Argument "+(r+1)+d+" is expected to be "+p+(h>1?";":",")+" but got "+l)}}))};t.runtimeTypeCheck=p;var f=function(e){var t,n=void 0;["undefined","boolean","number","bigint","string"].includes(void 0===e?"undefined":(0,s.default)(e))&&(n="string"==typeof e?'"'+e+'"':""+e);var r=null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name;return"object"===(void 0===e?"undefined":(0,s.default)(e))&&"Object"!==r&&(n=null===e?"null":"instance of "+r),n||(n=void 0===e?"undefined":(0,s.default)(e)),n};t.stringifyReceivedType=f;t.typeCheck=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=m(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The typeCheck decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return p(r,t,i.name),i.apply(this,arguments)}}};t.asyncTypeCheck=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=m(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The asyncTypeCheck decorator can only be applied to methods");var s=n.value;n.value=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];try{p(i,t,s.name)}catch(e){return r.default.reject(e)}return s.apply(this,arguments)}}};var m=function(e){var t=[];return e.forEach((function(e){var n=[];(Array.isArray(e)?e:[e]).forEach((function(e){["string","function"].includes(void 0===e?"undefined":(0,s.default)(e))?n.push(c(e)):n.push(e)})),t.push(n)})),t}},7634:e=>{"use strict";e.exports={i8:"4.1.0"}},3371:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2997),i=n(4202),s=n(5617);t.Media=s.Media,t.McsMedia=s.Media;const o=n(4901),a=n(682),c=r.Logger.scope(""),u=n(8313).i8,l="A valid Twilio token should be provided";class d{constructor(e,t,n={}){if(this.options=n,this.options.logLevel=this.options.logLevel||"silent",this.config=new i.Configuration(e,t,this.options),!e)throw new Error(l);c.setLevel(this.options.logLevel),this.options.transport=this.options.transport||new o.Transport,this.transport=this.options.transport,this.network=new a.Network(this.config,this.transport)}updateToken(e){if(c.info("updateToken"),!e)throw new Error(l);this.config.updateToken(e)}async get(e){let t=await this.network.get(`${this.config.baseUrl}/${e}`);return new s.Media(this.config,this.network,t.body)}async post(e,t){let n=await this.network.post(this.config.baseUrl,t,e);return new s.Media(this.config,this.network,n.body)}async postFormData(e){let t=await this.network.post(this.config.baseUrl,e);return new s.Media(this.config,this.network,t.body)}}t.Client=d,t.McsClient=d,d.version=u,t.default=d},4202:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Configuration=class{constructor(e,t,n){let r=n.MCS||n||{};this.region=r.region||n.region,this.baseUrl=(void 0===this.region?"https://mcs.us1.twilio.com":`https://mcs.${this.region}.twilio.com`)+t,this.token=e,this.retryWhenThrottledOverride=r.retryWhenThrottledOverride,this.backoffConfigOverride=r.backoffConfigOverride}static get backoffConfigDefault(){return{min:1e3,max:4e3,maxAttemptsCount:3}}static get retryWhenThrottledDefault(){return true}updateToken(e){this.token=e}}},6222:(e,t,n)=>{"use strict";const r=n(3371);e.exports=r},2997:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2043);function i(e,t){return[`${(new Date).toISOString()} MCS Client ${e}:`].concat(Array.from(t))}class s{constructor(e){this.prefix="",this.prefix=null!=e&&e.length>0?e+" ":""}static scope(e){return new s(e)}setLevel(e){r.setLevel(e)}static setLevel(e){r.setLevel(e)}trace(...e){r.trace.apply(null,i(this.prefix+"T",e))}debug(...e){r.debug.apply(null,i(this.prefix+"D",e))}info(...e){r.info.apply(null,i(this.prefix+"I",e))}warn(...e){r.warn.apply(null,i(this.prefix+"W",e))}error(...e){r.error.apply(null,i(this.prefix+"E",e))}static trace(...e){r.trace.apply(null,i("T",e))}static debug(...e){r.debug.apply(null,i("D",e))}static info(...e){r.info.apply(null,i("I",e))}static warn(...e){r.warn.apply(null,i("W",e))}static error(...e){r.error.apply(null,i("E",e))}}t.Logger=s},5617:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Media=class{constructor(e,t,n){this.config=e,this.network=t,this._update(n)}get sid(){return this.state.sid}get serviceSid(){return this.state.serviceSid}get dateCreated(){return this.state.dateCreated}get dateUpdated(){return this.state.dateUpdated}get contentType(){return this.state.contentType}get size(){return this.state.size}get fileName(){return this.state.filename}async getContentUrl(){let e=await this.network.get(`${this.config.baseUrl}/${this.sid}`);return this._update(e.body),Promise.resolve(this.state.contentDirectUrl)}_update(e){this.state={sid:e.sid,serviceSid:e.service_sid,channelSid:e.channel_sid,messageSid:e.message_sid,dateCreated:e.date_created?new Date(e.date_created):null,dateUpdated:e.date_updated?new Date(e.date_updated):null,size:e.size,contentType:e.content_type,url:e.url,contentUrl:e.links.content,contentDirectUrl:e.links.content_direct_temporary,filename:e.filename?e.filename:null}}}},682:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9948),i=n(2997),s=n(4202),o=i.Logger.scope("Network");t.Network=class{constructor(e,t){this.config=e,this.transport=t}backoffConfig(){return Object.assign(s.Configuration.backoffConfigDefault,this.config.backoffConfigOverride)}retryWhenThrottled(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==s.Configuration.retryWhenThrottledDefault&&s.Configuration.retryWhenThrottledDefault}executeWithRetry(e,t=!1){return new Promise(((n,i)=>{let s=[502,503,504];t&&s.push(429);let o=new r.Retrier(this.backoffConfig());o.on("attempt",(()=>{e().then((e=>o.succeeded(e))).catch((e=>{s.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?o.failed(e):(o.removeAllListeners(),o.cancel(),i(e))}))})),o.on("succeeded",(e=>{n(e)})),o.on("cancelled",(e=>i(e))),o.on("failed",(e=>i(e))),o.start()}))}async get(e){const t={"X-Twilio-Token":this.config.token};o.trace("sending GET request to ",e," headers ",t);let n=await this.executeWithRetry((()=>this.transport.get(e,t)),this.retryWhenThrottled());return o.trace("response",n),n}async post(e,t,n){let r,i={"X-Twilio-Token":this.config.token};"undefined"!=typeof FormData&&t instanceof FormData||!n||Object.assign(i,{"Content-Type":n}),o.trace("sending POST request to ",e," headers ",i);try{r=await this.transport.post(e,i,t)}catch(e){throw e instanceof TypeError?(o.trace("got error in post response",e),new TypeError("Posting FormData supported only with browser engine's FormData")):e}return o.trace("response",r),r}}},4901:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7211),i=n.g.XMLHttpRequest||n(1377).XMLHttpRequest;class s{constructor(){}static request(e,t,n,s){return new Promise(((o,a)=>{let c=new i;c.open(e,t,!0),c.onreadystatechange=function(){if(4!==c.readyState)return;const e=(t=c.getAllResponseHeaders())?t.split("\r\n").map((e=>e.split(": "))).filter((e=>2===e.length&&e[1].length>0)).reduce(((e,t)=>(e[t[0]]=t[1],e)),{}):{};var t;const n=function(e){const t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(t){return e.responseText}}(c);if(200<=c.status&&c.status<300)o({status:c.status,headers:e,body:n});else{const t=c.statusText&&c.statusText.code?c.statusText.code:"NONE";let i;i="string"==typeof n?n&&1===n.split("\n",2).length?n:"":JSON.stringify(n);const s=`${c.status}: [${t}] ${i}`;a(new r.TransportError(s,c.status,n,t,e))}};for(let e in n)c.setRequestHeader(e,n[e]),"Content-Type"===e&&"application/json"===n[e]&&(s=JSON.stringify(s));c.send(s)}))}get(e,t){return s.request("GET",e,t)}post(e,t,n){return s.request("POST",e,t,n)}}t.Transport=s},7211:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends Error{constructor(e,t,n,r,i){super(e),this.code=t,this.body=n,this.status=r,this.headers=i}}t.TransportError=n},8313:e=>{"use strict";e.exports={i8:"0.3.3"}},653:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=n(7187),i=n(8022),s=n(8085),o=n(2508),a=n(3863);class c extends r.EventEmitter{constructor(e,t={}){if(super(),!e||0===e.length)throw new Error("Token is required for Notifications client");t.logLevel=t.logLevel||"error",a.log.setLevel(t.logLevel);t.minTokenRefreshInterval;const n=t.productId||"notifications";t.twilsockClient=t.twilsockClient||new i.TwilsockClient(e,n,t),t.transport=t.transport||t.twilsockClient,this.services={twilsock:t.twilsockClient,transport:t.transport,config:new s.Configuration(null,t)},this.registrar=new o.Registrar(n,this.services.transport,this.services.twilsock,this.services.config),this.reliableTransportState={overall:!1,transport:!1,registration:!1,lastEmitted:null},this._onTransportStateChange(this.services.twilsock.isConnected),this.registrar.on("transportReady",(e=>{this._onRegistrationStateChange(e?"registered":"")})),this.registrar.on("stateChanged",(e=>{this._onRegistrationStateChange(e)})),this.registrar.on("needReliableTransport",this._onNeedReliableTransport.bind(this)),this.services.twilsock.on("message",((e,t)=>this._routeMessage(e,t))),this.services.twilsock.on("connected",(e=>{this._onTransportStateChange(!0),this.registrar.setNotificationId("twilsock",e)})),this.services.twilsock.on("disconnected",(()=>{this._onTransportStateChange(!1)})),this.services.config.updateToken(e),this.registrar.updateToken(e)}get connectionState(){return"disconnected"===this.services.twilsock.state?"disconnected":"disconnecting"===this.services.twilsock.state?"disconnecting":"connected"===this.services.twilsock.state&&this.reliableTransportState.registration?"connected":"rejected"===this.services.twilsock.state?"denied":"connecting"}_routeMessage(e,t){a.log.trace("Message arrived: ",e,t),this.emit("message",e,t)}_onNeedReliableTransport(e){e?this.services.twilsock.connect():this.services.twilsock.disconnect()}_onRegistrationStateChange(e){this.reliableTransportState.registration="registered"===e,this._updateTransportState()}_onTransportStateChange(e){this.reliableTransportState.transport=e,this._updateTransportState()}_updateTransportState(){const e=this.reliableTransportState.transport&&this.reliableTransportState.registration;this.reliableTransportState.overall!==e&&(this.reliableTransportState.overall=e,a.log.info("Transport ready:",e),this.emit("transportReady",e)),this.reliableTransportState.lastEmitted!==this.connectionState&&(this.reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}subscribe(e,t="twilsock"){return a.log.trace("Add subscriptions for message type: ",e,t),this.registrar.subscribe(e,t)}unsubscribe(e,t="twilsock"){return a.log.trace("Remove subscriptions for message type: ",e,t),this.registrar.unsubscribe(e,t)}handlePushNotification(e){return{messageType:e.twi_message_type,payload:e.payload}}setPushRegistrationId(e,t){a.log.trace("Set push registration id",e,t),this.registrar.setNotificationId(t,e)}async updateToken(e){a.log.info("authTokenUpdated"),this.services.config.token!==e&&(await this.services.twilsock.updateToken(e),this.services.config.updateToken(e),this.registrar.updateToken(e))}}t.Client=c},8085:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;t.Configuration=class{constructor(e,t={}){let n=t.notifications||{};const r=`https://ers.${n.region||t.region||"us1"}.twilio.com/v1/registrations`;this.registrarUrl=n.ersUrl||r,this._token=e}updateToken(e){this._token=e}get token(){return this._token}}},6762:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Connector=t.RegistrationState=void 0;const r=n(7187),i=n(3863);class s{constructor(e="",t="",n=new Set){this.token=e,this.notificationId=t,this.messageTypes=n}clone(){return new s(this.token,this.notificationId,new Set(this.messageTypes))}}t.RegistrationState=s;class o extends r.EventEmitter{constructor(e){super(),this.config=e,this.desiredState=new s,this.currentState=new s,this.hasActiveAttempt=!1}async subscribe(e){this.desiredState.messageTypes.has(e)?i.log.debug("message type already registered ",e):(this.desiredState.messageTypes.add(e),await this.persistRegistration())}async unsubscribe(e){this.desiredState.messageTypes.has(e)&&(this.desiredState.messageTypes.delete(e),await this.persistRegistration())}updateToken(e){this.desiredState.token=e,this.persistRegistration()}async persistRegistration(){if(!this.config.token||0===this.config.token.length)return void i.log.trace("Can't persist registration: token is not set");if(this.hasActiveAttempt)return void i.log.trace("One registration attempt is already in progress");let[e,t]=function(e,t){let n=new Set;return e.notificationId!==t.notificationId&&n.add("notificationId"),e.token!==t.token&&n.add("token"),function(e,t){return[...[...e].filter((e=>!t.has(e))),...[...t].filter((t=>!e.has(t)))]}(e.messageTypes,t.messageTypes).length>0&&n.add("messageType"),[n.size>0,n]}(this.desiredState,this.currentState);if(e){this.currentState.notificationId||t.delete("notificationId"),i.log.trace("Persisting registration",t,this.desiredState);try{this.hasActiveAttempt=!0;let e=this.desiredState.clone();if(e.messageTypes.size>0){let n=await this.updateRegistration(e,t);this.currentState.token=n.token,this.currentState.notificationId=n.notificationId,this.currentState.messageTypes=n.messageTypes,this.emit("stateChanged","registered")}else await this.removeRegistration(),this.currentState.token=e.token,this.currentState.notificationId=e.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged","unregistered")}finally{this.hasActiveAttempt=!1,setTimeout((()=>this.persistRegistration()),0)}}}setNotificationId(e){this.desiredState.notificationId=e,this.persistRegistration()}}t.Connector=o},1684:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Notifications=void 0;const r=n(653);Object.defineProperty(t,"Notifications",{enumerable:!0,get:function(){return r.Client}})},3863:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=t.Logger=void 0;const r=n(2043);function i(e,t){return[`${(new Date).toISOString()} Notifications ${e}:`].concat(Array.from(t))}class s{constructor(){this.prefix=""}static scope(e=""){return new s}setLevel(e){r.setLevel(e)}trace(...e){r.debug.apply(null,i("T"+this.prefix,e))}debug(...e){r.debug.apply(null,i("D"+this.prefix,e))}info(...e){r.info.apply(null,i("I"+this.prefix,e))}warn(...e){r.warn.apply(null,i("W"+this.prefix,e))}error(...e){r.error.apply(null,i("E"+this.prefix,e))}}t.Logger=s;let o=s.scope();t.log=o},7214:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RegistrarConnector=t.Connector=void 0;const r=n(9948),i=n(3863),s=n(6762);Object.defineProperty(t,"Connector",{enumerable:!0,get:function(){return s.Connector}});let o={min:2e3,max:12e4,randomness:.2};class a extends s.Connector{constructor(e,t,n,r){super(r),this.channelType=e,this.context=t,this.transport=n}async updateRegistration(e,t){return t.has("notificationId")&&await this.removeRegistration(),e.notificationId&&e.notificationId.length?(await this.register(e),e):e}async removeRegistration(){if(!this.registrationId)return;const e=`${this.config.registrarUrl}/${this.registrationId}?productId=${this.context.productId}`,t={"Content-Type":"application/json","X-Twilio-Token":this.config.token};try{i.log.trace("Removing registration for ",this.channelType),await new r.Retrier(Object.assign(o,{maxAttemptsCount:3})).run((()=>this.transport.delete(e,t))),i.log.debug("Registration removed for",this.channelType)}catch(e){throw i.log.error("Failed to remove of registration ",this.channelType,e),e}}async register(e){i.log.trace("Registering",this.channelType,e);let t={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(e.messageTypes),data:{registration_id:e.notificationId},ttl:"PT24H"};const n=`${this.config.registrarUrl}?productId=${this.context.productId}`,s={"Content-Type":"application/json","X-Twilio-Token":e.token};i.log.trace("Creating registration for channel ",this.channelType);try{let e=await new r.Retrier(o).run((()=>this.transport.post(n,s,t)));this.registrationId=e.body.id,i.log.debug("Registration created: ",e)}catch(e){throw i.log.error("Registration failed: ",e),e}}}t.RegistrarConnector=a},2508:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Registrar=void 0;const r=n(7187),i=n(7214),s=n(8140);class o extends r.EventEmitter{constructor(e,t,n,r){super(),this.config=r,this.connectors=new Map;const o=this.detectPlatform();this.connectors.set("gcm",new i.RegistrarConnector("gcm",{protocolVersion:3,productId:e,platform:o},t,r)),this.connectors.set("fcm",new i.RegistrarConnector("fcm",{protocolVersion:3,productId:e,platform:o},t,r)),this.connectors.set("apn",new i.RegistrarConnector("apn",{protocolVersion:4,productId:e,platform:o},t,r)),this.connectors.set("twilsock",new s.TwilsockConnector({productId:e,platform:o},n,r)),this.connectors.get("twilsock").on("transportReady",(e=>this.emit("transportReady",e)))}setNotificationId(e,t){this.connector(e).setNotificationId(t)}subscribe(e,t){return this.connector(t).subscribe(e)}unsubscribe(e,t){return this.connector(t).unsubscribe(e)}updateToken(e){this.connectors.forEach((t=>t.updateToken(e)))}connector(e){let t=this.connectors.get(e);if(!t)throw new Error(`Unknown channel type: ${e}`);return t}detectPlatform(){let e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}t.Registrar=o},8140:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockConnector=void 0;const r=n(5877),i=n(6762);class s extends i.Connector{constructor(e,t,n){super(n),this.twilsock=t,this.context=e,e.id=r.v4(),this.twilsock.on("stateChanged",(e=>{"connected"!==e&&this.emit("transportReady",!1)})),this.twilsock.on("registered",(n=>{e&&n===e.id&&"connected"===t.state&&this.emit("transportReady",!0)}))}setNotificationId(...e){}updateToken(e){}async updateContextRequest(e){let t={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,message_types:e};this.emit("transportReady",!1),await this.twilsock.setNotificationsContext(this.context.id,t)}async updateRegistration(e,t){if(t.has("messageType"))return await this.updateContextRequest(Array.from(e.messageTypes)),e}removeRegistration(){return this.twilsock.removeNotificationsContext(this.context.id)}}t.TwilsockConnector=s},2812:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffRetrier=void 0;const r=n(7187),i=n(9948);class s extends r.EventEmitter{constructor(e){super(),this.options=e?Object.assign({},e):{}}get inProgress(){return!!this.retrier}start(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}stop(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}modifyBackoff(e){this.newBackoff=e}attemptFailed(){if(!this.inProgress)throw new Error("No attempt is in progress");if(this.newBackoff){!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():this.retrier.failed(new Error)}else this.retrier.failed(new Error)}cancel(){this.retrier&&this.retrier.cancel()}cleanRetrier(){this.retrier&&(this.retrier.removeAllListeners(),this.retrier.cancel(),this.retrier=null)}getRetryPolicy(){const e=Object.assign({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}createRetrier(){this.cleanRetrier();const e=this.getRetryPolicy();this.retrier=new i.Retrier(e),this.retrier.once("attempt",(()=>{this.retrier.on("attempt",(()=>this.emit("attempt"))),this.retrier.failed(new Error("Skipping first attempt"))})),this.retrier.on("failed",(e=>this.emit("failed",e))),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start().catch((e=>{}))}}t.BackoffRetrier=s},3584:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Twilsock=t.TwilsockClient=t.TelemetryEvents=void 0;const r=n(7187),i=n(6278),s=n(9325),o=n(8236),a=n(7430),c=n(8491),u=n(1521),l=n(7537),d=n(574),h=n(9275),p=n(4104),f=n(9448),m=n(5423);class g{}t.TelemetryEvents=g,g.TWILSOCK_CONNECT="twilsock.sdk.connect",g.TWILSOCK_INIT="twilsock.sdk.init";class y extends r.EventEmitter{constructor(e,t,n={}){super(),this.offlineStorageDeferred=new d.Deferred,n.continuationToken=n.continuationToken?n.continuationToken:f.TokenStorage.getStoredToken(t);let r=this.config=new s.Configuration(e,t,n);i.log.setLevel(r.logLevel);let p=new c.WebSocketChannel(r.url),y=n.transport?n.transport:new a.PacketInterface(p,r);this.channel=n.channel?n.channel:new o.TwilsockImpl(p,y,r),this.registrations=n.registrations?n.registrations:new u.Registrations(y),this.upstream=new l.Upstream(y,this.channel,r),this.telemetryTracker=new m.TelemetryTracker(r,y),this.channel.on("initialized",(()=>this.telemetryTracker.canSendTelemetry=!0)),p.on("disconnected",(()=>this.telemetryTracker.canSendTelemetry=!1)),this.registrations.on("registered",(e=>this.emit("registered",e))),this.channel.on("message",((e,t)=>setTimeout((()=>this.emit("message",e,t)),0))),this.channel.on("stateChanged",(e=>setTimeout((()=>this.emit("stateChanged",e)),0))),this.channel.on("connectionError",(e=>setTimeout((()=>this.emit("connectionError",e)),0))),this.channel.on("tokenAboutToExpire",(()=>setTimeout((()=>this.emit("tokenAboutToExpire")),0))),this.channel.on("tokenExpired",(()=>setTimeout((()=>this.emit("tokenExpired")),0))),this.channel.on("connected",(()=>this.registrations.updateRegistrations())),this.channel.on("connected",(()=>this.upstream.sendPendingMessages())),this.channel.on("connected",(()=>setTimeout((()=>this.emit("connected")),0))),this.channel.on("beforeConnect",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Establish WebSocket connection","",new Date),g.TWILSOCK_CONNECT,m.TelemetryPoint.Start))),this.channel.on("connected",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Establish WebSocket connection","",new Date,new Date),g.TWILSOCK_CONNECT,m.TelemetryPoint.End))),this.channel.on("beforeSendInit",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Send Twilsock init","",new Date),g.TWILSOCK_INIT,m.TelemetryPoint.Start))),this.channel.on("initialized",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Send Twilsock init","Succeeded",new Date,new Date),g.TWILSOCK_INIT,m.TelemetryPoint.End))),this.channel.on("sendInitFailed",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Send Twilsock init","Failed",new Date,new Date),g.TWILSOCK_INIT,m.TelemetryPoint.End))),this.channel.on("initialized",(e=>{this.handleStorageId(t,e),f.TokenStorage.storeToken(e.continuationToken,t),setTimeout((()=>this.emit("initialized",e)),0)})),this.channel.on("disconnected",(()=>setTimeout((()=>this.emit("disconnected")),0))),this.channel.on("disconnected",(()=>this.upstream.rejectPendingMessages())),this.channel.on("disconnected",(()=>this.offlineStorageDeferred.fail(new h.TwilsockError("Client disconnected")))),this.offlineStorageDeferred.promise.catch((()=>{}))}emit(e,...t){return i.log.debug(`Emitting ${e.toString()}(${t.map((e=>JSON.stringify(e))).join(", ")})`),super.emit(e,...t)}handleStorageId(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(p.OfflineProductStorage.create(t.offlineStorage[e])),i.log.debug(`Offline storage for '${e}' product: ${JSON.stringify(t.offlineStorage[e])}.`)}catch(n){this.offlineStorageDeferred.fail(new h.TwilsockError(`Failed to parse offline storage for ${e} ${JSON.stringify(t.offlineStorage[e])}. ${n}.`))}else this.offlineStorageDeferred.fail(new h.TwilsockError(`No offline storage id for '${e}' product: ${JSON.stringify(t.offlineStorage)}`));else this.offlineStorageDeferred.fail(new h.TwilsockError("No offline storage id"))}storageId(){return this.offlineStorageDeferred.promise}get isConnected(){return this.channel.isConnected}get state(){return this.channel.state}async updateToken(e){if(i.log.trace(`updating token '${e}'`),this.config.token!==e)return this.config.updateToken(e),this.channel.updateToken(e)}setNotificationsContext(e,t){this.registrations.setNotificationsContext(e,t)}removeNotificationsContext(e){this.registrations.removeNotificationsContext(e)}connect(){return this.channel.connect()}disconnect(){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEventsIncludingUnfinished),this.channel.disconnect()}get(e,t){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEvents),this.upstream.send("GET",e,t)}post(e,t,n){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEvents),this.upstream.send("POST",e,t,n)}put(e,t,n){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEvents),this.upstream.send("PUT",e,t,n)}delete(e,t){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEvents),this.upstream.send("DELETE",e,t)}addTelemetryEvent(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}addPartialTelemetryEvent(e,t,n){this.telemetryTracker.addPartialEvent(e,t,n),n===m.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}t.TwilsockClient=y,t.Twilsock=y},9325:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;t.Configuration=class{constructor(e,t,n={}){this.confirmedCapabilities=new Set,this.activeGrant=t,this._token=e;const r=`wss://tsock.${n.region||"us1"}.twilio.com/v3/wsconnect`;let i=n.twilsock||n.Twilsock||{};this.url=i.uri||r,this._continuationToken=n.continuationToken?n.continuationToken:null,this.logLevel=n.logLevel?n.logLevel:"error",this.retryPolicy=n.retryPolicy?n.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=n.clientMetadata?n.clientMetadata:{},this.clientMetadata.ver="0.5.14",this.initRegistrations=n.initRegistrations?n.initRegistrations:null,this.tweaks=n.tweaks?n.tweaks:null}get token(){return this._token}get continuationToken(){return this._continuationToken}updateToken(e){this._token=e}updateContinuationToken(e){this._continuationToken=e}}},574:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;t.Deferred=class{constructor(){this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}get promise(){return this._promise}update(e){this._resolve(e)}set(e){this.current=e,this._resolve(e)}fail(e){this._reject(e)}}},6947:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransportUnavailableError=void 0;const r=n(9275);class i extends r.TwilsockError{constructor(e){super(e)}}t.TransportUnavailableError=i},9275:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockError=void 0;class n extends Error{constructor(e){super(e)}}t.TwilsockError=n},6020:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockReplyError=void 0;const r=n(9275);class i extends r.TwilsockError{constructor(e,t){super(e),this.reply=t}}t.TwilsockReplyError=i},2001:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockUpstreamError=void 0;const r=n(9275);class i extends r.TwilsockError{constructor(e,t,n){super(t),this.status=e,this.description=t,this.body=n}}t.TwilsockUpstreamError=i},8022:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransportUnavailableError=t.TwilsockError=t.Twilsock=t.TwilsockClient=void 0;const r=n(3584);Object.defineProperty(t,"TwilsockClient",{enumerable:!0,get:function(){return r.TwilsockClient}}),Object.defineProperty(t,"Twilsock",{enumerable:!0,get:function(){return r.TwilsockClient}});const i=n(9275);Object.defineProperty(t,"TwilsockError",{enumerable:!0,get:function(){return i.TwilsockError}});const s=n(6947);Object.defineProperty(t,"TransportUnavailableError",{enumerable:!0,get:function(){return s.TransportUnavailableError}})},6278:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=t.Logger=void 0;const r=n(2043).getLogger("twilsock");function i(e,t){return[`${(new Date).toISOString()} Twilsock ${e}:`].concat(Array.from(t))}class s{constructor(e){this.prefix="",this.prefix=null!=e&&e.length>0?" "+e+":":""}setLevel(e){r.setLevel(e)}static setLevel(e){r.setLevel(e)}trace(...e){r.debug.apply(null,i("T",e))}debug(...e){r.debug.apply(null,i("D",e))}info(...e){r.info.apply(null,i("I",e))}warn(...e){r.warn.apply(null,i("W",e))}error(...e){r.error.apply(null,i("E",e))}static trace(...e){r.trace.apply(null,i("T",e))}static debug(...e){r.debug.apply(null,i("D",e))}static info(...e){r.info.apply(null,i("I",e))}static warn(...e){r.warn.apply(null,i("W",e))}static error(...e){r.error.apply(null,i("E",e))}}t.Logger=s;let o=new s("");t.log=o},1659:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;const r=n(1795);t.Metadata=class{static getMetadata(e){"undefined"!=typeof navigator&&r.parse(navigator.userAgent);let t=e&&e.clientMetadata?e.clientMetadata:{};const n={env:r.name,envv:r.version,os:r.os.family,osv:r.os.version,osa:r.os.architecture,sdk:"js-default"};let i={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter((e=>e in t||e in n)).forEach((e=>i[e]=e in t?t[e]:n[e])),i}}},4104:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineProductStorage=void 0;const r=n(9275);class i{constructor(e){this.id=e}static create(e){if(e instanceof Object&&"storage_id"in e)return new i(e.storage_id);throw new r.TwilsockError('Field "storage_id" is missing')}}t.OfflineProductStorage=i},7430:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PacketInterface=t.PacketResponse=void 0;const r=n(6278),i=n(5877),s=n(9275),o=n(6020),a=n(4631),c=n(2649),u=n(1659);t.PacketResponse=class{};t.PacketInterface=class{constructor(e,t){this.config=t,this.activeRequests=new Map,this.channel=e,this.channel.on("reply",(e=>this.processReply(e))),this.channel.on("disconnected",(()=>{this.activeRequests.forEach((e=>{clearTimeout(e.timeout),e.reject(new s.TwilsockError("disconnected"))})),this.activeRequests.clear()}))}get isConnected(){return this.channel.isConnected}processReply(e){const t=this.activeRequests.get(e.id);var n;t&&(clearTimeout(t.timeout),this.activeRequests.delete(e.id),(n=e.status.code)>=200&&n<300?t.resolve(e):(t.reject(new o.TwilsockReplyError("Transport failure: "+e.status.status,e)),r.log.trace("message rejected")))}storeRequest(e,t,n){let i={resolve:t,reject:n,timeout:setTimeout((()=>{r.log.trace("request",e,"is timed out"),n(new s.TwilsockError("Twilsock: request timeout: "+e))}),3e4)};this.activeRequests.set(e,i)}shutdown(){this.activeRequests.forEach((e=>{clearTimeout(e.timeout),e.reject(new s.TwilsockError("Twilsock: request cancelled by user"))})),this.activeRequests.clear()}async sendInit(){r.log.trace("sendInit");let e=u.Metadata.getMetadata(this.config),t=new c.Init(this.config.token,this.config.continuationToken,e,this.config.initRegistrations,this.config.tweaks),n=await this.sendWithReply(t);return new c.InitReply(n.id,n.header.continuation_token,n.header.continuation_token_status,n.header.offline_storage,n.header.init_registrations,n.header.debug_info,new Set(n.header.capabilities))}sendClose(){let e=new c.Close;this.send(e)}sendWithReply(e,t){return new Promise(((n,r)=>{let i=this.send(e,t);this.storeRequest(i,n,r)}))}send(e,t){e.id=e.id||`TM${i.v4()}`;let n=a.Parser.createPacket(e,function(e){switch(typeof e){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(t){throw r.log.debug("failed to send ",e,t),r.log.trace(t.stack),t}}}},4631:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const r=n(6278);function i(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode("0x"+t))).length}function s(e){let t=Array.prototype.map.call(e,(e=>String.fromCharCode(e))).join("").replace(/(.)/g,((e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}));return decodeURIComponent(t)}function o(e){return JSON.parse(s(e))}t.Parser=class{constructor(){}static parse(e){const t=new Uint8Array(e),n=function(e){let t="",n=0;for(;n<e.length;++n){const r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}const r=t.split(" ");return{size:n,protocol:r[0],version:r[1],headerSize:Number(r[2])}}(t);if("TWILSOCK"!==n.protocol||"V3.0"!==n.version)return void r.log.error(`unsupported protocol: ${n.protocol} ver ${n.version}`);let i=null;try{i=o(t.subarray(n.size,n.size+n.headerSize))}catch(t){return void r.log.error("failed to parse message header",t,e)}r.log.debug("message received: ",i.method),r.log.trace("message received: ",i);let a=null;if(i.payload_size>0){const c=2+n.size+n.headerSize,u=i.payload_size;if(i.hasOwnProperty("payload_type")&&0!==i.payload_type.indexOf("application/json"))0===i.payload_type.indexOf("text/plain")&&(a=s(t.subarray(c,c+u)));else try{a=o(t.subarray(c,c+u))}catch(t){return void r.log.error("failed to parse message body",t,e)}}return{method:i.method,header:i,payload:a}}static createPacket(e,t=""){e.payload_size=i(t);let n=JSON.stringify(e)+"\r\n",s="TWILSOCK V3.0 "+(i(n)-2)+"\r\n";return r.log.debug("send request:",s+n+t),function(e){let t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode("0x"+t))),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,((e,t)=>{n[t]=e.charCodeAt(0)})),n}(s+n+t).buffer}}},4926:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractMessage=void 0;const r=n(5877);t.AbstractMessage=class{constructor(e){this.id=e||`TM${r.v4()}`}}},1469:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Close=void 0;const r=n(4926);class i extends r.AbstractMessage{constructor(){super(),this.method="close"}}t.Close=i},2649:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Telemetry=t.Close=t.Reply=t.Message=t.Update=t.InitReply=t.Init=void 0;const r=n(8687);Object.defineProperty(t,"Init",{enumerable:!0,get:function(){return r.Init}});const i=n(2990);Object.defineProperty(t,"InitReply",{enumerable:!0,get:function(){return i.InitReply}});const s=n(505);Object.defineProperty(t,"Update",{enumerable:!0,get:function(){return s.Update}});const o=n(7013);Object.defineProperty(t,"Message",{enumerable:!0,get:function(){return o.Message}});const a=n(1425);Object.defineProperty(t,"Reply",{enumerable:!0,get:function(){return a.Reply}});const c=n(1469);Object.defineProperty(t,"Close",{enumerable:!0,get:function(){return c.Close}});const u=n(3743);Object.defineProperty(t,"Telemetry",{enumerable:!0,get:function(){return u.Telemetry}})},8687:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Init=void 0;const r=n(4926);class i extends r.AbstractMessage{constructor(e,t,n,r=null,i=null){super(),this.method="init",this.token=e,this.continuation_token=t,this.metadata=n,this.registrations=r,this.tweaks=i,this.capabilities=["client_update","offline_storage","telemetry.v1"]}}t.Init=i},2990:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InitReply=t.ContinuationTokenStatus=void 0;const r=n(4926);t.ContinuationTokenStatus=class{};class i extends r.AbstractMessage{constructor(e,t,n,r,i,s,o){super(e),this.continuationToken=t,this.continuationTokenStatus=n,this.offlineStorage=r,this.initRegistrations=i,this.debugInfo=s,this.confirmedCapabilities=o}}t.InitReply=i},7013:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Message=void 0;const r=n(4926);class i extends r.AbstractMessage{constructor(e,t,n){super(),this.method="message",this.active_grant=e,this.payload_type=t,this.http_request=n}}t.Message=i},1425:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Reply=void 0;const r=n(4926);class i extends r.AbstractMessage{constructor(e){super(e),this.method="reply",this.payload_type="application/json",this.status={code:200,status:"OK"}}}t.Reply=i},3743:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryEvent=t.Telemetry=void 0;const r=n(4926);t.TelemetryEvent=class{constructor(e,t,n,r,i,s){this.start=e,this.end=t,this.title=n,this.details=r,this.id=i,this.type=s}};class i extends r.AbstractMessage{constructor(e){super(),this.method="telemetry.v1",this.events=e}}t.Telemetry=i},505:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Update=void 0;const r=n(4926);class i extends r.AbstractMessage{constructor(e){super(),this.method="update",this.token=e}}t.Update=i},1521:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Registrations=void 0;const r=n(6278),i=n(7187),s=n(5877),o=n(9275);class a extends i.EventEmitter{constructor(e){super(),this.transport=e,this.registrations=new Map,this.registrationsInProgress=new Map}async putNotificationContext(e,t){const n={method:"put_notification_ctx",notification_ctx_id:e};await this.transport.sendWithReply(n,t)}async deleteNotificationContext(e){let t={method:"delete_notification_ctx",notification_ctx_id:e};await this.transport.sendWithReply(t)}async updateRegistration(e,t){r.log.debug("update registration for context",e);let n=this.registrationsInProgress.get(e);n||(n=new Set,this.registrationsInProgress.set(e,n));const i=s.v4();n.add(i);try{await this.putNotificationContext(e,t),r.log.debug("registration attempt succeeded for context",t),n.delete(i),0===n.size&&(this.registrationsInProgress.delete(e),this.emit("registered",e))}catch(s){r.log.warn("registration attempt failed for context",t),r.log.debug(s),n.delete(i),0===n.size&&(this.registrationsInProgress.delete(e),this.emit("registrationFailed",e,s))}}updateRegistrations(){r.log.trace(`refreshing ${this.registrations.size} registrations`),this.registrations.forEach(((e,t)=>{this.updateRegistration(t,e)}))}setNotificationsContext(e,t){if(!e||!t)throw new o.TwilsockError("Invalid arguments provided");this.registrations.set(e,t),this.transport.isConnected&&this.updateRegistration(e,t)}async removeNotificationsContext(e){this.registrations.has(e)&&(await this.deleteNotificationContext(e),this.transport.isConnected&&this.registrations.delete(e))}}t.Registrations=a},5423:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventSendingLimitation=t.TelemetryPoint=t.TelemetryEventDescription=t.TelemetryTracker=void 0;const r=n(3743),i=n(6278);class s{constructor(e,t,n,r,i,s){this.title=e,this.details=t,this.start=n,this.type=i,this.id=s,this.end=r}toTelemetryEvent(){const e=new Date;let t=this.start,n=this.end?this.end:e;if(n<t){let e=n;n=t,t=e}const i=t.getTime()-e.getTime(),s=n.getTime()-e.getTime();return new r.TelemetryEvent(i,s,this.title,this.details,this.id,this.type)}}var o,a;t.TelemetryEventDescription=s,function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(o||(o={})),t.TelemetryPoint=o,function(e){e[e.MinEventsPortion=0]="MinEventsPortion",e[e.AnyEvents=1]="AnyEvents",e[e.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished"}(a||(a={})),t.EventSendingLimitation=a;t.TelemetryTracker=class{constructor(e,t){this.minEventsPortionToSend=50,this.maxEventsPortionToSend=100,this.pendingEvents=new Map,this.readyEvents=[],this.hasInitializationFinished=!1,this._canSendTelemetry=!1,this.config=e,this.packetInterface=t}get isTelemetryEnabled(){return this.config.confirmedCapabilities.has("telemetry.v1")}get canSendTelemetry(){return this._canSendTelemetry&&this.isTelemetryEnabled}set canSendTelemetry(e){i.log.debug(`TelemetryTracker.canSendTelemetry: ${e} TelemetryTracker.isTelemetryEnabled: ${this.isTelemetryEnabled}`),this._canSendTelemetry&&!e&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=e,e&&this.sendTelemetry(a.AnyEvents),e&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}addTelemetryEvent(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}addPartialEvent(e,t,n){i.log.debug(`Adding ${n===o.Start?"starting":"ending"} timepoint for '${t}' event`);let r=this.pendingEvents.has(t);if(n===o.Start)r&&i.log.debug(`Overwriting starting point for '${t}' event`),this.pendingEvents.set(t,e);else{if(!r)return void i.log.error(`Could not find started event for '${t}' event`);this.addTelemetryEvent(this.merge(this.pendingEvents.get(t),e)),this.pendingEvents.delete(t)}}getTelemetryToSend(e){return this.canSendTelemetry&&0!=this.readyEvents.length?e==a.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(e==a.AnyEventsIncludingUnfinished):[]}getTelemetryPortion(e){const t=Math.min(this.readyEvents.length,this.maxEventsPortionToSend);let n=this.readyEvents.splice(0,t);return e&&n.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach(((e,t)=>{if(n.length>=this.maxEventsPortionToSend)return;let r=this.pendingEvents.get(t);this.pendingEvents.delete(t),n.push(new s(`[UNFINISHED] ${r.title}`,r.details,r.start,null,r.type,r.id))})),n}merge(e,t){return new s(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}sendTelemetryIfMinimalPortionCollected(){this.sendTelemetry(a.MinEventsPortion)}sendTelemetry(e){const t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new r.Telemetry(t.map((e=>e.toTelemetryEvent()))))}catch(e){i.log.debug(`Error while sending ${t.length} telemetry events due to ${e}; they will be resubmitted`),this.readyEvents=this.readyEvents.concat(t)}}}},7537:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Upstream=void 0;const r=n(6278),i=n(9275),s=n(2001),o=n(2649),a=n(6947);function c(e,t){const n=function(e){const t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){let e={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:null};if(e.search.length>0){let t=e.search.substring(1);e.params=t.split("&").map((e=>e.split("="))).reduce(((e,t)=>(e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e)),{})}return e}throw new i.TwilsockError("Incorrect URI: "+e)}(t);let r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}t.Upstream=class{constructor(e,t,n){this.config=n,this.transport=e,this.pendingMessages=[],this.twilsock=t}saveMessage(e){return new Promise(((t,n)=>{let s={message:e,resolve:t,reject:n,alreadyRejected:!1,timeout:setTimeout((()=>{r.log.debug("request is timed out"),n(new i.TwilsockError("Twilsock: request timeout")),s.alreadyRejected=!0}),2e4)};this.pendingMessages.push(s)}))}sendPendingMessages(){for(;this.pendingMessages.length;){let e=this.pendingMessages[0];if(!e.alreadyRejected)try{let t=e.message;this.actualSend(t).then((t=>e.resolve(t))).catch((t=>e.reject(t))),clearTimeout(e.timeout)}catch(e){r.log.debug("Failed to send pending message",e);break}this.pendingMessages.splice(0,1)}}rejectPendingMessages(){this.pendingMessages.forEach((e=>{e.reject(new a.TransportUnavailableError("Unable to connect: "+this.twilsock.getTerminationReason)),clearTimeout(e.timeout)})),this.pendingMessages.splice(0,this.pendingMessages.length)}async actualSend(e){let t=e.to,n=e.headers,r=e.body,i={host:t.host,path:t.path,method:t.method,params:t.params,headers:n},a=new o.Message(this.config.activeGrant,n["Content-Type"]||"application/json",i),c=await this.transport.sendWithReply(a,r);if((l=c)&&l.header&&l.header.http_status&&!((u=c.header.http_status.code)>=200&&u<300))throw new s.TwilsockUpstreamError(c.header.http_status.code,c.header.http_status.status,c.body);var u,l;return{status:c.header.http_status,headers:c.header.http_headers,body:c.body}}send(e,t,n={},r){if(this.twilsock.isTerminalState)return Promise.reject(new a.TransportUnavailableError("Unable to connect: "+this.twilsock.getTerminationReason));let i=function(e,t,n,r){return{to:c(e,t),headers:n,body:r}}(e,t,n,r);return this.twilsock.isConnected?this.actualSend(i):this.saveMessage(i)}}},9448:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenStorage=void 0;class r{static get sessionStorage(){try{return n.g.sessionStorage}catch(e){return null}}static get window(){try{return n.g.window}catch(e){return null}}static storeToken(e,t){r.canStore&&r.sessionStorage.setItem(r.getKeyName(t),e)}static getStoredToken(e){return r.canStore?r.sessionStorage.getItem(r.getKeyName(e)):null}static initialize(){if(r.canStore){r.sessionStorage.getItem(r.initializedFlag)&&this.clear(),r.sessionStorage.setItem(r.initializedFlag,"true"),r.window.addEventListener("unload",(()=>{r.sessionStorage.removeItem(r.initializedFlag)}))}}static clear(){if(r.canStore){let e=[];for(let t=0;t<r.sessionStorage.length;t++){const n=r.sessionStorage.key(t);0===n.indexOf(r.tokenStoragePrefix)&&e.push(n)}e.forEach((e=>r.sessionStorage.removeItem(e))),r.sessionStorage.removeItem(r.initializedFlag)}}static getKeyName(e){return`${r.tokenStoragePrefix}${e}`}static get canStore(){return r.sessionStorage&&r.window}}t.TokenStorage=r,r.initializedFlag="twilio_twilsock_token_storage",r.tokenStoragePrefix="twilio_continuation_token_",r.initialize()},8236:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockImpl=t.TwilsockChannel=t.Response=void 0;const r=n(7187),i=n(4907),s=n(6278),o=n(2649),a=n(4631),c=n(6020),u=n(2812);t.Response=class{};class l extends r.EventEmitter{constructor(e,t,n){super(),this.terminalStates=["disconnected","rejected"],this.lastEmittedState=void 0,this.tokenExpiredSasCode=20104,this.terminationReason="Connection is not initialized",this.websocket=e,this.websocket.on("connected",(()=>this.fsm.socketConnected())),this.websocket.on("disconnected",(e=>this.fsm.socketClosed())),this.websocket.on("message",(e=>this.onIncomingMessage(e))),this.websocket.on("socketError",(e=>this.emit("connectionError",{terminal:!1,message:e.message,httpStatusCode:null,errorCode:null}))),this.transport=t,this.config=n,this.retrier=new u.BackoffRetrier(n.retryPolicy),this.retrier.on("attempt",(()=>this.retry())),this.retrier.on("failed",(e=>{s.log.warn(`Retrying failed: ${e.message}`),this.disconnect()})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(()=>{s.log.debug("Browser reported connectivity state: online"),this.fsm.systemOnline()})),window.addEventListener("offline",(()=>{s.log.debug("Browser reported connectivity state: offline"),this.websocket.close(),this.fsm.socketClosed()}))),this.fsm=new i({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:()=>{this.setupSocket(),this.emit("connecting")},onEnterInitialising:()=>{this.sendInit()},onLeaveInitialising:()=>{this.cancelInit()},onEnterUpdating:()=>{this.sendUpdate()},onLeaveUpdating:()=>{this.cancelUpdate()},onEnterRetrying:()=>{this.initRetry(),this.emit("connecting")},onEnterConnected:()=>{this.resetBackoff(),this.onConnected()},onUserUpdateToken:()=>{this.resetBackoff()},onTokenRejected:()=>{this.resetBackoff(),this.closeSocket(!0),this.finalizeSocket()},onUserDisconnect:()=>{this.closeSocket(!0)},onEnterDisconnecting:()=>{this.startDisconnectTimer()},onLeaveDisconnecting:()=>{this.cancelDisconnectTimer()},onEnterWaitSocketClosed:()=>{this.startDisconnectTimer()},onLeaveWaitSocketClosed:()=>{this.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:()=>{this.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:()=>{this.cancelDisconnectTimer()},onDisconnected:()=>{this.resetBackoff(),this.finalizeSocket()},onReceiveClose:(e,t)=>{this.onCloseReceived(t)},onReceiveOffload:(e,t)=>{s.log.debug("onreceiveoffload: ",t),this.modifyBackoff(t.body),this.onCloseReceived(t.status)},onUnsupported:()=>{this.closeSocket(!0),this.finalizeSocket()},onError:(e,t)=>{this.closeSocket(t),this.finalizeSocket()},onEnterState:e=>{"none"!==e.from&&this.changeState(e)},onInvalidTransition:(e,t,n)=>{s.log.warn("FSM: unexpected transition",t,n)}}})}changeState(e){s.log.debug(`FSM: ${e.transition}: ${e.from} --\x3e ${e.to}`),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}resetBackoff(){s.log.trace("resetBackoff"),this.retrier.stop()}modifyBackoff(e){s.log.trace("modifyBackoff",e);let t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}startDisconnectTimer(){s.log.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout((()=>{s.log.debug("disconnecting is timed out"),this.closeSocket(!0)}),3e3)}cancelDisconnectTimer(){s.log.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}get isConnected(){return"connected"===this.state&&this.websocket.isConnected}get state(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"rejected";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}initRetry(){s.log.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}retry(){"connecting"!=this.fsm.state?(s.log.trace("retry"),this.websocket.close(),this.fsm.userRetry()):s.log.trace("can\t retry as already connecting")}onConnected(){this.emit("connected")}finalizeSocket(){s.log.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}setupSocket(){s.log.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}onIncomingMessage(e){let{method:t,header:n,payload:r}=a.Parser.parse(e);if("reply"!==t&&this.confirmReceiving(n),"notification"===t)this.emit("message",n.message_type,r);else if("reply"===n.method)this.transport.processReply({id:n.id,status:n.status,header:n,body:r});else if("client_update"===n.method)"token_about_to_expire"===n.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===n.method)if(308===n.status.code)s.log.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:n.status.status,body:r});else if(406===n.status.code){const e=`Server closed connection because can't parse protocol: ${JSON.stringify(n.status)}`;this.emitReplyConnectionError(e,n,!0),s.log.error(e),this.fsm.receiveFatalClose()}else 417===n.status.code?(s.log.error(`Server closed connection because can't parse client reply: ${JSON.stringify(n.status)}`),this.fsm.receiveFatalClose(n.status.status)):410===n.status.code?(s.log.warn(`Server closed connection: ${JSON.stringify(n.status)}`),this.fsm.receiveClose(n.status.status),this.emit("tokenExpired")):401===n.status.code?(s.log.error(`Server closed connection: ${JSON.stringify(n.status)}`),this.fsm.receiveClose(n.status.status)):(s.log.warn("unexpected message: ",n.status),this.fsm.receiveOffload({status:n.status.status,body:null}))}async sendInit(){s.log.trace("sendInit");try{this.emit("beforeSendInit");let e=await this.transport.sendInit();this.config.updateContinuationToken(e.continuationToken),this.config.confirmedCapabilities=e.confirmedCapabilities,this.fsm.initSuccess(e),this.emit("initialized",e),this.emit("tokenUpdated")}catch(e){if(e instanceof c.TwilsockReplyError){let t=!1;s.log.warn(`Init rejected by server: ${JSON.stringify(e.reply.status)}`),this.emit("sendInitFailed"),401===e.reply.status.code||403===e.reply.status.code?(t=!0,this.fsm.tokenRejected(e.reply.status),e.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.reply.status.code?(this.modifyBackoff(e.reply.body),this.fsm.initError(!0)):500===e.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(e.message,e.reply,t)}else this.terminationReason=e.message,this.emit("connectionError",{terminal:!0,message:e.message,httpStatusCode:null,errorCode:null}),this.fsm.initError(!0);this.emit("tokenUpdated",e)}}async sendUpdate(){s.log.trace("sendUpdate");let e=new o.Update(this.config.token);try{let t=await this.transport.sendWithReply(e);this.fsm.updateSuccess(t.body),this.emit("tokenUpdated")}catch(e){if(e instanceof c.TwilsockReplyError){let t=!1;s.log.warn(`Token update rejected by server: ${JSON.stringify(e.reply.status)}`),401===e.reply.status.code||403===e.reply.status.code?(t=!0,this.fsm.tokenRejected(e.reply.status),e.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.reply.status.code?(this.modifyBackoff(e.reply.body),this.fsm.updateError(e.reply.status)):this.fsm.updateError(e.reply.status),this.emitReplyConnectionError(e.message,e.reply,t)}else this.emit("error",!1,e.message,null,null),this.fsm.updateError(e);this.emit("tokenUpdated",e)}}emitReplyConnectionError(e,t,n){const r=t.status&&t.status.description?t.status.description:e,i=t.status.code,s=t.status&&t.status.errorCode?t.status.errorCode:null;n&&(this.terminationReason=r),this.emit("connectionError",{terminal:n,message:r,httpStatusCode:i,errorCode:s})}cancelInit(){s.log.trace("cancelInit")}cancelUpdate(){s.log.trace("cancelUpdate")}confirmReceiving(e){s.log.trace("confirmReceiving");try{this.transport.send(new o.Reply(e.id))}catch(e){s.log.debug("failed to confirm packet receiving",e)}}closeSocket(e){s.log.trace(`closeSocket (graceful: ${e})`),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout((()=>this.fsm.socketClosed()),0)}connect(){s.log.trace("connect"),this.fsm.userConnect()}disconnect(){return s.log.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise((e=>{this.disconnectedPromiseResolve=e,this.fsm.userDisconnect()}))}updateToken(e){return s.log.trace("updateToken:",e),new Promise(((e,t)=>{this.once("tokenUpdated",(n=>{n?t(n):e()})),this.fsm.userUpdateToken()}))}get isTerminalState(){return-1!==this.terminalStates.indexOf(this.fsm.state)}get getTerminationReason(){return this.terminationReason}onCloseReceived(e){this.websocket.close()}}t.TwilsockChannel=l,t.TwilsockImpl=l},8491:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketChannel=void 0;const r=n(7187),i=n(6278);class s extends r.EventEmitter{constructor(e){super(),this.url=e,this.WebSocket=n.g.WebSocket||n.g.MozWebSocket||n(418)}get isConnected(){return this.socket&&1===this.socket.readyState}connect(){i.log.trace("connecting to socket");let e=new this.WebSocket(this.url);e.binaryType="arraybuffer",e.onopen=()=>{i.log.debug(`socket opened ${this.url}`),this.emit("connected")},e.onclose=e=>{i.log.debug("socket closed",e),this.emit("disconnected",e)},e.onerror=e=>{i.log.debug("error:",e),this.emit("socketError",e)},e.onmessage=e=>{this.emit("message",e.data)},this.socket=e}send(e){this.socket.send(e)}close(){if(i.log.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}t.WebSocketChannel=s},9522:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;const r=n(36);class i{constructor(e,t){this.value=e,this.revision=t||0}get isValid(){return!0}}class s{constructor(e){this.revision=e}get isValid(){return!1}}class o{constructor(){this.items=new r.TreeMap}store(e,t,n){let r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new i(t,n)),t)}delete(e,t,n=!1){let r=this.items.get(e);(!r||r.revision<t||r&&!0===n)&&this.items.set(e,new s(t))}isKnown(e,t){let n=this.items.get(e);return n&&n.revision>=t}get(e){let t=this.items.get(e);return t&&t.isValid?t.value:null}has(e){let t=this.items.get(e);return t&&t.isValid}forEach(e){if(this.items)for(let[t,n]of this.items)n.isValid&&e(t,n.value)}}t.Cache=o,t.default=o},9755:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncClient=t.Client=void 0;const r=n(7187),i=n(6895),s=n(1684),o=n(2343),a=n(8191),c=n(3902),u=n(2681),l=n(6177),d=n(5500),h=n(3820),p=n(2091),f=n(336),m=n(5909),g=n(9120),y=n(9423),v=n(3266),b=n(6847),w=n(5251),k=n(7053),_=n(7053),S=n(2820).i8;function T(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};{c.validateOptionalTtl(e.ttl),c.validateId(e.id);let t=e.mode||(e.id?"open_or_create":"create_new");return Object.assign(Object.assign({},e),{mode:t})}}return{mode:"create_new"}}class x extends r.EventEmitter{constructor(e,t={}){if(super(),!e)throw new Error("Sync library needs a valid Twilio token to be passed");t.hasOwnProperty("logLevel")?u.default.setLevel(t.logLevel):u.default.setLevel("silent");const n=t.productId=t.productId||"data_sync";t.clientMetadata=t.clientMetadata||{},t.clientMetadata.hasOwnProperty("type")||(t.clientMetadata.type="sync"),t.clientMetadata.hasOwnProperty("sdk")||(t.clientMetadata.sdk="JS",t.clientMetadata.sdkv=S);let r=t.twilsockClient=t.twilsockClient||new i.Twilsock(e,n,t);r.on("tokenAboutToExpire",(e=>this.emit("tokenAboutToExpire",e))),r.on("tokenExpired",(()=>this.emit("tokenExpired"))),r.on("connectionError",(e=>this.emit("connectionError",e)));let o=t.notificationsClient=t.notificationsClient||new s.Notifications(e,t),a=new l.Configuration(t),c=new p.NetworkService(new y.ClientInfo(S),a,r),f=new b.SessionStorage(a);this.localStorageId=null,r.connect(),this.services={config:a,twilsock:r,notifications:o,network:c,storage:f,router:null,subscriptions:null};let m=new d.Subscriptions(this.services),g=new h.Router({config:a,subscriptions:m,notifications:o});this.services.router=g,this.services.subscriptions=m,this.entities=new v.EntitiesCache,o.on("connectionStateChanged",(()=>{this.emit("connectionStateChanged",this.services.notifications.connectionState)}))}static get version(){return S}get connectionState(){return this.services.notifications.connectionState}async ensureReady(){if(this.services.config.sessionStorageEnabled)try{let e=await this.services.twilsock.storageId();this.services.storage.updateStorageId(e.id)}catch(e){u.default.warn("Failed to initialize storage",e)}}storeRootInSessionCache(e,t,n){if(!this.services.config.sessionStorageEnabled||!t)return;let r=c.deepClone(n);e!==m.SyncList.type&&e!==g.SyncMap.type||(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}readRootFromSessionCache(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}async _get(e,t,n=!1){if(!t)throw new a.SyncError("Cannot get entity without id",404);const r=new o.UriBuilder(e).pathSegment(t).queryParam("Include",n?"items":void 0).build();return(await this.services.network.get(r)).body}_createDocument(e,t,n){const r={unique_name:e,data:t||{}};return void 0!==n&&(r.ttl=n),this.services.network.post(this.services.config.documentsUri,r).then((e=>(e.body.data=r.data,e.body)))}async _getDocument(e){return this.readRootFromSessionCache(f.SyncDocument.type,e)||this._get(this.services.config.documentsUri,e)}_createList(e,t,n,r){const i={unique_name:e,purpose:t,context:n};return void 0!==r&&(i.ttl=r),this.services.network.post(this.services.config.listsUri,i).then((e=>e.body))}async _getList(e){return this.readRootFromSessionCache(m.SyncList.type,e)||this._get(this.services.config.listsUri,e)}_createMap(e,t){const n={unique_name:e};return void 0!==t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then((e=>e.body))}async _getMap(e,t=!1){return this.readRootFromSessionCache(g.SyncMap.type,e)||this._get(this.services.config.mapsUri,e,t)}async _getStream(e){return this.readRootFromSessionCache(w.SyncStream.type,e)||this._get(this.services.config.streamsUri,e,!1)}async _createStream(e,t){const n={unique_name:e};void 0!==t&&(n.ttl=t);return(await this.services.network.post(this.services.config.streamsUri,n)).body}_getLiveQuery(e){return this.readRootFromSessionCache(k.LiveQuery.type,e)}getCached(e,t){return e&&this.entities.get(e,t)||null}removeFromCacheAndSession(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}async document(e){await this.ensureReady();let t,n=T(e);if("create_new"===n.mode)t=await this._createDocument(n.id,n.value,n.ttl);else{let r=this.getCached(n.id,f.SyncDocument.type);if(r)return new f.SyncDocument(r);try{t=await this._getDocument(n.id)}catch(r){if(404!==r.status||"open_existing"===n.mode)throw r;try{t=await this._createDocument(n.id,n.value,n.ttl)}catch(t){if(409===t.status)return this.document(e);throw t}}}this.storeRootInSessionCache(f.SyncDocument.type,n.id,t);let r=new f.SyncDocumentImpl(this.services,t,((e,t,n)=>this.removeFromCacheAndSession(e,t,n)));return r=this.entities.store(r),new f.SyncDocument(r)}async map(e){await this.ensureReady();let t,n=T(e);if("create_new"===n.mode)t=await this._createMap(n.id,n.ttl);else{let r=this.getCached(n.id,g.SyncMap.type);if(r)return new g.SyncMap(r);try{t=await this._getMap(n.id,n.includeItems)}catch(r){if(404!==r.status||"open_existing"===n.mode)throw r;try{t=await this._createMap(n.id,n.ttl)}catch(t){if(409===t.status)return this.map(e);throw t}}}this.storeRootInSessionCache(g.SyncMap.type,n.id,t);let r=new g.SyncMapImpl(this.services,t,((e,t,n)=>this.removeFromCacheAndSession(e,t,n)));return r=this.entities.store(r),new g.SyncMap(r)}async list(e){await this.ensureReady();let t,n=T(e);if("create_new"===n.mode)t=await this._createList(n.id,n.purpose,n.context,n.ttl);else{let r=this.getCached(n.id,m.SyncList.type);if(r)return new m.SyncList(r);try{t=await this._getList(n.id)}catch(r){if(404!==r.status||"open_existing"===n.mode)throw r;try{t=await this._createList(n.id,n.purpose,n.context,n.ttl)}catch(t){if(409===t.status)return this.list(e);throw t}}}this.storeRootInSessionCache(m.SyncList.type,n.id,t);let r=new m.SyncListImpl(this.services,t,((e,t,n)=>this.removeFromCacheAndSession(e,t,n)));return r=this.entities.store(r),new m.SyncList(r)}async stream(e){await this.ensureReady();let t,n=T(e);if("create_new"===n.mode)t=await this._createStream(n.id,n.ttl);else{let r=this.getCached(n.id,w.SyncStream.type);if(r)return new w.SyncStream(r);try{t=await this._getStream(n.id)}catch(r){if(404!==r.status||"open_existing"===n.mode)throw r;try{t=await this._createStream(n.id,n.ttl)}catch(t){if(409===t.status)return this.stream(e);throw t}}}this.storeRootInSessionCache(w.SyncStream.type,n.id,t);let r=new w.SyncStreamImpl(this.services,t,((e,t,n)=>this.removeFromCacheAndSession(e,t,n)));return r=this.entities.store(r),new w.SyncStream(r)}async shutdown(){await this.services.subscriptions.shutdown(),await this.services.twilsock.disconnect()}async updateToken(e){return e?this.services.twilsock.updateToken(e):Promise.reject(new Error("A valid Twilio token should be provided"))}async liveQuery(e,t){if(await this.ensureReady(),!e||"string"!=typeof e)throw new Error("Index name must contain a non-empty string value");let n=new o.UriBuilder(this.services.config.insightsUri).pathSegment(e).pathSegment("Items").build(),r=await _.queryItems({network:this.services.network,uri:n,queryString:t,type:k.LiveQuery.type}),i=this.getCached(r.query_id,k.LiveQuery.type);if(!i){let s=this._getLiveQuery(r.query_id);s||(s={indexName:e,queryExpression:t,sid:r.query_id,queryUri:n,last_event_id:r.last_event_id});const o=(e,t,n)=>this.removeFromCacheAndSession(e,t,n);i=new k.LiveQueryImpl(s,this.services,o,r.items)}return this.storeRootInSessionCache(k.LiveQuery.type,r.query_id,i.liveQueryDescriptor),i=this.entities.store(i),new k.LiveQuery(i)}async instantQuery(e){await this.ensureReady();return new k.InstantQuery({indexName:e,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:(e,t)=>this.liveQuery(e,t)})}}t.Client=x,t.SyncClient=x,t.default=x},9423:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientInfo=void 0;const r=n(1795);class i{constructor(e){this.sdk="js",this.sdkVer=e,this.os=r.os.family,this.osVer=r.os.version,this.pl=r.name,this.plVer=r.version}}t.ClientInfo=i,t.default=i},3846:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Closeable=void 0;const r=n(7187),i=n(5877);class s extends r.EventEmitter{constructor(){super(),this.closed=!1,this.uuid=i()}get listenerUuid(){return this.uuid}close(){this.removeAllListeners(),this.closed=!0}ensureNotClosed(){if(this.closed)throw new Error("Invalid operation on closed object")}}t.Closeable=s,t.default=s},6177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;t.Configuration=class{constructor(e={}){const t=`https://cds.${e.region||"us1"}.twilio.com`,n=e.cdsUri||t;var r,i,s;this.settings={subscriptionsUri:n+"/v4/Subscriptions",documentsUri:n+"/v3/Documents",listsUri:n+"/v3/Lists",mapsUri:n+"/v3/Maps",streamsUri:n+"/v3/Streams",insightsUri:n+"/v3/Insights",sessionStorageEnabled:(r=e.Sync,i="enableSessionStorage",s=!0,r&&void 0!==r[i]?r[i]:s),productId:e.productId}}get subscriptionsUri(){return this.settings.subscriptionsUri}get documentsUri(){return this.settings.documentsUri}get listsUri(){return this.settings.listsUri}get mapsUri(){return this.settings.mapsUri}get streamsUri(){return this.settings.streamsUri}get insightsUri(){return this.settings.insightsUri}get backoffConfig(){return this.settings.backoffConfig||{}}get sessionStorageEnabled(){return this.settings.sessionStorageEnabled}get productId(){return this.settings.productId}}},3266:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntitiesCache=void 0;t.EntitiesCache=class{constructor(){this.names=new Map,this.entities=new Map}store(e){let t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}getResolved(e,t){let n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}get(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}remove(e){let t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}},6862:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncEntity=void 0;class n{constructor(e,t){this.services=e,this.removalHandler=t,this.subscriptionState="none",this._attachedListeners=new Map}_advanceLastEventId(e,t){}reportFailure(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}_subscribe(){this.services.router.subscribe(this.sid,this)}_unsubscribe(){this.services.router.unsubscribe(this.sid)}_setSubscriptionState(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}close(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}attach(e){const t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}detach(e){this._attachedListeners.delete(e),this._attachedListeners.size||this.close()}broadcastEventToListeners(e,t){for(let n of this._attachedListeners.values())n.emit(e,t)}}t.SyncEntity=n,t.default=n},1137:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncMapItem=t.SyncMap=t.SyncListItem=t.SyncList=t.SyncDocument=t.SyncClient=void 0;const r=n(9755);Object.defineProperty(t,"SyncClient",{enumerable:!0,get:function(){return r.SyncClient}});const i=n(336);Object.defineProperty(t,"SyncDocument",{enumerable:!0,get:function(){return i.SyncDocument}});const s=n(5909);Object.defineProperty(t,"SyncList",{enumerable:!0,get:function(){return s.SyncList}});const o=n(8661);Object.defineProperty(t,"SyncListItem",{enumerable:!0,get:function(){return o.ListItem}});const a=n(9120);Object.defineProperty(t,"SyncMap",{enumerable:!0,get:function(){return a.SyncMap}});const c=n(7517);Object.defineProperty(t,"SyncMapItem",{enumerable:!0,get:function(){return c.MapItem}}),t.default=r.SyncClient,e.exports=r.SyncClient,e.exports.SyncClient=r.SyncClient},8661:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ListItem=void 0;class n{constructor(e){this.data=e}get uri(){return this.data.uri}get revision(){return this.data.revision}get lastEventId(){return this.data.lastEventId}get dateUpdated(){return this.data.dateUpdated}get dateExpires(){return this.data.dateExpires}get index(){return this.data.index}get value(){return this.data.value}update(e,t,n,r){return this.data.lastEventId=e,this.data.revision=t,this.data.value=n,this.data.dateUpdated=r,this}updateDateExpires(e){this.data.dateExpires=e}}t.ListItem=n,t.default=n},7053:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InstantQuery=t.LiveQuery=t.queryItems=t.LiveQueryImpl=t.InsightsItem=void 0;const r=n(2343),i=n(8191),s=n(2681),o=n(7187),a=n(6862),c=n(3846),u=n(9522);t.InsightsItem=class{};class l extends a.SyncEntity{constructor(e,t,n,r){super(t,n),this.descriptor=e,this.cache=new u.Cache,r&&r.forEach((e=>{this.cache.store(e.key,{key:e.key,value:e.data},e.revision)}))}get sid(){return this.descriptor.sid}get uniqueName(){return null}get type(){return l.type}static get type(){return"live_query"}get lastEventId(){return this.descriptor.last_event_id}get indexName(){return this.descriptor.indexName}get queryString(){return this.descriptor.queryExpression}get queryUri(){return this.descriptor.queryUri}get liveQueryDescriptor(){return this.descriptor}onRemoved(){}getItems(){const e={};return this.cache.forEach(((t,n)=>{e[t]=n.value})),e}_update(e,t){switch(e.type){case"live_query_item_updated":this.handleItemMutated(e.item_key,e.item_data,e.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(e.item_key,e.item_revision);break;case"live_query_updated":this.handleBatchUpdate(e.items)}t&&this._advanceLastEventId(e.last_event_id)}handleItemMutated(e,t,n){if(this.shouldIgnoreEvent(e,n))s.default.trace(`Item ${e} update skipped, revision: ${n}`);else{const r={key:e,value:t};this.cache.store(e,r,n),this.broadcastEventToListeners("itemUpdated",r)}}handleItemRemoved(e,t){const n=null===t;this.shouldIgnoreEvent(e,t)?s.default.trace(`Item ${e} delete skipped, revision: ${t}`):(this.cache.delete(e,t,n),this.broadcastEventToListeners("itemRemoved",{key:e}))}handleBatchUpdate(e){let t={};null!=e&&e.forEach((e=>{t[e.key]={data:e.data,revision:e.revision}})),this.cache.forEach(((e,n)=>{const r=t[e];null!=r?this.handleItemMutated(e,r.data,r.revision):this.handleItemRemoved(e,null),delete t[e]}));for(let e in t)this.handleItemMutated(e,t[e].data,t[e].revision)}shouldIgnoreEvent(e,t){return null!=e&&null!=t&&this.cache.isKnown(e,t)}_advanceLastEventId(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e)}}async function d(e){let{network:t,queryString:n,uri:r,type:s}=e;if(null==n)throw new i.SyncError("Invalid query",400,54507);const o={query_string:n};return s===h.type&&(o.type=s),(await t.post(r,o,void 0,!0)).body}t.LiveQueryImpl=l,t.queryItems=d;class h extends c.Closeable{constructor(e){super(),this.liveQueryImpl=e,this.liveQueryImpl.attach(this)}static get type(){return l.type}get type(){return l.type}get lastEventId(){return this.liveQueryImpl.lastEventId}get sid(){return this.liveQueryImpl.sid}close(){super.close(),this.liveQueryImpl.detach(this.listenerUuid)}getItems(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}t.LiveQuery=h;class p extends o.EventEmitter{constructor(e){super(),this.queryExpression=null,this.items={},Object.assign(this,e),this.updateIndexName(e.indexName)}static get type(){return"instant_query"}get type(){return p.type}async search(e){return this.items={},d({network:this.network,uri:this.queryUri,queryString:e}).then((t=>{this.queryExpression=e,t.items&&t.items.forEach((e=>{this.items[e.key]=e.data})),this.emit("searchResult",this.getItems())})).catch((t=>{throw s.default.error(`Error '${t.message}' while executing query '${e}'`),this.queryExpression=null,t}))}async subscribe(){return null==this.queryExpression?Promise.reject(new i.SyncError("Invalid query",400,54507)):this.liveQueryCreator(this.indexName,this.queryExpression)}getItems(){return this.items}updateIndexName(e){if(!e||"string"!=typeof e)throw new Error("Index name must contain a non-empty string value");this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}generateQueryUri(e){return new r.UriBuilder(this.insightsUri).pathSegment(e).pathSegment("Items").build()}}t.InstantQuery=p,t.default=h},7517:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapItem=void 0;t.MapItem=class{constructor(e){this.descriptor=e}get uri(){return this.descriptor.url}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get dateExpires(){return this.descriptor.date_expires}get key(){return this.descriptor.key}get value(){return this.descriptor.data}get dateUpdated(){return this.descriptor.date_updated}update(e,t,n,r){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=r,this}updateDateExpires(e){this.descriptor.date_expires=e}}},3595:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NamespacedMergingQueue=t.MergingQueue=void 0;class n{constructor(e){this.queuedRequests=[],this.isRequestInFlight=!1,this.inputMergingFunction=e}add(e,t){let n=new Promise(((n,r)=>this.queuedRequests.push({input:e,requestFunction:t,resolve:n,reject:r})));return this.wakeupQueue(),n}squashAndAdd(e,t){let n,r=this.queuedRequests;this.queuedRequests=[],r.length>0?(n=r.map((e=>e.input)).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;let i=this.add(n,t);return r.forEach((e=>i.then(e.resolve,e.reject))),i}isEmpty(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}wakeupQueue(){if(0!==this.queuedRequests.length&&!this.isRequestInFlight){let e=this.queuedRequests.shift();this.isRequestInFlight=!0,e.requestFunction(e.input).then(e.resolve,e.reject).then((e=>{this.isRequestInFlight=!1,this.wakeupQueue()}))}}}t.MergingQueue=n;t.NamespacedMergingQueue=class{constructor(e){this.queueByNamespaceKey=new Map,this.inputReducer=e}async add(e,t,n){return this.invokeQueueMethod(e,(e=>e.add(t,n)))}async squashAndAdd(e,t,n){return this.invokeQueueMethod(e,(e=>e.squashAndAdd(t,n)))}async invokeQueueMethod(e,t){this.queueByNamespaceKey.has(e)||this.queueByNamespaceKey.set(e,new n(this.inputReducer));const r=t(this.queueByNamespaceKey.get(e));return this.queueByNamespaceKey.get(e).isEmpty()&&this.queueByNamespaceKey.delete(e),r}}},7186:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Paginator=void 0;t.Paginator=class{constructor(e,t,n,r){this.prevToken=n,this.nextToken=r,this.items=e,this.source=t}get hasNextPage(){return!!this.nextToken}get hasPrevPage(){return!!this.prevToken}async nextPage(){if(!this.hasNextPage)throw new Error("No next page");return this.source(this.nextToken)}async prevPage(){if(!this.hasPrevPage)throw new Error("No previous page");return this.source(this.prevToken)}}},3820:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;const r=n(2681),i="com.twilio.rtd.cds.document",s="com.twilio.rtd.cds.list",o="com.twilio.rtd.cds.map",a="twilio.sync.event";class c{constructor(e){this.config=e.config,this.subscriptions=e.subscriptions,this.notifications=e.notifications,this.notifications.subscribe(a),this.notifications.subscribe(i),this.notifications.subscribe(s),this.notifications.subscribe(o),this.notifications.on("message",((e,t)=>this.onMessage(e,t))),this.notifications.on("transportReady",(e=>this.onConnectionStateChanged(e)))}onMessage(e,t){switch(r.default.trace("Notification type:",e,"content:",t),e){case i:case s:case o:this.subscriptions.acceptMessage(t,!1);break;case a:this.subscriptions.acceptMessage(t,!0)}}subscribe(e,t){this.subscriptions.add(e,t)}unsubscribe(e){this.subscriptions.remove(e)}onConnectionStateChanged(e){this.subscriptions.onConnectionStateChanged(e)}}t.Router=c,t.default=c},2091:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkService=void 0;const r=n(5877),i=n(8191),s=n(2681),o=n(9948),a=n(6895);function c(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function u(e){return e.body?e.body.code:0}function l(e){return 409===e.status?new i.SyncNetworkError(c(e),e.status,u(e),e.body):e.status?new i.SyncError(c(e),e.status,u(e)):e instanceof a.TransportUnavailableError?e:new i.SyncError(e.message,0,0)}t.NetworkService=class{constructor(e,t,n){this.clientInfo=e,this.config=t,this.transport=n}createHeaders(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+r.v4().replace(/-/g,"")}}backoffConfig(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}executeWithRetry(e,t=!0){return new Promise(((n,r)=>{let i=[502,503,504];t&&i.push(429);let s=new o.Retrier(this.backoffConfig());s.on("attempt",(()=>{e().then((e=>s.succeeded(e))).catch((e=>{if(i.includes(e.status)){let t=parseInt(e.headers?e.headers["Retry-After"]:null);s.failed(l(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?s.failed(l(e)):(s.removeAllListeners(),s.cancel(),r(l(e)))}))})),s.on("succeeded",(e=>{n(e)})),s.on("cancelled",(e=>r(l(e)))),s.on("failed",(e=>r(l(e)))),s.start()}))}get(e){let t=this.createHeaders();return s.default.debug("GET",e,"ID:",t["Twilio-Request-Id"]),this.executeWithRetry((()=>this.transport.get(e,t,this.config.productId)),!0)}post(e,t,n,r=!1){let i=this.createHeaders();return null!=n&&(i["If-Match"]=n),s.default.debug("POST",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry((()=>this.transport.post(e,i,t,this.config.productId)),r)}put(e,t,n){let r=this.createHeaders();return null!=n&&(r["If-Match"]=n),s.default.debug("PUT",e,"ID:",r["Twilio-Request-Id"]),this.executeWithRetry((()=>this.transport.put(e,r,t,this.config.productId)),!1)}delete(e){let t=this.createHeaders();return s.default.debug("DELETE",e,"ID:",t["Twilio-Request-Id"]),this.executeWithRetry((()=>this.transport.delete(e,t,this.config.productId)),!1)}}},6847:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStorage=void 0;t.SessionStorage=class{constructor(e,t){this.config=e,this.storageId=null;try{this.storage=t||sessionStorage}catch(e){}}storageKey(e,t){return`${this.storageId}::${e}::${t}`}get isReady(){return this.config.sessionStorageEnabled&&!!this.storageId}updateStorageId(e){this.storageId=e}store(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}read(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}remove(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(e){}}update(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}_store(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(e){}}_read(e){try{let t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}_apply(e,t){let n=this._read(e);if(!n)return!1;this._store(e,Object.assign(n,t))}}},5251:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncStreamImpl=t.SyncStream=void 0;const r=n(6862),i=n(3902),s=n(3846);class o extends r.SyncEntity{constructor(e,t,n){super(e,n),this.descriptor=t}get uri(){return this.descriptor.url}get links(){return this.descriptor.links}static get type(){return"stream"}get dateExpires(){return this.descriptor.date_expires}get type(){return"stream"}get lastEventId(){return null}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get uniqueName(){return this.descriptor.unique_name||null}async publishMessage(e){const t={data:e},n=(await this.services.network.post(this.links.messages,t)).body;return this._handleMessagePublished(n.sid,e,!1)}async setTtl(e){i.validateMandatoryTtl(e);try{const t={ttl:e},n=await this.services.network.post(this.uri,t);this.descriptor.date_expires=n.body.date_expires}catch(e){throw 404===e.status&&this.onRemoved(!1),e}}async removeStream(){await this.services.network.delete(this.uri),this.onRemoved(!0)}_update(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}_handleMessagePublished(e,t,n){const r={sid:e,value:t};return this.broadcastEventToListeners("messagePublished",{message:r,isLocal:!n}),r}onRemoved(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}}t.SyncStreamImpl=o;class a extends s.default{constructor(e){super(),this.syncStreamImpl=e,this.syncStreamImpl.attach(this)}get uri(){return this.syncStreamImpl.uri}get links(){return this.syncStreamImpl.links}static get type(){return o.type}get dateExpires(){return this.syncStreamImpl.dateExpires}get type(){return o.type}get lastEventId(){return null}get sid(){return this.syncStreamImpl.sid}get uniqueName(){return this.syncStreamImpl.uniqueName}async publishMessage(e){return this.ensureNotClosed(),this.syncStreamImpl.publishMessage(e)}async setTtl(e){return this.ensureNotClosed(),this.syncStreamImpl.setTtl(e)}async removeStream(){return this.ensureNotClosed(),this.syncStreamImpl.removeStream()}close(){super.close(),this.syncStreamImpl.detach(this.listenerUuid)}}t.SyncStream=a,t.default=a},5500:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subscriptions=void 0;const r=n(9948),i=n(8191),s=n(2681),o=n(6895);class a{constructor(e){this.localObject=e,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}get sid(){return this.localObject.sid}get type(){return this.localObject.type}get lastEventId(){return this.localObject.lastEventId}get indexName(){return this.localObject.indexName}get queryString(){return this.localObject.queryString}get isEstablished(){return this.established}update(e,t){this.localObject._update(e,t)}updatePending(e,t){this.pendingAction=e,this.pendingCorrelationId=t}reset(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}markAsFailed(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new i.SyncError(`Failed to subscribe on service events: ${e.error.message}`,e.error.status,e.error.code))}complete(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}setSubscriptionState(e){this.localObject._setSubscriptionState(e)}}t.Subscriptions=class{constructor(e){this.isConnected=!1,this.maxBatchSize=100,this.subscriptionTtlTimer=null,this.pendingPokeReason=null,this.services=e,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;this.backoff=r.Backoff.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",(()=>{let{action:e,subscriptions:t}=this.getSubscriptionUpdateBatch();e?this.applyNewSubscriptionUpdateBatch(e,t):(this.backoff.reset(),s.default.debug("All subscriptions resolved."))}))}getSubscriptionUpdateBatch(){function e(e,t,n,r){let i=[];for(let[s,o]of e){if(!t.get(s)&&n!==o.pendingAction&&!o.rejectedWithError&&(i.push(o),r&&i.length>=r))break}return i}let t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};let n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}persist(){this.backoff.backoff()}async applyNewSubscriptionUpdateBatch(e,t){if(!this.isConnected)return s.default.debug("Twilsock connection (required for subscription) not ready; waitingâ¦"),void this.backoff.reset();t=this.processLocalActions(e,t);const n=(new Date).getTime();for(const r of t)this.recordActionAttemptOn(r,e,n);let r=this.pendingPokeReason;this.pendingPokeReason=null;try{let i=await this.request(e,n,r,t),o=i.body.max_batch_size;if(!isNaN(parseInt(o))&&isFinite(o)&&o>0&&(this.maxBatchSize=o),!this.subscriptionTtlTimer){let e=i.body.ttl_in_s;!isNaN(parseFloat(e))&&isFinite(e)&&e>0&&(this.subscriptionTtlTimer=setTimeout((()=>this.onSubscriptionTtlElapsed()),1e3*e))}if("establish"===e){const e=i.body.estimated_delivery_in_ms;!isNaN(parseFloat(e))&&isFinite(e)&&e>0?setTimeout((()=>this.verifyPokeDelivery(n,e,t)),e):s.default.error(`Invalid timeout: ${e}`),t.filter((e=>e.pendingCorrelationId===n)).forEach((e=>e.setSubscriptionState("response_in_flight")))}this.backoff.reset()}catch(r){for(const n of t)this.recordActionFailureOn(n,e);r instanceof o.TransportUnavailableError?(s.default.debug(`Twilsock connection (required for subscription) not ready (c:${n}); waitingâ¦`),this.backoff.reset()):(s.default.debug(`Failed an attempt to ${e} subscriptions (c:${n}); retrying`,r),this.persist())}}verifyPokeDelivery(e,t,n){const r=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),i=r?(new Date).getTime()-r:t;if(i>=t)n.filter((t=>t.pendingCorrelationId===e)).forEach((e=>{e.updatePending(null,null),e.retryCount++,this.persisted.delete(e.sid)})),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e);else{setTimeout((()=>this.verifyPokeDelivery(e,t,n)),t-i)}}processLocalActions(e,t){return"cancel"===e?t.filter((e=>!e.rejectedWithError)):t}recordActionAttemptOn(e,t,n){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{let r=this.persisted.get(e.sid);r&&r.updatePending(t,n)}}recordActionFailureOn(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}request(e,t,n,r){let i=r.map((t=>({object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,query_string:"establish"===e?t.queryString:void 0}))),o=r.filter((e=>e.retryCount>0)).length;s.default.debug(`Attempting '${e}' request (c:${t}):`,i);const a={event_protocol_version:3,action:e,correlation_id:t,retried_requests:o,ttl_in_s:-1,requests:i};return"ttl"===n&&(a.reason=n),this.services.network.post(this.services.config.subscriptionsUri,a)}add(e,t){s.default.debug(`Establishing intent to subscribe to ${e}`);const n=this.subscriptions.get(e);n&&t&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new a(t)),this.persist())}remove(e){s.default.debug(`Establishing intent to unsubscribe from ${e}`);this.subscriptions.delete(e)&&this.persist()}acceptMessage(e,t){let n;switch(s.default.trace("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(n=e.event_type.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:{let r;switch(n[0]){case"map_":r=e.event.map_sid;break;case"list_":r=e.event.list_sid;break;case"document_":r=e.event.document_sid;break;case"stream_":r=e.event.stream_sid;break;case"live_query_":r=e.event.query_id,t=!1,!0===e.strictly_ordered&&(t=!0);break;default:r=void 0}this.applyEventToSubscribedEntity(r,e,t)}break;default:s.default.debug(`Dropping unknown message type ${e.event_type}`)}}applySubscriptionEstablishedMessage(e,t){const n=e.object_sid;let r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?"interrupted"===e.replay_status?(s.default.debug(`Event Replay for subscription to ${n} (c:${t}) interrupted; continuing eagerly.`),r.updatePending(null,null),this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(s.default.debug(`Event Replay for subscription to ${n} (c:${t}) completed. Subscription is ready.`),r.complete(e.last_event_id),this.persisted.set(e.object_sid,r),r.setSubscriptionState("established"),this.backoff.reset()):s.default.debug(`Late message for ${e.object_sid} (c:${t}) dropped.`),this.persist()}applySubscriptionCancelledMessage(e,t){let n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):s.default.debug(`Late message for ${e.object_sid} (c:${t}) dropped.`),this.persist()}applySubscriptionFailedMessage(e,t){const n=e.object_sid;let r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.pendingCorrelationId===t&&(s.default.error(`Failed to subscribe on ${i.sid}`,e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!r&&i&&(this.persisted.delete(n),i.setSubscriptionState("none")),this.persist()}applyEventToSubscribedEntity(e,t,n){if(!e)return;n=n||(()=>{let t=this.persisted.get(e);return t&&t.isEstablished})();let r=this.subscriptions.get(e);r?(t.event.type=t.event_type,r.update(t.event,n)):s.default.debug(`Message dropped for SID '${e}', for which there is no subscription.`)}onConnectionStateChanged(e){this.isConnected=e,e&&this.poke("reconnect")}onSubscriptionTtlElapsed(){this.isConnected&&this.poke("ttl")}poke(e){s.default.debug(`Triggering event replay for all subscriptions, reason=${e}`),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);let t=[];for(let e of this.persisted.values())e.reset(),e.rejectedWithError&&t.push(e);this.persisted.clear();for(let e of t)this.persisted.set(e.sid,e);this.persist()}shutdown(){this.backoff.reset(),this.subscriptions.clear()}}},336:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncDocumentImpl=t.SyncDocument=void 0;const r=n(8191),i=n(3902),s=n(2681),o=n(6862),a=n(3595),c=n(3846);class u extends o.SyncEntity{constructor(e,t,n){super(e,n),this.isDeleted=!1;this.updateMergingQueue=new a.MergingQueue(((e,t)=>"number"==typeof t.ttl?{ttl:t.ttl}:e)),this.descriptor=t,this.descriptor.data=this.descriptor.data||{},this.descriptor.date_updated=new Date(this.descriptor.date_updated)}get uri(){return this.descriptor.url}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get dateExpires(){return this.descriptor.date_expires}static get type(){return"document"}get type(){return"document"}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get value(){return this.descriptor.data}get dateUpdated(){return this.descriptor.date_updated}get uniqueName(){return this.descriptor.unique_name||null}_update(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":e.id>this.lastEventId?(this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{value:e.document_data,isLocal:!1}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data})):s.default.trace("Document update skipped, current:",this.lastEventId,", remote:",e.id);break;case"document_removed":this.onRemoved(!1)}}async set(e,t){const n=t||{};return i.validateOptionalTtl(n.ttl),this.updateMergingQueue.squashAndAdd(n,(t=>this._setUnconditionally(e,t.ttl)))}async mutate(e,t){const n=t||{};return i.validateOptionalTtl(n.ttl),this.updateMergingQueue.add(n,(t=>this._setWithIfMatch(e,t.ttl)))}async update(e,t){return this.mutate((t=>Object.assign(t,e)),t)}async setTtl(e){i.validateMandatoryTtl(e);const t=await this._postUpdateToServer({ttl:e});this.descriptor.date_expires=t.date_expires}async _setUnconditionally(e,t){let n=await this._postUpdateToServer({data:e,revision:void 0,ttl:t});return this._handleSuccessfulUpdateResult(n),this.value}async _setWithIfMatch(e,t){let n=e(i.deepClone(this.value));if(!n)return this.value;{let r=this.revision;try{let e=await this._postUpdateToServer({data:n,revision:r,ttl:t});return this._handleSuccessfulUpdateResult(e),this.value}catch(t){if(412===t.status)return await this._softSync(),this._setWithIfMatch(e);throw t}}}_handleSuccessfulUpdateResult(e){e.last_event_id>this.descriptor.last_event_id&&(this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.broadcastEventToListeners("updated",{value:this.value,isLocal:!0}))}async _postUpdateToServer(e){if(this.isDeleted)return Promise.reject(new r.SyncError("The Document has been removed",404,54100));{const t={data:e.data};void 0!==e.ttl&&(t.ttl=e.ttl);const n=e.revision;try{const r=await this.services.network.post(this.uri,t,n);return{revision:r.body.revision,data:e.data,last_event_id:r.body.last_event_id,date_updated:r.body.date_updated,date_expires:r.body.date_expires}}catch(e){throw 404===e.status&&this.onRemoved(!1),e}}}async _softSync(){return this.services.network.get(this.uri).then((e=>{const t={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return this._update(t),this})).catch((e=>{404===e.status?this.onRemoved(!1):s.default.error(`Can't get updates for ${this.sid}:`,e)}))}onRemoved(e){this.isDeleted||(this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e}))}async removeDocument(){if(this.isDeleted)return Promise.reject(new r.SyncError("The Document has been removed",404,54100));await this.services.network.delete(this.uri),this.onRemoved(!0)}}t.SyncDocumentImpl=u;class l extends c.default{constructor(e){super(),this.syncDocumentImpl=e,this.syncDocumentImpl.attach(this)}get uri(){return this.syncDocumentImpl.uri}get revision(){return this.syncDocumentImpl.revision}get lastEventId(){return this.syncDocumentImpl.lastEventId}get dateExpires(){return this.syncDocumentImpl.dateExpires}static get type(){return u.type}get type(){return u.type}get sid(){return this.syncDocumentImpl.sid}get value(){return this.syncDocumentImpl.value}get dateUpdated(){return this.syncDocumentImpl.dateUpdated}get uniqueName(){return this.syncDocumentImpl.uniqueName}async set(e,t){return this.ensureNotClosed(),this.syncDocumentImpl.set(e,t)}async mutate(e,t){return this.ensureNotClosed(),this.syncDocumentImpl.mutate(e,t)}async update(e,t){return this.ensureNotClosed(),this.syncDocumentImpl.update(e,t)}async setTtl(e){return this.ensureNotClosed(),this.syncDocumentImpl.setTtl(e)}async removeDocument(){return this.ensureNotClosed(),this.syncDocumentImpl.removeDocument()}close(){super.close(),this.syncDocumentImpl.detach(this.listenerUuid)}}t.SyncDocument=l,t.default=l},5909:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncListImpl=t.SyncList=void 0;const r=n(3902),i=n(2343),s=n(8191),o=n(2681),a=n(6862),c=n(8661),u=n(7186),l=n(9522),d=n(3595),h=n(3846);class p extends a.SyncEntity{constructor(e,t,n){super(e,n);this.updateMergingQueue=new d.NamespacedMergingQueue(((e,t)=>"number"==typeof t.ttl?{ttl:t.ttl}:e)),this.cache=new l.Cache,this.descriptor=t,this.descriptor.date_updated=new Date(this.descriptor.date_updated)}get uri(){return this.descriptor.url}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get links(){return this.descriptor.links}get dateExpires(){return this.descriptor.date_expires}static get type(){return"list"}get type(){return"list"}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get uniqueName(){return this.descriptor.unique_name||null}get dateUpdated(){return this.descriptor.date_updated}async _addOrUpdateItemOnServer(e,t,n,r){const i={data:t};void 0!==r&&(i.ttl=r);const s=await this.services.network.post(e,i,n);return s.body.data=t,s.body.date_updated=new Date(s.body.date_updated),s.body}async push(e,t){let n=(t||{}).ttl;r.validateOptionalTtl(n);let i=await this._addOrUpdateItemOnServer(this.links.items,e,void 0,n),s=Number(i.index);return this._handleItemMutated(s,i.url,i.last_event_id,i.revision,e,i.date_updated,i.date_expires,!0,!1),this.cache.get(s)}async set(e,t,n){const i=n||{};return r.validateOptionalTtl(i.ttl),this.updateMergingQueue.squashAndAdd(e,i,(n=>this._updateItemUnconditionally(e,t,n.ttl)))}async _updateItemUnconditionally(e,t,n){let r=await this.get(e);const i=await this._addOrUpdateItemOnServer(r.uri,t,void 0,n);return this._handleItemMutated(e,i.url,i.last_event_id,i.revision,i.data,i.date_updated,i.date_expires,!1,!1),this.cache.get(e)}async _updateItemWithIfMatch(e,t,n){const i=await this.get(e),s=t(r.deepClone(i.value));if(!s)return i;{const r=i.revision;try{const t=await this._addOrUpdateItemOnServer(i.uri,s,r,n);return this._handleItemMutated(e,t.url,t.last_event_id,t.revision,t.data,t.date_updated,t.date_expires,!1,!1),this.cache.get(e)}catch(r){if(412===r.status)return await this._getItemFromServer(e),this._updateItemWithIfMatch(e,t,n);throw r}}}async mutate(e,t,n){const i=n||{};return r.validateOptionalTtl(i.ttl),this.updateMergingQueue.add(e,i,(n=>this._updateItemWithIfMatch(e,t,n.ttl)))}async update(e,t,n){return this.mutate(e,(e=>Object.assign(e,t)),n)}async remove(e){let t=await this.get(e),n=await this.services.network.delete(t.uri);this._handleItemRemoved(e,n.body.last_event_id,void 0,new Date(n.body.date_updated),!1)}async get(e){let t=this.cache.get(e);return t||this._getItemFromServer(e)}async _getItemFromServer(e){let t=await this.queryItems({index:e});if(t.items.length<1)throw new s.SyncError(`No item with index ${e} found`,404,54151);return t.items[0]}async queryItems(e){e=e||{};const t=new i.UriBuilder(this.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Index",e.index).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build();let n=await this.services.network.get(t),r=n.body.items.map((e=>(e.date_updated=new Date(e.date_updated),this.cache.get(e.index)?this._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):this.cache.store(Number(e.index),new c.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,value:e.data}),e.last_event_id),this.cache.get(e.index)))),s=n.body.meta;return new u.Paginator(r,(e=>this.queryItems({pageToken:e})),s.previous_token,s.next_token)}async getItems(e){return e=e||{},r.validatePageSize(e.pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",this.queryItems(e)}async getContext(){if(!this.context){let e=await this.services.network.get(this.links.context);this._updateContextIfRequired(e.body.data,e.body.last_event_id)}return this.context}async setTtl(e){r.validateMandatoryTtl(e);try{const t={ttl:e},n=await this.services.network.post(this.uri,t);this.descriptor.date_expires=n.body.date_expires}catch(e){throw 404===e.status&&this.onRemoved(!1),e}}async setItemTtl(e,t){r.validateMandatoryTtl(t);let n=await this.get(e);const i={ttl:t},s=await this.services.network.post(n.uri,i);n.updateDateExpires(s.body.date_expires)}async removeList(){await this.services.network.delete(this.uri),this.onRemoved(!0)}onRemoved(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}shouldIgnoreEvent(e,t){return this.cache.isKnown(e,t)}_update(e,t){const n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}_advanceLastEventId(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}_updateRootDateUpdated(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}_handleItemMutated(e,t,n,r,i,s,a,u,l){if(this.shouldIgnoreEvent(e,n))o.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(s);let o=this.cache.get(e);if(o)o.update(n,r,i,s),this.cache.store(e,o,n),void 0!==a&&o.updateDateExpires(a),this.emitItemMutationEvent(o,l,!1);else{let o=new c.ListItem({index:e,uri:t,lastEventId:n,revision:r,value:i,dateUpdated:s,dateExpires:a});this.cache.store(e,o,n),this.emitItemMutationEvent(o,l,u)}}}emitItemMutationEvent(e,t,n){let r=n?"itemAdded":"itemUpdated";this.broadcastEventToListeners(r,{item:e,isLocal:!t})}_handleItemRemoved(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{index:e,isLocal:!i,value:n})}_handleContextUpdate(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{context:e,isLocal:!1})}_updateContextIfRequired(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(o.default.trace("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}}t.SyncListImpl=p;class f extends h.default{constructor(e){super(),this.syncListImpl=e,this.syncListImpl.attach(this)}get uri(){return this.syncListImpl.uri}get revision(){return this.syncListImpl.revision}get lastEventId(){return this.syncListImpl.lastEventId}get links(){return this.syncListImpl.links}get dateExpires(){return this.syncListImpl.dateExpires}static get type(){return p.type}get type(){return p.type}get sid(){return this.syncListImpl.sid}get uniqueName(){return this.syncListImpl.uniqueName}get dateUpdated(){return this.syncListImpl.dateUpdated}async push(e,t){return this.ensureNotClosed(),this.syncListImpl.push(e,t)}async set(e,t,n){return this.ensureNotClosed(),this.syncListImpl.set(e,t,n)}async mutate(e,t,n){return this.ensureNotClosed(),this.syncListImpl.mutate(e,t,n)}async update(e,t,n){return this.ensureNotClosed(),this.syncListImpl.update(e,t,n)}async remove(e){return this.ensureNotClosed(),this.syncListImpl.remove(e)}async get(e){return this.ensureNotClosed(),this.syncListImpl.get(e)}async getContext(){return this.ensureNotClosed(),this.syncListImpl.getContext()}async getItems(e){return this.ensureNotClosed(),this.syncListImpl.getItems(e)}async setTtl(e){return this.ensureNotClosed(),this.syncListImpl.setTtl(e)}async setItemTtl(e,t){return this.ensureNotClosed(),this.syncListImpl.setItemTtl(e,t)}async removeList(){return this.ensureNotClosed(),this.syncListImpl.removeList()}close(){super.close(),this.syncListImpl.detach(this.listenerUuid)}}t.SyncList=f,t.default=f},9120:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncMap=t.SyncMapImpl=void 0;const r=n(3902),i=n(2343),s=n(8191),o=n(2681),a=n(6862),c=n(7517),u=n(7186),l=n(9522),d=n(3595),h=n(3846);class p extends a.SyncEntity{constructor(e,t,n){super(e,n);this.updateMergingQueue=new d.NamespacedMergingQueue(((e,t)=>"number"==typeof t.ttl?{ttl:t.ttl}:e)),this.cache=new l.Cache,this.descriptor=t,this.descriptor.date_updated=new Date(this.descriptor.date_updated),t.items&&t.items.forEach((e=>{e.date_updated=new Date(e.date_updated),this.cache.store(e.key,new c.MapItem(e),e.last_event_id)}))}get uri(){return this.descriptor.url}get links(){return this.descriptor.links}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get dateExpires(){return this.descriptor.date_expires}static get type(){return"map"}get type(){return"map"}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get uniqueName(){return this.descriptor.unique_name||null}get dateUpdated(){return this.descriptor.date_updated}async set(e,t,n){const i=n||{};return r.validateOptionalTtl(i.ttl),this.updateMergingQueue.squashAndAdd(e,i,(n=>this._putItemUnconditionally(e,t,n.ttl)))}async get(e){return this.cache.has(e)?this.cache.get(e):this._getItemFromServer(e)}async _getItemFromServer(e){let t=await this.queryItems({key:e});if(t.items.length<1)throw new s.SyncError(`No item with key ${e} found`,404,54201);return t.items[0]}async mutate(e,t,n){const i=n||{};return r.validateOptionalTtl(i.ttl),this.updateMergingQueue.add(e,i,(n=>this._putItemWithIfMatch(e,t,n.ttl)))}async update(e,t,n){return this.mutate(e,(e=>Object.assign(e,t)),n)}async _putItemUnconditionally(e,t,n){const r=await this._putItemToServer(e,t,void 0,n),i=r.item;return this._handleItemMutated(i.key,i.url,i.last_event_id,i.revision,i.data,i.date_updated,i.date_expires,r.added,!1),this.cache.get(i.key)}async _putItemWithIfMatch(e,t,n){const i=await this.get(e).catch((t=>{if(404===t.status)return new c.MapItem({key:e,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw t}));let s=t(r.deepClone(i.value));if(!s)return i;{let r=i.revision;try{const t=await this._putItemToServer(e,s,r,n),i=t.item;return this._handleItemMutated(i.key,i.url,i.last_event_id,i.revision,i.data,i.date_updated,i.date_expires,t.added,!1),this.cache.get(i.key)}catch(r){if(412===r.status)return await this._getItemFromServer(e),this._putItemWithIfMatch(e,t,n);throw r}}}async _putItemToServer(e,t,n,r){const s=new i.UriBuilder(this.links.items).pathSegment(e).build(),o={data:t};void 0!==r&&(o.ttl=r);try{const e=await this.services.network.put(s,o,n),r=e.body;r.data=t,r.date_updated=new Date(r.date_updated);return{added:201===e.status.code,item:r}}catch(e){throw 404===e.status&&this.onRemoved(!1),e}}async remove(e){if(void 0===e)throw new Error("Key argument is invalid");let t=await this.get(e),n=await this.services.network.delete(t.uri);this._handleItemRemoved(e,n.body.last_event_id,void 0,new Date(n.body.date_updated),!1)}async queryItems(e){e=e||{};const t=new i.UriBuilder(this.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Key",e.key).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build();let n=await this.services.network.get(t),r=n.body.items.map((e=>(e.date_updated=new Date(e.date_updated),this.cache.get(e.key)?this._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):this.cache.store(e.key,new c.MapItem(e),e.last_event_id),this.cache.get(e.key))));const s=n.body.meta;return new u.Paginator(r,(e=>this.queryItems({pageToken:e})),s.previous_token,s.next_token)}async getItems(e){return e=e||{},r.validatePageSize(e.pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",this.queryItems(e)}shouldIgnoreEvent(e,t){return this.cache.isKnown(e,t)}_update(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}_advanceLastEventId(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}_updateRootDateUpdated(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}_handleItemMutated(e,t,n,r,i,s,a,u,l){if(this.shouldIgnoreEvent(e,n))o.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(s);let o=this.cache.get(e);o?(o.update(n,r,i,s),this.cache.store(e,o,n),void 0!==a&&o.updateDateExpires(a),this.emitItemMutationEvent(o,l,!1)):(o=new c.MapItem({key:e,url:t,last_event_id:n,revision:r,data:i,date_updated:s,date_expires:a}),this.cache.store(e,o,n),this.emitItemMutationEvent(o,l,u))}}emitItemMutationEvent(e,t,n){let r=n?"itemAdded":"itemUpdated";this.broadcastEventToListeners(r,{item:e,isLocal:!t})}_handleItemRemoved(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{key:e,isLocal:!i,value:n})}onRemoved(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}async setTtl(e){r.validateMandatoryTtl(e);try{const t={ttl:e},n=await this.services.network.post(this.uri,t);this.descriptor.date_expires=n.body.date_expires}catch(e){throw 404===e.status&&this.onRemoved(!1),e}}async setItemTtl(e,t){r.validateMandatoryTtl(t);let n=await this.get(e);const i={ttl:t},s=await this.services.network.post(n.uri,i);n.updateDateExpires(s.body.date_expires)}async removeMap(){await this.services.network.delete(this.uri),this.onRemoved(!0)}}t.SyncMapImpl=p;class f extends h.Closeable{constructor(e){super(),this.syncMapImpl=e,this.syncMapImpl.attach(this)}get uri(){return this.syncMapImpl.uri}get links(){return this.syncMapImpl.links}get revision(){return this.syncMapImpl.revision}get lastEventId(){return this.syncMapImpl.lastEventId}get dateExpires(){return this.syncMapImpl.dateExpires}static get type(){return p.type}get type(){return p.type}get sid(){return this.syncMapImpl.sid}get uniqueName(){return this.syncMapImpl.uniqueName}get dateUpdated(){return this.syncMapImpl.dateUpdated}async set(e,t,n){return this.ensureNotClosed(),this.syncMapImpl.set(e,t,n)}async get(e){return this.ensureNotClosed(),this.syncMapImpl.get(e)}async mutate(e,t,n){return this.ensureNotClosed(),this.syncMapImpl.mutate(e,t,n)}async update(e,t,n){return this.ensureNotClosed(),this.syncMapImpl.update(e,t,n)}async remove(e){return this.ensureNotClosed(),this.syncMapImpl.remove(e)}async getItems(e){return this.ensureNotClosed(),this.syncMapImpl.getItems(e)}async setTtl(e){return this.ensureNotClosed(),this.syncMapImpl.setTtl(e)}async setItemTtl(e,t){return this.ensureNotClosed(),this.syncMapImpl.setItemTtl(e,t)}async removeMap(){this.ensureNotClosed(),await this.syncMapImpl.removeMap()}close(){super.close(),this.syncMapImpl.detach(this.listenerUuid)}}t.SyncMap=f,t.default=f},2681:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2043).getLogger("twilio-sync");function i(e,t){return[`${(new Date).toISOString()} Sync ${e}:`].concat(Array.from(t))}t.default={setLevel:function(e){r.setLevel(e)},trace:function(...e){r.trace.apply(null,i("T",e))},debug:function(...e){r.debug.apply(null,i("D",e))},info:function(...e){r.info.apply(null,i("I",e))},warn:function(...e){r.warn.apply(null,i("W",e))},error:function(...e){r.error.apply(null,i("E",e))}}},3902:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateId=t.validatePageSize=t.validateMandatoryTtl=t.validateOptionalTtl=t.deepClone=void 0;const r=n(8191);function i(e,t){if(t&&void 0===e)return;const n=typeof e;if("number"!==n||!(s(i=e)&&i>=0)){const t="object"===n?"object":`'${e}' of type '${n}'`;throw new r.default(`Invalid TTL, expected a positive integer of type number, was ${t}`,400,54011)}var i}function s(e){return!isNaN(parseInt(e))&&isFinite(e)}t.deepClone=function(e){return JSON.parse(JSON.stringify(e))},t.validateId=function(e){if(void 0===e)return;const t=typeof e;if("string"!==t)throw new Error(`Invalid ID type, expected a string, got '${t}'`)},t.validateOptionalTtl=function(e){i(e,!0)},t.validateMandatoryTtl=function(e){i(e,!1)},t.validatePageSize=function(e){var t;if(!(void 0===e||s(t=e)&&t>0))throw new r.default(`Invalid pageSize parameter. Expected a positive integer, was '${e}'.`,400,54455)}},8191:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncNetworkError=t.SyncError=void 0;class n extends Error{constructor(e,t=0,n=0){super(),this.name=this.constructor.name,this.message=`${e} (status: ${t}, code: ${n})`,this.status=t,this.code=n}}t.SyncError=n;t.SyncNetworkError=class extends n{constructor(e,t=0,n=0,r){super(e,t,n),this.body=r}},t.default=n},36:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreeMap=void 0;class n{constructor(e,t){this.balanceFactor=0,this.key=e,this.value=t,this.parent=null,this.left=null,this.right=null}get isRoot(){return null===this.parent}get isLeaf(){return null===this.left&&null===this.right}get isLeftChild(){return this.parent.left===this}update(e){this.value=e}replace(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}}class r{constructor(e,t){this.isLessThan=e||((e,t)=>e<t),this.isEqual=t||((e,t)=>e===t),this.root=null,this.count=null}get size(){return this.count}clear(){this.root=null,this.count=0}set(e,t){let n=this.getNode(e);n?n.update(t):this.insert(e,t)}insert(e,t){let r=new n(e,t);if(this.count++,!this.root)return void(this.root=r);let i=this.root;for(;;)if(this.isLessThan(e,i.key)){if(!i.left){i.left=r;break}i=i.left}else{if(!i.right){i.right=r;break}i=i.right}for(r.parent=i,i=r;i.parent;){let e=i.parent,t=e.balanceFactor;if(i.isLeftChild?e.balanceFactor++:e.balanceFactor--,Math.abs(e.balanceFactor)<Math.abs(t))break;if(e.balanceFactor<-1||e.balanceFactor>1){this.rebalance(e);break}i=e}}get(e){let t=this.root;for(;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}delete(e){let t=this.getNode(e);if(!t||t.key!==e)return null;let n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){let e=r||i;n||e?n&&!e?this.root=e:(n.replace(t,null),this.rebalance(n)):this.root=null}else{let e=t.left;for(;e.right;)e=e.right;if(t.left===e)t.isRoot?(this.root=e,e.parent=null):(t.isLeftChild?t.parent.left=e:t.parent.right=e,e.parent=t.parent),e.right=t.right,e.right.parent=e,e.balanceFactor=t.balanceFactor,t={parent:e,isLeftChild:!0};else{let n=e.parent,r=e.left;n.right=r,r&&(r.parent=n),t.isRoot?(this.root=e,e.parent=null):(t.isLeftChild?t.parent.left=e:t.parent.right=e,e.parent=t.parent),e.right=t.right,e.right.parent=e,e.left=t.left,e.left.parent=e,e.balanceFactor=t.balanceFactor,t={parent:n,isLeftChild:!1}}}for(this.count--;t.parent;){let e=t.parent,n=e.balanceFactor;if(t.isLeftChild?e.balanceFactor-=1:e.balanceFactor+=1,Math.abs(e.balanceFactor)>Math.abs(n)){if(!(e.balanceFactor<-1||e.balanceFactor>1))break;if(this.rebalance(e),0!==e.parent.balanceFactor)break;t=e.parent}else t=e}return null}getNode(e){let t=this.root;for(;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}rebalance(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}rotateLeft(e){let t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}rotateRight(e){let t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}*[Symbol.iterator](){for(let e of this.getIterator())yield e}*getIterator(e=null){let t=this.root;for(;t&&!this.isEqual(e,t.key)&&(null!==e||t.left);)t=this.isLessThan(e,t.key)||null===e?t.left:t.right;if(!t)return null;let n=!0;for(;;)if(n)if(yield[t.key,t.value],n=!1,t.right){for(t=t.right;t.left;)t=t.left;n=!0}else{if(!t.parent)break;n=t.parent.left===t,t=t.parent}else{if(!t.parent)break;n=t.parent.left===t,t=t.parent}return null}*getReverseIterator(e=null){let t=this.root;for(;t&&!this.isEqual(e,t.key)&&(null!==e||t.right);)t=this.isLessThan(e,t.key)&&null!==e?t.left:t.right;if(!t)return null;let n=!0;for(;;)if(n)if(yield[t.key,t.value],n=!1,t.left){for(t=t.left;t.right;)t=t.right;n=!0}else{if(!t.parent)break;n=t.parent.right===t,t=t.parent}else{if(!t.parent)break;n=t.parent.right===t,t=t.parent}return null}}t.TreeMap=r},2343:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UriBuilder=void 0;t.UriBuilder=class{constructor(e){this.base=e,this.args=new Array,this.paths=new Array}pathSegment(e){return this.paths.push(encodeURIComponent(e)),this}queryParam(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}build(){let e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}},2820:e=>{"use strict";e.exports={i8:"0.13.0"}},1182:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffRetrier=void 0;const r=n(7187),i=n(9948);class s extends r.EventEmitter{constructor(e){super(),this.options=e?Object.assign({},e):{}}get inProgress(){return!!this.retrier}start(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}stop(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}modifyBackoff(e){this.newBackoff=e}attemptFailed(){if(!this.inProgress)throw new Error("No attempt is in progress");if(this.newBackoff){!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():this.retrier.failed(new Error)}else this.retrier.failed(new Error)}cancel(){this.retrier&&this.retrier.cancel()}cleanRetrier(){this.retrier&&(this.retrier.removeAllListeners(),this.retrier.cancel(),this.retrier=null)}getRetryPolicy(){const e=Object.assign({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}createRetrier(){this.cleanRetrier();const e=this.getRetryPolicy();this.retrier=new i.Retrier(e),this.retrier.once("attempt",(()=>{this.retrier.on("attempt",(()=>this.emit("attempt"))),this.retrier.failed(new Error("Skipping first attempt"))})),this.retrier.on("failed",(e=>this.emit("failed",e))),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start().catch((e=>{}))}}t.BackoffRetrier=s},8726:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Twilsock=t.TwilsockClient=t.TelemetryEvents=void 0;const r=n(7187),i=n(5398),s=n(3416),o=n(1934),a=n(7461),c=n(6460),u=n(6165),l=n(6484),d=n(2454),h=n(1971),p=n(2056),f=n(3612),m=n(5739);class g{}t.TelemetryEvents=g,g.TWILSOCK_CONNECT="twilsock.sdk.connect",g.TWILSOCK_INIT="twilsock.sdk.init";class y extends r.EventEmitter{constructor(e,t,n={}){super(),this.offlineStorageDeferred=new d.Deferred,n.continuationToken=n.continuationToken?n.continuationToken:f.TokenStorage.getStoredToken(t);let r=this.config=new s.Configuration(e,t,n);i.log.setLevel(r.logLevel);let p=new c.WebSocketChannel(r.url),y=n.transport?n.transport:new a.PacketInterface(p,r);this.channel=n.channel?n.channel:new o.TwilsockImpl(p,y,r),this.registrations=n.registrations?n.registrations:new u.Registrations(y),this.upstream=new l.Upstream(y,this.channel,r),this.telemetryTracker=new m.TelemetryTracker(r,y),this.channel.on("initialized",(()=>this.telemetryTracker.canSendTelemetry=!0)),p.on("disconnected",(()=>this.telemetryTracker.canSendTelemetry=!1)),this.registrations.on("registered",(e=>this.emit("registered",e))),this.channel.on("message",((e,t)=>setTimeout((()=>this.emit("message",e,t)),0))),this.channel.on("stateChanged",(e=>setTimeout((()=>this.emit("stateChanged",e)),0))),this.channel.on("connectionError",(e=>setTimeout((()=>this.emit("connectionError",e)),0))),this.channel.on("tokenAboutToExpire",(()=>setTimeout((()=>this.emit("tokenAboutToExpire")),0))),this.channel.on("tokenExpired",(()=>setTimeout((()=>this.emit("tokenExpired")),0))),this.channel.on("connected",(()=>this.registrations.updateRegistrations())),this.channel.on("connected",(()=>this.upstream.sendPendingMessages())),this.channel.on("connected",(()=>setTimeout((()=>this.emit("connected")),0))),this.channel.on("beforeConnect",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Establish WebSocket connection","",new Date),g.TWILSOCK_CONNECT,m.TelemetryPoint.Start))),this.channel.on("connected",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Establish WebSocket connection","",new Date,new Date),g.TWILSOCK_CONNECT,m.TelemetryPoint.End))),this.channel.on("beforeSendInit",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Send Twilsock init","",new Date),g.TWILSOCK_INIT,m.TelemetryPoint.Start))),this.channel.on("initialized",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Send Twilsock init","Succeeded",new Date,new Date),g.TWILSOCK_INIT,m.TelemetryPoint.End))),this.channel.on("sendInitFailed",(()=>this.telemetryTracker.addPartialEvent(new m.TelemetryEventDescription("Send Twilsock init","Failed",new Date,new Date),g.TWILSOCK_INIT,m.TelemetryPoint.End))),this.channel.on("initialized",(e=>{this.handleStorageId(t,e),f.TokenStorage.storeToken(e.continuationToken,t),setTimeout((()=>this.emit("initialized",e)),0)})),this.channel.on("disconnected",(()=>setTimeout((()=>this.emit("disconnected")),0))),this.channel.on("disconnected",(()=>this.upstream.rejectPendingMessages())),this.channel.on("disconnected",(()=>this.offlineStorageDeferred.fail(new h.TwilsockError("Client disconnected")))),this.offlineStorageDeferred.promise.catch((()=>{}))}emit(e,...t){return i.log.debug(`Emitting ${e.toString()}(${t.map((e=>JSON.stringify(e))).join(", ")})`),super.emit(e,...t)}handleStorageId(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(p.OfflineProductStorage.create(t.offlineStorage[e])),i.log.debug(`Offline storage for '${e}' product: ${JSON.stringify(t.offlineStorage[e])}.`)}catch(n){this.offlineStorageDeferred.fail(new h.TwilsockError(`Failed to parse offline storage for ${e} ${JSON.stringify(t.offlineStorage[e])}. ${n}.`))}else this.offlineStorageDeferred.fail(new h.TwilsockError(`No offline storage id for '${e}' product: ${JSON.stringify(t.offlineStorage)}`));else this.offlineStorageDeferred.fail(new h.TwilsockError("No offline storage id"))}storageId(){return this.offlineStorageDeferred.promise}get isConnected(){return this.channel.isConnected}get state(){return this.channel.state}async updateToken(e){if(i.log.trace(`updating token '${e}'`),this.config.token!==e)return this.config.updateToken(e),this.channel.updateToken(e)}setNotificationsContext(e,t){this.registrations.setNotificationsContext(e,t)}removeNotificationsContext(e){this.registrations.removeNotificationsContext(e)}connect(){return this.channel.connect()}disconnect(){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEventsIncludingUnfinished),this.channel.disconnect()}get(e,t,n){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEvents),this.upstream.send("GET",e,t,void 0,n)}post(e,t,n,r){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEvents),this.upstream.send("POST",e,t,n,r)}put(e,t,n,r){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEvents),this.upstream.send("PUT",e,t,n,r)}delete(e,t,n){return this.telemetryTracker.sendTelemetry(m.EventSendingLimitation.AnyEvents),this.upstream.send("DELETE",e,t,void 0,n)}addTelemetryEvent(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}addPartialTelemetryEvent(e,t,n){this.telemetryTracker.addPartialEvent(e,t,n),n===m.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}t.TwilsockClient=y,t.Twilsock=y},3416:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;t.Configuration=class{constructor(e,t,n={}){this.confirmedCapabilities=new Set,this.activeGrant=t,this._token=e;const r=`wss://tsock.${n.region||"us1"}.twilio.com/v3/wsconnect`;let i=n.twilsock||n.Twilsock||{};this.url=i.uri||r,this._continuationToken=n.continuationToken?n.continuationToken:null,this.logLevel=n.logLevel?n.logLevel:"error",this.retryPolicy=n.retryPolicy?n.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=n.clientMetadata?n.clientMetadata:{},this.clientMetadata.ver="0.6.1",this.initRegistrations=n.initRegistrations?n.initRegistrations:null,this.tweaks=n.tweaks?n.tweaks:null}get token(){return this._token}get continuationToken(){return this._continuationToken}updateToken(e){this._token=e}updateContinuationToken(e){this._continuationToken=e}}},2454:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;t.Deferred=class{constructor(){this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}get promise(){return this._promise}update(e){this._resolve(e)}set(e){this.current=e,this._resolve(e)}fail(e){this._reject(e)}}},7417:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransportUnavailableError=void 0;const r=n(1971);class i extends r.TwilsockError{constructor(e){super(e)}}t.TransportUnavailableError=i},1971:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockError=void 0;class n extends Error{constructor(e){super(e)}}t.TwilsockError=n},464:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockReplyError=void 0;const r=n(1971);class i extends r.TwilsockError{constructor(e,t){super(e),this.reply=t}}t.TwilsockReplyError=i},2884:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockUpstreamError=void 0;const r=n(1971);class i extends r.TwilsockError{constructor(e,t,n){super(t),this.status=e,this.description=t,this.body=n}}t.TwilsockUpstreamError=i},6895:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransportUnavailableError=t.TwilsockError=t.Twilsock=t.TwilsockClient=void 0;const r=n(8726);Object.defineProperty(t,"TwilsockClient",{enumerable:!0,get:function(){return r.TwilsockClient}}),Object.defineProperty(t,"Twilsock",{enumerable:!0,get:function(){return r.TwilsockClient}});const i=n(1971);Object.defineProperty(t,"TwilsockError",{enumerable:!0,get:function(){return i.TwilsockError}});const s=n(7417);Object.defineProperty(t,"TransportUnavailableError",{enumerable:!0,get:function(){return s.TransportUnavailableError}})},5398:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=t.Logger=void 0;const r=n(2043).getLogger("twilsock");function i(e,t){return[`${(new Date).toISOString()} Twilsock ${e}:`].concat(Array.from(t))}class s{constructor(e){this.prefix="",this.prefix=null!=e&&e.length>0?" "+e+":":""}setLevel(e){r.setLevel(e)}static setLevel(e){r.setLevel(e)}trace(...e){r.debug.apply(null,i("T",e))}debug(...e){r.debug.apply(null,i("D",e))}info(...e){r.info.apply(null,i("I",e))}warn(...e){r.warn.apply(null,i("W",e))}error(...e){r.error.apply(null,i("E",e))}static trace(...e){r.trace.apply(null,i("T",e))}static debug(...e){r.debug.apply(null,i("D",e))}static info(...e){r.info.apply(null,i("I",e))}static warn(...e){r.warn.apply(null,i("W",e))}static error(...e){r.error.apply(null,i("E",e))}}t.Logger=s;let o=new s("");t.log=o},3304:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;const r=n(1795);t.Metadata=class{static getMetadata(e){"undefined"!=typeof navigator&&r.parse(navigator.userAgent);let t=e&&e.clientMetadata?e.clientMetadata:{};const n={env:r.name,envv:r.version,os:r.os.family,osv:r.os.version,osa:r.os.architecture,sdk:"js-default"};let i={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter((e=>e in t||e in n)).forEach((e=>i[e]=e in t?t[e]:n[e])),i}}},2056:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineProductStorage=void 0;const r=n(1971);class i{constructor(e){this.id=e}static create(e){if(e instanceof Object&&"storage_id"in e)return new i(e.storage_id);throw new r.TwilsockError('Field "storage_id" is missing')}}t.OfflineProductStorage=i},7461:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PacketInterface=t.PacketResponse=void 0;const r=n(5398),i=n(5877),s=n(1971),o=n(464),a=n(1844),c=n(1131),u=n(3304);t.PacketResponse=class{};t.PacketInterface=class{constructor(e,t){this.config=t,this.activeRequests=new Map,this.channel=e,this.channel.on("reply",(e=>this.processReply(e))),this.channel.on("disconnected",(()=>{this.activeRequests.forEach((e=>{clearTimeout(e.timeout),e.reject(new s.TwilsockError("disconnected"))})),this.activeRequests.clear()}))}get isConnected(){return this.channel.isConnected}processReply(e){const t=this.activeRequests.get(e.id);var n;t&&(clearTimeout(t.timeout),this.activeRequests.delete(e.id),(n=e.status.code)>=200&&n<300?t.resolve(e):(t.reject(new o.TwilsockReplyError("Transport failure: "+e.status.status,e)),r.log.trace("message rejected")))}storeRequest(e,t,n){let i={resolve:t,reject:n,timeout:setTimeout((()=>{r.log.trace("request",e,"is timed out"),n(new s.TwilsockError("Twilsock: request timeout: "+e))}),3e4)};this.activeRequests.set(e,i)}shutdown(){this.activeRequests.forEach((e=>{clearTimeout(e.timeout),e.reject(new s.TwilsockError("Twilsock: request cancelled by user"))})),this.activeRequests.clear()}async sendInit(){r.log.trace("sendInit");let e=u.Metadata.getMetadata(this.config),t=new c.Init(this.config.token,this.config.continuationToken,e,this.config.initRegistrations,this.config.tweaks),n=await this.sendWithReply(t);return new c.InitReply(n.id,n.header.continuation_token,n.header.continuation_token_status,n.header.offline_storage,n.header.init_registrations,n.header.debug_info,new Set(n.header.capabilities))}sendClose(){let e=new c.Close;this.send(e)}sendWithReply(e,t){return new Promise(((n,r)=>{let i=this.send(e,t);this.storeRequest(i,n,r)}))}send(e,t){e.id=e.id||`TM${i.v4()}`;let n=a.Parser.createPacket(e,function(e){switch(typeof e){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(t){throw r.log.debug("failed to send ",e,t),r.log.trace(t.stack),t}}}},1844:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const r=n(5398);function i(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode("0x"+t))).length}function s(e){let t=Array.prototype.map.call(e,(e=>String.fromCharCode(e))).join("").replace(/(.)/g,((e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}));return decodeURIComponent(t)}function o(e){return JSON.parse(s(e))}t.Parser=class{constructor(){}static parse(e){const t=new Uint8Array(e),n=function(e){let t="",n=0;for(;n<e.length;++n){const r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}const r=t.split(" ");return{size:n,protocol:r[0],version:r[1],headerSize:Number(r[2])}}(t);if("TWILSOCK"!==n.protocol||"V3.0"!==n.version)return void r.log.error(`unsupported protocol: ${n.protocol} ver ${n.version}`);let i=null;try{i=o(t.subarray(n.size,n.size+n.headerSize))}catch(t){return void r.log.error("failed to parse message header",t,e)}r.log.debug("message received: ",i.method),r.log.trace("message received: ",i);let a=null;if(i.payload_size>0){const c=2+n.size+n.headerSize,u=i.payload_size;if(i.hasOwnProperty("payload_type")&&0!==i.payload_type.indexOf("application/json"))0===i.payload_type.indexOf("text/plain")&&(a=s(t.subarray(c,c+u)));else try{a=o(t.subarray(c,c+u))}catch(t){return void r.log.error("failed to parse message body",t,e)}}return{method:i.method,header:i,payload:a}}static createPacket(e,t=""){e.payload_size=i(t);let n=JSON.stringify(e)+"\r\n",s="TWILSOCK V3.0 "+(i(n)-2)+"\r\n";return r.log.debug("send request:",s+n+t),function(e){let t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode("0x"+t))),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,((e,t)=>{n[t]=e.charCodeAt(0)})),n}(s+n+t).buffer}}},9416:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractMessage=void 0;const r=n(5877);t.AbstractMessage=class{constructor(e){this.id=e||`TM${r.v4()}`}}},8448:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Close=void 0;const r=n(9416);class i extends r.AbstractMessage{constructor(){super(),this.method="close"}}t.Close=i},1131:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Telemetry=t.Close=t.Reply=t.Message=t.Update=t.InitReply=t.Init=void 0;const r=n(6562);Object.defineProperty(t,"Init",{enumerable:!0,get:function(){return r.Init}});const i=n(4514);Object.defineProperty(t,"InitReply",{enumerable:!0,get:function(){return i.InitReply}});const s=n(8724);Object.defineProperty(t,"Update",{enumerable:!0,get:function(){return s.Update}});const o=n(7586);Object.defineProperty(t,"Message",{enumerable:!0,get:function(){return o.Message}});const a=n(6680);Object.defineProperty(t,"Reply",{enumerable:!0,get:function(){return a.Reply}});const c=n(8448);Object.defineProperty(t,"Close",{enumerable:!0,get:function(){return c.Close}});const u=n(4858);Object.defineProperty(t,"Telemetry",{enumerable:!0,get:function(){return u.Telemetry}})},6562:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Init=void 0;const r=n(9416);class i extends r.AbstractMessage{constructor(e,t,n,r=null,i=null){super(),this.method="init",this.token=e,this.continuation_token=t,this.metadata=n,this.registrations=r,this.tweaks=i,this.capabilities=["client_update","offline_storage","telemetry.v1"]}}t.Init=i},4514:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InitReply=t.ContinuationTokenStatus=void 0;const r=n(9416);t.ContinuationTokenStatus=class{};class i extends r.AbstractMessage{constructor(e,t,n,r,i,s,o){super(e),this.continuationToken=t,this.continuationTokenStatus=n,this.offlineStorage=r,this.initRegistrations=i,this.debugInfo=s,this.confirmedCapabilities=o}}t.InitReply=i},7586:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Message=void 0;const r=n(9416);class i extends r.AbstractMessage{constructor(e,t,n){super(),this.method="message",this.active_grant=e,this.payload_type=t,this.http_request=n}}t.Message=i},6680:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Reply=void 0;const r=n(9416);class i extends r.AbstractMessage{constructor(e){super(e),this.method="reply",this.payload_type="application/json",this.status={code:200,status:"OK"}}}t.Reply=i},4858:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryEvent=t.Telemetry=void 0;const r=n(9416);t.TelemetryEvent=class{constructor(e,t,n,r,i,s){this.start=e,this.end=t,this.title=n,this.details=r,this.id=i,this.type=s}};class i extends r.AbstractMessage{constructor(e){super(),this.method="telemetry.v1",this.events=e}}t.Telemetry=i},8724:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Update=void 0;const r=n(9416);class i extends r.AbstractMessage{constructor(e){super(),this.method="update",this.token=e}}t.Update=i},6165:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Registrations=void 0;const r=n(5398),i=n(7187),s=n(5877),o=n(1971);class a extends i.EventEmitter{constructor(e){super(),this.transport=e,this.registrations=new Map,this.registrationsInProgress=new Map}async putNotificationContext(e,t){const n={method:"put_notification_ctx",notification_ctx_id:e};await this.transport.sendWithReply(n,t)}async deleteNotificationContext(e){let t={method:"delete_notification_ctx",notification_ctx_id:e};await this.transport.sendWithReply(t)}async updateRegistration(e,t){r.log.debug("update registration for context",e);let n=this.registrationsInProgress.get(e);n||(n=new Set,this.registrationsInProgress.set(e,n));const i=s.v4();n.add(i);try{await this.putNotificationContext(e,t),r.log.debug("registration attempt succeeded for context",t),n.delete(i),0===n.size&&(this.registrationsInProgress.delete(e),this.emit("registered",e))}catch(s){r.log.warn("registration attempt failed for context",t),r.log.debug(s),n.delete(i),0===n.size&&(this.registrationsInProgress.delete(e),this.emit("registrationFailed",e,s))}}updateRegistrations(){r.log.trace(`refreshing ${this.registrations.size} registrations`),this.registrations.forEach(((e,t)=>{this.updateRegistration(t,e)}))}setNotificationsContext(e,t){if(!e||!t)throw new o.TwilsockError("Invalid arguments provided");this.registrations.set(e,t),this.transport.isConnected&&this.updateRegistration(e,t)}async removeNotificationsContext(e){this.registrations.has(e)&&(await this.deleteNotificationContext(e),this.transport.isConnected&&this.registrations.delete(e))}}t.Registrations=a},5739:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventSendingLimitation=t.TelemetryPoint=t.TelemetryEventDescription=t.TelemetryTracker=void 0;const r=n(4858),i=n(5398);class s{constructor(e,t,n,r,i,s){this.title=e,this.details=t,this.start=n,this.type=i,this.id=s,this.end=r}toTelemetryEvent(){const e=new Date;let t=this.start,n=this.end?this.end:e;if(n<t){let e=n;n=t,t=e}const i=t.getTime()-e.getTime(),s=n.getTime()-e.getTime();return new r.TelemetryEvent(i,s,this.title,this.details,this.id,this.type)}}var o,a;t.TelemetryEventDescription=s,function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(o||(o={})),t.TelemetryPoint=o,function(e){e[e.MinEventsPortion=0]="MinEventsPortion",e[e.AnyEvents=1]="AnyEvents",e[e.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished"}(a||(a={})),t.EventSendingLimitation=a;t.TelemetryTracker=class{constructor(e,t){this.minEventsPortionToSend=50,this.maxEventsPortionToSend=100,this.pendingEvents=new Map,this.readyEvents=[],this.hasInitializationFinished=!1,this._canSendTelemetry=!1,this.config=e,this.packetInterface=t}get isTelemetryEnabled(){return this.config.confirmedCapabilities.has("telemetry.v1")}get canSendTelemetry(){return this._canSendTelemetry&&this.isTelemetryEnabled}set canSendTelemetry(e){i.log.debug(`TelemetryTracker.canSendTelemetry: ${e} TelemetryTracker.isTelemetryEnabled: ${this.isTelemetryEnabled}`),this._canSendTelemetry&&!e&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=e,e&&this.sendTelemetry(a.AnyEvents),e&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}addTelemetryEvent(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}addPartialEvent(e,t,n){i.log.debug(`Adding ${n===o.Start?"starting":"ending"} timepoint for '${t}' event`);let r=this.pendingEvents.has(t);if(n===o.Start)r&&i.log.debug(`Overwriting starting point for '${t}' event`),this.pendingEvents.set(t,e);else{if(!r)return void i.log.error(`Could not find started event for '${t}' event`);this.addTelemetryEvent(this.merge(this.pendingEvents.get(t),e)),this.pendingEvents.delete(t)}}getTelemetryToSend(e){return this.canSendTelemetry&&0!=this.readyEvents.length?e==a.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(e==a.AnyEventsIncludingUnfinished):[]}getTelemetryPortion(e){const t=Math.min(this.readyEvents.length,this.maxEventsPortionToSend);let n=this.readyEvents.splice(0,t);return e&&n.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach(((e,t)=>{if(n.length>=this.maxEventsPortionToSend)return;let r=this.pendingEvents.get(t);this.pendingEvents.delete(t),n.push(new s(`[UNFINISHED] ${r.title}`,r.details,r.start,null,r.type,r.id))})),n}merge(e,t){return new s(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}sendTelemetryIfMinimalPortionCollected(){this.sendTelemetry(a.MinEventsPortion)}sendTelemetry(e){const t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new r.Telemetry(t.map((e=>e.toTelemetryEvent()))))}catch(e){i.log.debug(`Error while sending ${t.length} telemetry events due to ${e}; they will be resubmitted`),this.readyEvents=this.readyEvents.concat(t)}}}},6484:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Upstream=void 0;const r=n(5398),i=n(1971),s=n(2884),o=n(1131),a=n(7417);function c(e,t){const n=function(e){const t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){let e={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:null};if(e.search.length>0){let t=e.search.substring(1);e.params=t.split("&").map((e=>e.split("="))).reduce(((e,t)=>(e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e)),{})}return e}throw new i.TwilsockError("Incorrect URI: "+e)}(t);let r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}t.Upstream=class{constructor(e,t,n){this.config=n,this.transport=e,this.pendingMessages=[],this.twilsock=t}saveMessage(e){return new Promise(((t,n)=>{let s={message:e,resolve:t,reject:n,alreadyRejected:!1,timeout:setTimeout((()=>{r.log.debug("request is timed out"),n(new i.TwilsockError("Twilsock: request timeout")),s.alreadyRejected=!0}),2e4)};this.pendingMessages.push(s)}))}sendPendingMessages(){for(;this.pendingMessages.length;){let e=this.pendingMessages[0];if(!e.alreadyRejected)try{let t=e.message;this.actualSend(t).then((t=>e.resolve(t))).catch((t=>e.reject(t))),clearTimeout(e.timeout)}catch(e){r.log.debug("Failed to send pending message",e);break}this.pendingMessages.splice(0,1)}}rejectPendingMessages(){this.pendingMessages.forEach((e=>{e.reject(new a.TransportUnavailableError("Unable to connect: "+this.twilsock.getTerminationReason)),clearTimeout(e.timeout)})),this.pendingMessages.splice(0,this.pendingMessages.length)}async actualSend(e){let t=e.to,n=e.headers,r=e.body,i=e.grant?e.grant:this.config.activeGrant,a={host:t.host,path:t.path,method:t.method,params:t.params,headers:n},c=new o.Message(i,n["Content-Type"]||"application/json",a),u=await this.transport.sendWithReply(c,r);if((d=u)&&d.header&&d.header.http_status&&!((l=u.header.http_status.code)>=200&&l<300))throw new s.TwilsockUpstreamError(u.header.http_status.code,u.header.http_status.status,u.body);var l,d;return{status:u.header.http_status,headers:u.header.http_headers,body:u.body}}send(e,t,n={},r,i){if(this.twilsock.isTerminalState)return Promise.reject(new a.TransportUnavailableError("Unable to connect: "+this.twilsock.getTerminationReason));let s=function(e,t,n,r,i){return{to:c(e,t),headers:n,body:r,grant:i}}(e,t,n,r,i);return this.twilsock.isConnected?this.actualSend(s):this.saveMessage(s)}}},3612:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenStorage=void 0;class r{static get sessionStorage(){try{return n.g.sessionStorage}catch(e){return null}}static get window(){try{return n.g.window}catch(e){return null}}static storeToken(e,t){r.canStore&&r.sessionStorage.setItem(r.getKeyName(t),e)}static getStoredToken(e){return r.canStore?r.sessionStorage.getItem(r.getKeyName(e)):null}static initialize(){if(r.canStore){r.sessionStorage.getItem(r.initializedFlag)&&this.clear(),r.sessionStorage.setItem(r.initializedFlag,"true"),r.window.addEventListener("unload",(()=>{r.sessionStorage.removeItem(r.initializedFlag)}))}}static clear(){if(r.canStore){let e=[];for(let t=0;t<r.sessionStorage.length;t++){const n=r.sessionStorage.key(t);0===n.indexOf(r.tokenStoragePrefix)&&e.push(n)}e.forEach((e=>r.sessionStorage.removeItem(e))),r.sessionStorage.removeItem(r.initializedFlag)}}static getKeyName(e){return`${r.tokenStoragePrefix}${e}`}static get canStore(){return r.sessionStorage&&r.window}}t.TokenStorage=r,r.initializedFlag="twilio_twilsock_token_storage",r.tokenStoragePrefix="twilio_continuation_token_",r.initialize()},1934:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockImpl=t.TwilsockChannel=t.Response=void 0;const r=n(7187),i=n(4907),s=n(5398),o=n(1131),a=n(1844),c=n(464),u=n(1182);t.Response=class{};class l extends r.EventEmitter{constructor(e,t,n){super(),this.terminalStates=["disconnected","rejected"],this.lastEmittedState=void 0,this.tokenExpiredSasCode=20104,this.terminationReason="Connection is not initialized",this.websocket=e,this.websocket.on("connected",(()=>this.fsm.socketConnected())),this.websocket.on("disconnected",(e=>this.fsm.socketClosed())),this.websocket.on("message",(e=>this.onIncomingMessage(e))),this.websocket.on("socketError",(e=>this.emit("connectionError",{terminal:!1,message:e.message,httpStatusCode:null,errorCode:null}))),this.transport=t,this.config=n,this.retrier=new u.BackoffRetrier(n.retryPolicy),this.retrier.on("attempt",(()=>this.retry())),this.retrier.on("failed",(e=>{s.log.warn(`Retrying failed: ${e.message}`),this.disconnect()})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(()=>{s.log.debug("Browser reported connectivity state: online"),this.fsm.systemOnline()})),window.addEventListener("offline",(()=>{s.log.debug("Browser reported connectivity state: offline"),this.websocket.close(),this.fsm.socketClosed()}))),this.fsm=new i({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:()=>{this.setupSocket(),this.emit("connecting")},onEnterInitialising:()=>{this.sendInit()},onLeaveInitialising:()=>{this.cancelInit()},onEnterUpdating:()=>{this.sendUpdate()},onLeaveUpdating:()=>{this.cancelUpdate()},onEnterRetrying:()=>{this.initRetry(),this.emit("connecting")},onEnterConnected:()=>{this.resetBackoff(),this.onConnected()},onUserUpdateToken:()=>{this.resetBackoff()},onTokenRejected:()=>{this.resetBackoff(),this.closeSocket(!0),this.finalizeSocket()},onUserDisconnect:()=>{this.closeSocket(!0)},onEnterDisconnecting:()=>{this.startDisconnectTimer()},onLeaveDisconnecting:()=>{this.cancelDisconnectTimer()},onEnterWaitSocketClosed:()=>{this.startDisconnectTimer()},onLeaveWaitSocketClosed:()=>{this.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:()=>{this.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:()=>{this.cancelDisconnectTimer()},onDisconnected:()=>{this.resetBackoff(),this.finalizeSocket()},onReceiveClose:(e,t)=>{this.onCloseReceived(t)},onReceiveOffload:(e,t)=>{s.log.debug("onreceiveoffload: ",t),this.modifyBackoff(t.body),this.onCloseReceived(t.status)},onUnsupported:()=>{this.closeSocket(!0),this.finalizeSocket()},onError:(e,t)=>{this.closeSocket(t),this.finalizeSocket()},onEnterState:e=>{"none"!==e.from&&this.changeState(e)},onInvalidTransition:(e,t,n)=>{s.log.warn("FSM: unexpected transition",t,n)}}})}changeState(e){s.log.debug(`FSM: ${e.transition}: ${e.from} --\x3e ${e.to}`),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}resetBackoff(){s.log.trace("resetBackoff"),this.retrier.stop()}modifyBackoff(e){s.log.trace("modifyBackoff",e);let t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}startDisconnectTimer(){s.log.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout((()=>{s.log.debug("disconnecting is timed out"),this.closeSocket(!0)}),3e3)}cancelDisconnectTimer(){s.log.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}get isConnected(){return"connected"===this.state&&this.websocket.isConnected}get state(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"rejected";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}initRetry(){s.log.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}retry(){"connecting"!=this.fsm.state?(s.log.trace("retry"),this.websocket.close(),this.fsm.userRetry()):s.log.trace("can\t retry as already connecting")}onConnected(){this.emit("connected")}finalizeSocket(){s.log.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}setupSocket(){s.log.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}onIncomingMessage(e){let{method:t,header:n,payload:r}=a.Parser.parse(e);if("reply"!==t&&this.confirmReceiving(n),"notification"===t)this.emit("message",n.message_type,r);else if("reply"===n.method)this.transport.processReply({id:n.id,status:n.status,header:n,body:r});else if("client_update"===n.method)"token_about_to_expire"===n.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===n.method)if(308===n.status.code)s.log.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:n.status.status,body:r});else if(406===n.status.code){const e=`Server closed connection because can't parse protocol: ${JSON.stringify(n.status)}`;this.emitReplyConnectionError(e,n,!0),s.log.error(e),this.fsm.receiveFatalClose()}else 417===n.status.code?(s.log.error(`Server closed connection because can't parse client reply: ${JSON.stringify(n.status)}`),this.fsm.receiveFatalClose(n.status.status)):410===n.status.code?(s.log.warn(`Server closed connection: ${JSON.stringify(n.status)}`),this.fsm.receiveClose(n.status.status),this.emit("tokenExpired")):401===n.status.code?(s.log.error(`Server closed connection: ${JSON.stringify(n.status)}`),this.fsm.receiveClose(n.status.status)):(s.log.warn("unexpected message: ",n.status),this.fsm.receiveOffload({status:n.status.status,body:null}))}async sendInit(){s.log.trace("sendInit");try{this.emit("beforeSendInit");let e=await this.transport.sendInit();this.config.updateContinuationToken(e.continuationToken),this.config.confirmedCapabilities=e.confirmedCapabilities,this.fsm.initSuccess(e),this.emit("initialized",e),this.emit("tokenUpdated")}catch(e){if(e instanceof c.TwilsockReplyError){let t=!1;s.log.warn(`Init rejected by server: ${JSON.stringify(e.reply.status)}`),this.emit("sendInitFailed"),401===e.reply.status.code||403===e.reply.status.code?(t=!0,this.fsm.tokenRejected(e.reply.status),e.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.reply.status.code?(this.modifyBackoff(e.reply.body),this.fsm.initError(!0)):500===e.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(e.message,e.reply,t)}else this.terminationReason=e.message,this.emit("connectionError",{terminal:!0,message:e.message,httpStatusCode:null,errorCode:null}),this.fsm.initError(!0);this.emit("tokenUpdated",e)}}async sendUpdate(){s.log.trace("sendUpdate");let e=new o.Update(this.config.token);try{let t=await this.transport.sendWithReply(e);this.fsm.updateSuccess(t.body),this.emit("tokenUpdated")}catch(e){if(e instanceof c.TwilsockReplyError){let t=!1;s.log.warn(`Token update rejected by server: ${JSON.stringify(e.reply.status)}`),401===e.reply.status.code||403===e.reply.status.code?(t=!0,this.fsm.tokenRejected(e.reply.status),e.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.reply.status.code?(this.modifyBackoff(e.reply.body),this.fsm.updateError(e.reply.status)):this.fsm.updateError(e.reply.status),this.emitReplyConnectionError(e.message,e.reply,t)}else this.emit("error",!1,e.message,null,null),this.fsm.updateError(e);this.emit("tokenUpdated",e)}}emitReplyConnectionError(e,t,n){const r=t.status&&t.status.description?t.status.description:e,i=t.status.code,s=t.status&&t.status.errorCode?t.status.errorCode:null;n&&(this.terminationReason=r),this.emit("connectionError",{terminal:n,message:r,httpStatusCode:i,errorCode:s})}cancelInit(){s.log.trace("cancelInit")}cancelUpdate(){s.log.trace("cancelUpdate")}confirmReceiving(e){s.log.trace("confirmReceiving");try{this.transport.send(new o.Reply(e.id))}catch(e){s.log.debug("failed to confirm packet receiving",e)}}closeSocket(e){s.log.trace(`closeSocket (graceful: ${e})`),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout((()=>this.fsm.socketClosed()),0)}connect(){s.log.trace("connect"),this.fsm.userConnect()}disconnect(){return s.log.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise((e=>{this.disconnectedPromiseResolve=e,this.fsm.userDisconnect()}))}updateToken(e){return s.log.trace("updateToken:",e),new Promise(((e,t)=>{this.once("tokenUpdated",(n=>{n?t(n):e()})),this.fsm.userUpdateToken()}))}get isTerminalState(){return-1!==this.terminalStates.indexOf(this.fsm.state)}get getTerminationReason(){return this.terminationReason}onCloseReceived(e){this.websocket.close()}}t.TwilsockChannel=l,t.TwilsockImpl=l},6460:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketChannel=void 0;const r=n(7187),i=n(5398);class s extends r.EventEmitter{constructor(e){super(),this.url=e,this.WebSocket=n.g.WebSocket||n.g.MozWebSocket||n(418)}get isConnected(){return this.socket&&1===this.socket.readyState}connect(){i.log.trace("connecting to socket");let e=new this.WebSocket(this.url);e.binaryType="arraybuffer",e.onopen=()=>{i.log.debug(`socket opened ${this.url}`),this.emit("connected")},e.onclose=e=>{i.log.debug("socket closed",e),this.emit("disconnected",e)},e.onerror=e=>{i.log.debug("error:",e),this.emit("socketError",e)},e.onmessage=e=>{this.emit("message",e.data)},this.socket=e}send(e){this.socket.send(e)}close(){if(i.log.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}t.WebSocketChannel=s},5869:(e,t,n)=>{"use strict";function r(e,t){return t=t||{},new Promise((function(n,r){var i=new XMLHttpRequest,s=[],o=[],a={},c=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:c,headers:{keys:function(){return s},entries:function(){return o},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var u in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){s.push(t=t.toLowerCase()),o.push([t,n]),a[t]=a[t]?a[t]+","+n:n})),n(c())},i.onerror=r,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(u,t.headers[u]);i.send(t.body||null)}))}n.r(t),n.d(t,{default:()=>r})},5877:(e,t,n)=>{var r=n(3570),i=n(1171),s=i;s.v1=r,s.v4=i,e.exports=s},5327:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var r=n||0,i=t;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},5217:e=>{var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},3570:(e,t,n)=>{var r,i,s=n(5217),o=n(5327),a=0,c=0;e.exports=function(e,t,n){var u=t&&n||0,l=t||[],d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){var p=s();null==d&&(d=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==h&&(h=i=16383&(p[6]<<8|p[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:c+1,g=f-a+(m-c)/1e4;if(g<0&&void 0===e.clockseq&&(h=h+1&16383),(g<0||f>a)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,c=m,i=h;var y=(1e4*(268435455&(f+=122192928e5))+m)%4294967296;l[u++]=y>>>24&255,l[u++]=y>>>16&255,l[u++]=y>>>8&255,l[u++]=255&y;var v=f/4294967296*1e4&268435455;l[u++]=v>>>8&255,l[u++]=255&v,l[u++]=v>>>24&15|16,l[u++]=v>>>16&255,l[u++]=h>>>8|128,l[u++]=255&h;for(var b=0;b<6;++b)l[u+b]=d[b];return t||o(l)}},1171:(e,t,n)=>{var r=n(5217),i=n(5327);e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[s+a]=o[a];return t||i(o)}},418:()=>{},1377:()=>{}},r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={id:e,loaded:!1,exports:{}},s={id:e,module:t,factory:n[e],require:i};return i.i.forEach((function(e){e(s)})),t=s.module,s.factory.call(t.exports,t,t.exports,s.require),t.loaded=!0,t.exports}return i.m=n,i.c=r,i.i=[],i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.hu=e=>e+"."+i.h()+".hot-update.js",i.hmrF=()=>"main."+i.h()+".hot-update.json",i.h=()=>"b6480a8409342d0c2f1a",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="chat-widget:",i.l=(n,r,s)=>{if(e[n])e[n].push(r);else{var o,a;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var l=c[u];if(l.getAttribute("src")==n||l.getAttribute("data-webpack")==t+s){o=l;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",t+s),o.src=n),e[n]=[r];var d=(t,r)=>{o.onerror=o.onload=null,clearTimeout(h);var i=e[n];if(delete e[n],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach((e=>e(r))),t)return t(r)},h=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),a&&document.head.appendChild(o)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e,t,n,r,s={},o=i.c,a=[],c=[],u="idle";function l(e){u=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}function d(e){if(0===t.length)return e();var n=t;return t=[],Promise.all(n).then((function(){return d(e)}))}function h(e){if("idle"!==u)throw new Error("check() is only allowed in idle status");return l("check"),i.hmrM().then((function(r){if(!r)return l(m()?"ready":"idle"),null;l("prepare");var s=[];return t=[],n=[],Promise.all(Object.keys(i.hmrC).reduce((function(e,t){return i.hmrC[t](r.c,r.r,r.m,e,n,s),e}),[])).then((function(){return d((function(){return e?f(e):(l("ready"),s)}))}))}))}function p(e){return"ready"!==u?Promise.resolve().then((function(){throw new Error("apply() is only allowed in ready status")})):f(e)}function f(e){e=e||{},m();var t=n.map((function(t){return t(e)}));n=void 0;var i,s=t.map((function(e){return e.error})).filter(Boolean);if(s.length>0)return l("abort"),Promise.resolve().then((function(){throw s[0]}));l("dispose"),t.forEach((function(e){e.dispose&&e.dispose()})),l("apply");var o=function(e){i||(i=e)},a=[];return t.forEach((function(e){if(e.apply){var t=e.apply(o);if(t)for(var n=0;n<t.length;n++)a.push(t[n])}})),i?(l("fail"),Promise.resolve().then((function(){throw i}))):r?f(e).then((function(e){return a.forEach((function(t){e.indexOf(t)<0&&e.push(t)})),e})):(l("idle"),Promise.resolve(a))}function m(){if(r)return n||(n=[]),Object.keys(i.hmrI).forEach((function(e){r.forEach((function(t){i.hmrI[e](t,n)}))})),r=void 0,!0}i.hmrD=s,i.i.push((function(f){var m,g,y,v=f.module,b=function(n,r){var i=o[r];if(!i)return n;var s=function(t){if(i.hot.active){if(o[t]){var s=o[t].parents;-1===s.indexOf(r)&&s.push(r)}else a=[r],e=t;-1===i.children.indexOf(t)&&i.children.push(t)}else console.warn("[HMR] unexpected require("+t+") from disposed module "+r),a=[];return n(t)},c=function(e){return{configurable:!0,enumerable:!0,get:function(){return n[e]},set:function(t){n[e]=t}}};for(var h in n)Object.prototype.hasOwnProperty.call(n,h)&&"e"!==h&&Object.defineProperty(s,h,c(h));return s.e=function(e){return function(e){switch(u){case"ready":return l("prepare"),t.push(e),d((function(){l("ready")})),e;case"prepare":return t.push(e),e;default:return e}}(n.e(e))},s}(f.require,f.id);v.hot=(m=f.id,g=v,y={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:e!==m,_requireSelf:function(){a=g.parents.slice(),e=m,i(m)},active:!0,accept:function(e,t){if(void 0===e)y._selfAccepted=!0;else if("function"==typeof e)y._selfAccepted=e;else if("object"==typeof e&&null!==e)for(var n=0;n<e.length;n++)y._acceptedDependencies[e[n]]=t||function(){};else y._acceptedDependencies[e]=t||function(){}},decline:function(e){if(void 0===e)y._selfDeclined=!0;else if("object"==typeof e&&null!==e)for(var t=0;t<e.length;t++)y._declinedDependencies[e[t]]=!0;else y._declinedDependencies[e]=!0},dispose:function(e){y._disposeHandlers.push(e)},addDisposeHandler:function(e){y._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=y._disposeHandlers.indexOf(e);t>=0&&y._disposeHandlers.splice(t,1)},invalidate:function(){switch(this._selfInvalidated=!0,u){case"idle":n=[],Object.keys(i.hmrI).forEach((function(e){i.hmrI[e](m,n)})),l("ready");break;case"ready":Object.keys(i.hmrI).forEach((function(e){i.hmrI[e](m,n)}));break;case"prepare":case"check":case"dispose":case"apply":(r=r||[]).push(m)}},check:h,apply:p,status:function(e){if(!e)return u;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);t>=0&&c.splice(t,1)},data:s[m]},e=void 0,y),v.parents=a,v.children=[],a=[],f.require=b})),i.hmrC={},i.hmrI={}})(),(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e,t,n,r,s={179:0},o={};function a(e){return new Promise(((t,n)=>{o[e]=t;var r=i.p+i.hu(e),s=new Error;i.l(r,(t=>{if(o[e]){o[e]=void 0;var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;s.message="Loading hot update chunk "+e+" failed.\n("+r+": "+i+")",s.name="ChunkLoadError",s.type=r,s.request=i,n(s)}}))}))}function c(o){function a(e){for(var t=[e],n={},r=t.map((function(e){return{chain:[e],id:e}}));r.length>0;){var s=r.pop(),o=s.id,a=s.chain,u=i.c[o];if(u&&(!u.hot._selfAccepted||u.hot._selfInvalidated)){if(u.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:o};if(u.hot._main)return{type:"unaccepted",chain:a,moduleId:o};for(var l=0;l<u.parents.length;l++){var d=u.parents[l],h=i.c[d];if(h){if(h.hot._declinedDependencies[o])return{type:"declined",chain:a.concat([d]),moduleId:o,parentId:d};-1===t.indexOf(d)&&(h.hot._acceptedDependencies[o]?(n[d]||(n[d]=[]),c(n[d],[o])):(delete n[d],t.push(d),r.push({chain:a.concat([d]),id:d})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}i.f&&delete i.f.jsonpHmr,e=void 0;var u={},l=[],d={},h=function(e){console.warn("[HMR] unexpected require("+e.id+") to disposed module")};for(var p in t)if(i.o(t,p)){var f,m=t[p],g=!1,y=!1,v=!1,b="";switch((f=m?a(p):{type:"disposed",moduleId:p}).chain&&(b="\nUpdate propagation: "+f.chain.join(" -> ")),f.type){case"self-declined":o.onDeclined&&o.onDeclined(f),o.ignoreDeclined||(g=new Error("Aborted because of self decline: "+f.moduleId+b));break;case"declined":o.onDeclined&&o.onDeclined(f),o.ignoreDeclined||(g=new Error("Aborted because of declined dependency: "+f.moduleId+" in "+f.parentId+b));break;case"unaccepted":o.onUnaccepted&&o.onUnaccepted(f),o.ignoreUnaccepted||(g=new Error("Aborted because "+p+" is not accepted"+b));break;case"accepted":o.onAccepted&&o.onAccepted(f),y=!0;break;case"disposed":o.onDisposed&&o.onDisposed(f),v=!0;break;default:throw new Error("Unexception type "+f.type)}if(g)return{error:g};if(y)for(p in d[p]=m,c(l,f.outdatedModules),f.outdatedDependencies)i.o(f.outdatedDependencies,p)&&(u[p]||(u[p]=[]),c(u[p],f.outdatedDependencies[p]));v&&(c(l,[f.moduleId]),d[p]=h)}t=void 0;for(var w,k=[],_=0;_<l.length;_++){var S=l[_];i.c[S]&&i.c[S].hot._selfAccepted&&d[S]!==h&&!i.c[S].hot._selfInvalidated&&k.push({module:S,require:i.c[S].hot._requireSelf,errorHandler:i.c[S].hot._selfAccepted})}return{dispose:function(){var e;n.forEach((function(e){delete s[e]})),n=void 0;for(var t,r=l.slice();r.length>0;){var o=r.pop(),a=i.c[o];if(a){var c={},d=a.hot._disposeHandlers;for(_=0;_<d.length;_++)d[_].call(null,c);for(i.hmrD[o]=c,a.hot.active=!1,delete i.c[o],delete u[o],_=0;_<a.children.length;_++){var h=i.c[a.children[_]];h&&((e=h.parents.indexOf(o))>=0&&h.parents.splice(e,1))}}}for(var p in u)if(i.o(u,p)&&(a=i.c[p]))for(w=u[p],_=0;_<w.length;_++)t=w[_],(e=a.children.indexOf(t))>=0&&a.children.splice(e,1)},apply:function(e){for(var t in d)i.o(d,t)&&(i.m[t]=d[t]);for(var n=0;n<r.length;n++)r[n](i);for(var s in u)if(i.o(u,s)){var a=i.c[s];if(a){w=u[s];for(var c=[],h=[],p=0;p<w.length;p++){var f=w[p],m=a.hot._acceptedDependencies[f];if(m){if(-1!==c.indexOf(m))continue;c.push(m),h.push(f)}}for(var g=0;g<c.length;g++)try{c[g].call(null,w)}catch(t){o.onErrored&&o.onErrored({type:"accept-errored",moduleId:s,dependencyId:h[g],error:t}),o.ignoreErrored||e(t)}}}for(var y=0;y<k.length;y++){var v=k[y],b=v.module;try{v.require(b)}catch(t){if("function"==typeof v.errorHandler)try{v.errorHandler(t)}catch(n){o.onErrored&&o.onErrored({type:"self-accept-error-handler-errored",moduleId:b,error:n,originalError:t}),o.ignoreErrored||e(n),e(t)}else o.onErrored&&o.onErrored({type:"self-accept-errored",moduleId:b,error:t}),o.ignoreErrored||e(t)}}return l}}}self.webpackHotUpdatechat_widget=(e,n,s)=>{for(var a in n)i.o(n,a)&&(t[a]=n[a]);s&&r.push(s),o[e]&&(o[e](),o[e]=void 0)},i.hmrI.jsonp=function(e,s){t||(t={},r=[],n=[],s.push(c)),i.o(t,e)||(t[e]=i.m[e])},i.hmrC.jsonp=function(o,u,l,d,h,p){h.push(c),e={},n=u,t=l.reduce((function(e,t){return e[t]=!1,e}),{}),r=[],o.forEach((function(t){i.o(s,t)&&void 0!==s[t]&&(d.push(a(t)),e[t]=!0)})),i.f&&(i.f.jsonpHmr=function(t,n){e&&!i.o(e,t)&&i.o(s,t)&&void 0!==s[t]&&(n.push(a(t)),e[t]=!0)})},i.hmrM=()=>{if("undefined"==typeof fetch)throw new Error("No browser support: need fetch API");return fetch(i.p+i.hmrF()).then((e=>{if(404!==e.status){if(!e.ok)throw new Error("Failed to fetch update manifest "+e.statusText);return e.json()}}))}})(),i(7262)})().default}));